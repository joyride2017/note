<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/note/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/note/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/note/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/note/favicon.ico?v=5.1.2" />






<meta name="description" content="####Groupby 12345678import numpy as npfrom pandas import Series, DataFrameimport pandas as pddf = DataFrame(&amp;#123;&apos;key1&apos; : [&apos;a&apos;, &apos;a&apos;, &apos;b&apos;, &apos;b&apos;, &apos;a&apos;],                &apos;key2&apos; : [&apos;one&apos;, &apos;two&apos;, &apos;one&apos;, &apos;two">
<meta property="og:type" content="article">
<meta property="og:title" content="groupby">
<meta property="og:url" content="https://joyride2017.github.io/note/2017/10/01/groupby/index.html">
<meta property="og:site_name" content="Local Playground">
<meta property="og:description" content="####Groupby 12345678import numpy as npfrom pandas import Series, DataFrameimport pandas as pddf = DataFrame(&amp;#123;&apos;key1&apos; : [&apos;a&apos;, &apos;a&apos;, &apos;b&apos;, &apos;b&apos;, &apos;a&apos;],                &apos;key2&apos; : [&apos;one&apos;, &apos;two&apos;, &apos;one&apos;, &apos;two">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2017-10-09T23:32:16.305Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="groupby">
<meta name="twitter:description" content="####Groupby 12345678import numpy as npfrom pandas import Series, DataFrameimport pandas as pddf = DataFrame(&amp;#123;&apos;key1&apos; : [&apos;a&apos;, &apos;a&apos;, &apos;b&apos;, &apos;b&apos;, &apos;a&apos;],                &apos;key2&apos; : [&apos;one&apos;, &apos;two&apos;, &apos;one&apos;, &apos;two">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/note/',
    scheme: 'Gemini',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://joyride2017.github.io/note/2017/10/01/groupby/"/>





  <title>groupby | Local Playground</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/note/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Local Playground</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/note/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://joyride2017.github.io/note/note/2017/10/01/groupby/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="n0body">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/note/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Local Playground">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">groupby</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-01T23:30:38-05:00">
                2017-10-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>####Groupby</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line">df = DataFrame(&#123;<span class="string">'key1'</span> : [<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>],</div><div class="line">                <span class="string">'key2'</span> : [<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'one'</span>],</div><div class="line">                <span class="string">'data1'</span> : np.random.randn(<span class="number">5</span>),</div><div class="line">                <span class="string">'data2'</span> : np.random.randn(<span class="number">5</span>)&#125;)</div><div class="line">df</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center"><strong>data1</strong></th>
<th style="text-align:center"><strong>data2</strong></th>
<th style="text-align:center"><strong>key1</strong></th>
<th style="text-align:center"><strong>key2</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">0</td>
<td style="text-align:center">0.744323</td>
<td style="text-align:center">-1.17581</td>
<td style="text-align:center">a</td>
<td style="text-align:center">one</td>
</tr>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">-0.98309</td>
<td style="text-align:center">0.001657</td>
<td style="text-align:center">a</td>
<td style="text-align:center">two</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">2.172645</td>
<td style="text-align:center">-0.08919</td>
<td style="text-align:center">b</td>
<td style="text-align:center">one</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">-1.283881</td>
<td style="text-align:center">0.251848</td>
<td style="text-align:center">b</td>
<td style="text-align:center">two</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">0.085033</td>
<td style="text-align:center">-1.820809</td>
<td style="text-align:center">a</td>
<td style="text-align:center">one</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">grouped = df[<span class="string">'data1'</span>].groupby(df[<span class="string">'key1'</span>])</div><div class="line">grouped</div><div class="line">grouped.mean() <span class="comment">#</span></div></pre></td></tr></table></figure>
<blockquote>
<p>key1<br>a   -0.148832<br>b    1.031403<br>Name: data1, dtype: float64</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">means = df[<span class="string">'data1'</span>].groupby([df[<span class="string">'key1'</span>], df[<span class="string">'key2'</span>]]).mean()</div><div class="line">means</div><div class="line">&lt;Answer&gt;</div><div class="line">key1  key2</div><div class="line">a     one    <span class="number">-1.234260</span></div><div class="line">      two    <span class="number">-2.006057</span></div><div class="line">b     one     <span class="number">0.280214</span></div><div class="line">      two    <span class="number">-2.754180</span></div><div class="line">Name: data1, dtype: float64</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">states = np.array([<span class="string">'Ohio'</span>, <span class="string">'California'</span>, <span class="string">'California'</span>, <span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>])</div><div class="line">years = np.array([<span class="number">2005</span>, <span class="number">2005</span>, <span class="number">2006</span>, <span class="number">2005</span>, <span class="number">2006</span>])</div><div class="line">df[<span class="string">'data1'</span>].groupby([states, years]).mean()</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.groupby(<span class="string">'key1'</span>).mean()</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center"><strong>data1</strong></th>
<th style="text-align:center"><strong>data2</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">key1</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">a</td>
<td style="text-align:center">-1.491526</td>
<td style="text-align:center">0.141503</td>
</tr>
<tr>
<td style="text-align:center">b</td>
<td style="text-align:center">-1.236983</td>
<td style="text-align:center">2.452646</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.groupby([<span class="string">'key1'</span>, <span class="string">'key2'</span>]).mean()</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center"></th>
<th style="text-align:center"><strong>data1</strong></th>
<th style="text-align:center"><strong>data2</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">key1</td>
<td style="text-align:center">key2</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">a</td>
<td style="text-align:center">one</td>
<td style="text-align:center">-1.23426</td>
<td style="text-align:center">-0.189806</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">two</td>
<td style="text-align:center">-2.006057</td>
<td style="text-align:center">0.80412</td>
</tr>
<tr>
<td style="text-align:center">b</td>
<td style="text-align:center">one</td>
<td style="text-align:center">0.280214</td>
<td style="text-align:center">2.617027</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">two</td>
<td style="text-align:center">-2.75418</td>
<td style="text-align:center">2.288265</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.groupby([<span class="string">'key1'</span>, <span class="string">'key2'</span>]).size()</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:center"><strong>key1</strong></th>
<th style="text-align:center"><strong>key2</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">a</td>
<td style="text-align:center">one</td>
<td style="text-align:center">2</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">two</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">b</td>
<td style="text-align:center">one</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center"></td>
<td style="text-align:center">two</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">dtype:</td>
<td style="text-align:center">int64</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<h5 id="Interate-over-groups"><a href="#Interate-over-groups" class="headerlink" title="Interate over groups"></a>Interate over groups</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> name, group <span class="keyword">in</span> df.groupby(<span class="string">'key1'</span>):</div><div class="line">    print(name)</div><div class="line">    print(group)</div><div class="line"></div><div class="line"><span class="keyword">for</span> (k1, k2), group <span class="keyword">in</span> df.groupby([<span class="string">'key1'</span>, <span class="string">'key2'</span>]):</div><div class="line">    print((k1, k2))</div><div class="line">    print(group)</div><div class="line"></div><div class="line">pieces = dict(list(df.groupby(<span class="string">'key1'</span>)))</div><div class="line">pieces[<span class="string">'b'</span>]</div><div class="line"></div><div class="line">df.dtypes</div><div class="line"></div><div class="line">grouped = df.groupby(df.dtypes, axis=<span class="number">1</span>)</div><div class="line">dict(list(grouped))</div></pre></td></tr></table></figure>
<h5 id="Select-subsets"><a href="#Select-subsets" class="headerlink" title="Select subsets"></a>Select subsets</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">df</div><div class="line">df.groupby(<span class="string">'key1'</span>)[<span class="string">'data1'</span>]</div><div class="line">df.groupby(<span class="string">'key1'</span>)[[<span class="string">'data2'</span>]]</div><div class="line"><span class="comment"># are syntactic sugar for</span></div><div class="line">df[<span class="string">'data1'</span>].groupby(df[<span class="string">'key1'</span>])</div><div class="line">df[[<span class="string">'data2'</span>]].groupby(df[<span class="string">'key1'</span>])</div><div class="line"></div><div class="line"><span class="comment"># return a grouped data frame</span></div><div class="line">df.groupby([<span class="string">'key1'</span>, <span class="string">'key2'</span>])[[<span class="string">'data2'</span>]].mean()</div><div class="line"><span class="comment"># return a grouped series</span></div><div class="line">s_grouped = df.groupby([<span class="string">'key1'</span>, <span class="string">'key2'</span>])[<span class="string">'data2'</span>]</div><div class="line">s_grouped</div><div class="line"></div><div class="line">s_grouped.mean()</div></pre></td></tr></table></figure>
<h5 id="Use-dicts-and-Series"><a href="#Use-dicts-and-Series" class="headerlink" title="Use dicts and Series"></a>Use dicts and Series</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">people = DataFrame(np.random.randn(<span class="number">5</span>, <span class="number">5</span>),</div><div class="line">                   columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>],</div><div class="line">                   index=[<span class="string">'Joe'</span>, <span class="string">'Steve'</span>, <span class="string">'Wes'</span>, <span class="string">'Jim'</span>, <span class="string">'Travis'</span>])</div><div class="line"></div><div class="line">people.loc[<span class="number">2</span>:<span class="number">3</span>, [<span class="string">'b'</span>, <span class="string">'c'</span>]] = np.nan <span class="comment"># Add a few NA values</span></div><div class="line">people</div></pre></td></tr></table></figure>
<p>suppose I have a group correspondence for the columns and want to sum together the columns by group:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mapping = &#123;<span class="string">'a'</span>: <span class="string">'red'</span>, <span class="string">'b'</span>: <span class="string">'red'</span>, <span class="string">'c'</span>: <span class="string">'blue'</span>,</div><div class="line">           <span class="string">'d'</span>: <span class="string">'blue'</span>, <span class="string">'e'</span>: <span class="string">'red'</span>, <span class="string">'f'</span> : <span class="string">'orange'</span>&#125;</div><div class="line"></div><div class="line">by_column = people.groupby(mapping, axis=<span class="number">1</span>)</div><div class="line">by_column.sum()</div></pre></td></tr></table></figure></p>
<p>The same functionality holds for Series, which can be viewed as a fixed sizemapping.  When I used Series as group keys in the above examples, pandas inspects each Series to ensure that its index is aligned with the axis it’s grouping:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">map_series = Series(mapping)</div><div class="line">map_series</div><div class="line"></div><div class="line">people.groupby(map_series, axis=<span class="number">1</span>).count()</div></pre></td></tr></table></figure></p>
<h5 id="Use-functions"><a href="#Use-functions" class="headerlink" title="Use functions"></a>Use functions</h5><p>Using Python functions is a more generic way of defining a group mapping compared with a dict or Series. Any function passed as a group key will be called once <code>per index value</code>, with the return values being used as the group names.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">people</div><div class="line">people.groupby(len).sum()</div><div class="line"></div><div class="line"><span class="comment"># Mixing functions with arrays, dicts, or Series is not a problem as everything gets converted to arrays internally:</span></div><div class="line">key_list = [<span class="string">'one'</span>, <span class="string">'one'</span>, <span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'two'</span>]</div><div class="line">people.groupby([len, key_list]).min()</div></pre></td></tr></table></figure></p>
<h5 id="Use-index-levels"><a href="#Use-index-levels" class="headerlink" title="Use index levels"></a>Use index levels</h5><p>A final convenience for hierarchically-indexed data sets is the ability to aggregate using one of the levels of an axis index. To do this, pass the level number or name using the level keyword:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">columns = pd.MultiIndex.from_arrays([[<span class="string">'US'</span>, <span class="string">'US'</span>, <span class="string">'US'</span>, <span class="string">'JP'</span>, <span class="string">'JP'</span>],</div><div class="line">                                    [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">3</span>]], names=[<span class="string">'cty'</span>, <span class="string">'tenor'</span>])</div><div class="line">hier_df = DataFrame(np.random.randn(<span class="number">4</span>, <span class="number">5</span>), columns=columns)</div><div class="line">hier_df</div><div class="line"></div><div class="line">hier_df.groupby(level=<span class="string">'cty'</span>, axis=<span class="number">1</span>).count()</div></pre></td></tr></table></figure></p>
<h5 id="Data-aggregation"><a href="#Data-aggregation" class="headerlink" title="Data aggregation"></a>Data aggregation</h5><p>Aggregations refer to any data transformation that produces scalar values from arrays. In the examples above I have used several of them, such as mean, count, min and sum.</p>
<h6 id="Basics"><a href="#Basics" class="headerlink" title="Basics"></a>Basics</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">df</div><div class="line"><span class="comment"># While quantile is not explicitly implemented for GroupBy, it is a Series method and thus available for use.</span></div><div class="line">grouped = df.groupby(<span class="string">'key1'</span>)</div><div class="line">grouped[<span class="string">'data1'</span>].quantile(<span class="number">0.9</span>)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">peak_to_peak</span><span class="params">(arr)</span>:</span></div><div class="line">    <span class="keyword">return</span> arr.max() - arr.min()</div><div class="line">grouped.agg(peak_to_peak)</div><div class="line"><span class="comment"># You may notice that some methods like describe also work, even though they are not aggregations, strictly speaking:</span></div><div class="line"><span class="keyword">import</span> os</div><div class="line">grouped.describe()</div><div class="line">os.chdir(<span class="string">'F:/note/source/_posts/groupby'</span>)</div><div class="line">tips = pd.read_csv(<span class="string">'tips.csv'</span>)</div><div class="line">tips.head(<span class="number">10</span>)</div><div class="line"><span class="comment"># Add tip percentage of total bill</span></div><div class="line">tips[<span class="string">'tip_pct'</span>] = tips[<span class="string">'tip'</span>] / tips[<span class="string">'total_bill'</span>]</div><div class="line">tips[:<span class="number">6</span>]</div></pre></td></tr></table></figure>
<h6 id="Column-wise"><a href="#Column-wise" class="headerlink" title="Column-wise"></a>Column-wise</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">grouped = tips.groupby([<span class="string">'sex'</span>, <span class="string">'smoker'</span>])</div><div class="line">grouped_pct = grouped[<span class="string">'tip_pct'</span>]</div><div class="line">grouped_pct.agg(<span class="string">'mean'</span>)</div><div class="line"></div><div class="line"><span class="comment"># If you pass a list of functions or function names instead, you get back a DataFrame with column names taken from the functions:</span></div><div class="line">grouped_pct.agg([<span class="string">'mean'</span>, <span class="string">'std'</span>, peak_to_peak])</div><div class="line"></div><div class="line"><span class="comment"># You don’t need to accept the names that GroupBy gives to the columns:</span></div><div class="line">grouped_pct.agg([(<span class="string">'foo'</span>, <span class="string">'mean'</span>), (<span class="string">'bar'</span>, np.std)])</div><div class="line"></div><div class="line"><span class="comment"># With a DataFrame, you have more options as you can specify a list of functions to apply to all of the columns or different functions per column.</span></div><div class="line">functions = [<span class="string">'count'</span>, <span class="string">'mean'</span>, <span class="string">'max'</span>]</div><div class="line">result = grouped[<span class="string">'tip_pct'</span>, <span class="string">'total_bill'</span>].agg(functions)</div><div class="line">result</div><div class="line">result[<span class="string">'tip_pct'</span>]</div><div class="line"></div><div class="line"><span class="comment"># As above, a list of tuples with custom names can be passed:</span></div><div class="line">ftuples = [(<span class="string">'Durchschnitt'</span>, <span class="string">'mean'</span>), (<span class="string">'Abweichung'</span>, np.var)]</div><div class="line">grouped[<span class="string">'tip_pct'</span>, <span class="string">'total_bill'</span>].agg(ftuples)</div><div class="line"></div><div class="line"><span class="comment"># Now, suppose you wanted to apply potentially different functions to one or more of the columns.</span></div><div class="line">grouped.agg(&#123;<span class="string">'tip'</span> : np.max, <span class="string">'size'</span> : <span class="string">'sum'</span>&#125;)</div><div class="line">grouped.agg(&#123;<span class="string">'tip_pct'</span> : [<span class="string">'min'</span>, <span class="string">'max'</span>, <span class="string">'mean'</span>, <span class="string">'std'</span>],</div><div class="line">             <span class="string">'size'</span> : <span class="string">'sum'</span>&#125;)</div></pre></td></tr></table></figure>
<h6 id="Unindexed"><a href="#Unindexed" class="headerlink" title="Unindexed"></a>Unindexed</h6><p>In all of the examples up until now, the aggregated data comes back with an index, potentially hierarchical, composed from the unique group key combinations observed. Since this isn’t always desirable, you can disable this behavior in most cases by passing as_index=False to groupby:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tips.groupby([<span class="string">'sex'</span>, <span class="string">'smoker'</span>], as_index=<span class="keyword">False</span>).mean()</div></pre></td></tr></table></figure></p>
<p>Of course, it’s always possible to obtain the result in this format by calling reset_index on the result.</p>
<h5 id="Groupwise-operations"><a href="#Groupwise-operations" class="headerlink" title="Groupwise operations"></a>Groupwise operations</h5><h6 id="Apply-split-apply-combine"><a href="#Apply-split-apply-combine" class="headerlink" title="Apply: split-apply-combine"></a>Apply: split-apply-combine</h6><p>Suppose you wanted to select the top<br>five tip_pct values by group. First, write a function that selects the rows with the largest values in a particular column:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">top</span><span class="params">(df, n=<span class="number">5</span>, column=<span class="string">'tip_pct'</span>)</span>:</span></div><div class="line">    <span class="keyword">return</span> df.sort_index(by=column)[-n:]</div><div class="line">top(tips, n=<span class="number">6</span>)</div><div class="line"></div><div class="line">tips.groupby(<span class="string">'smoker'</span>).apply(top)</div><div class="line"></div><div class="line">tips.groupby([<span class="string">'smoker'</span>, <span class="string">'day'</span>]).apply(top, n=<span class="number">1</span>, column=<span class="string">'total_bill'</span>)</div><div class="line"></div><div class="line">result = tips.groupby(<span class="string">'smoker'</span>)[<span class="string">'tip_pct'</span>].describe()</div><div class="line">result</div><div class="line"></div><div class="line">result.unstack(<span class="string">'smoker'</span>)</div><div class="line"><span class="comment"># alternative,</span></div><div class="line">f = <span class="keyword">lambda</span> x: x.describe()</div><div class="line">grouped.apply(f)</div></pre></td></tr></table></figure></p>
<h6 id="Qunatile"><a href="#Qunatile" class="headerlink" title="Qunatile"></a>Qunatile</h6><h6 id="Filling-missing-values"><a href="#Filling-missing-values" class="headerlink" title="Filling missing values"></a>Filling missing values</h6><h6 id="Random-sampling"><a href="#Random-sampling" class="headerlink" title="Random sampling"></a>Random sampling</h6><h6 id="Group-weighted-stat"><a href="#Group-weighted-stat" class="headerlink" title="Group weighted stat"></a>Group weighted stat</h6><h6 id="Groupwise-regression"><a href="#Groupwise-regression" class="headerlink" title="Groupwise regression"></a>Groupwise regression</h6><h5 id="Pivot-tables"><a href="#Pivot-tables" class="headerlink" title="Pivot tables"></a>Pivot tables</h5><h5 id="Application-II"><a href="#Application-II" class="headerlink" title="Application II"></a>Application II</h5><h6 id="Raw-data"><a href="#Raw-data" class="headerlink" title="Raw data"></a>Raw data</h6><h6 id="Donation-statistics"><a href="#Donation-statistics" class="headerlink" title="Donation statistics"></a>Donation statistics</h6><h6 id="Bucketing-donation-amounts"><a href="#Bucketing-donation-amounts" class="headerlink" title="Bucketing donation amounts"></a>Bucketing donation amounts</h6><h6 id="Donation-stat-by-state"><a href="#Donation-stat-by-state" class="headerlink" title="Donation stat by state"></a>Donation stat by state</h6>
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/note/2017/09/08/python-basics/" rel="next" title="Python Cookbook">
                <i class="fa fa-chevron-left"></i> Python Cookbook
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/note/2017/10/18/Data-manipulating/" rel="prev" title="Data manipulating">
                Data manipulating <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <p class="site-author-name" itemprop="name">n0body</p>
            <p class="site-description motion-element" itemprop="description"></p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/note/archives">
            
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-5"><a class="nav-link" href="#Interate-over-groups"><span class="nav-text">Interate over groups</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Select-subsets"><span class="nav-text">Select subsets</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Use-dicts-and-Series"><span class="nav-text">Use dicts and Series</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Use-functions"><span class="nav-text">Use functions</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Use-index-levels"><span class="nav-text">Use index levels</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Data-aggregation"><span class="nav-text">Data aggregation</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Basics"><span class="nav-text">Basics</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Column-wise"><span class="nav-text">Column-wise</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Unindexed"><span class="nav-text">Unindexed</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Groupwise-operations"><span class="nav-text">Groupwise operations</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Apply-split-apply-combine"><span class="nav-text">Apply: split-apply-combine</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Qunatile"><span class="nav-text">Qunatile</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Filling-missing-values"><span class="nav-text">Filling missing values</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Random-sampling"><span class="nav-text">Random sampling</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Group-weighted-stat"><span class="nav-text">Group weighted stat</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Groupwise-regression"><span class="nav-text">Groupwise regression</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Pivot-tables"><span class="nav-text">Pivot tables</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Application-II"><span class="nav-text">Application II</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#Raw-data"><span class="nav-text">Raw data</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Donation-statistics"><span class="nav-text">Donation statistics</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Bucketing-donation-amounts"><span class="nav-text">Bucketing donation amounts</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#Donation-stat-by-state"><span class="nav-text">Donation stat by state</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">n0body</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" href="https://hexo.io">Hexo</a></div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">Theme &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/note/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/note/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/note/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/note/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/note/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/note/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/note/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/note/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/note/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/note/js/src/schemes/pisces.js?v=5.1.2"></script>



  <script type="text/javascript" src="/note/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/note/js/src/post-details.js?v=5.1.2"></script>


  
  <script type="text/javascript" src="/note/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/note/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/note/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
