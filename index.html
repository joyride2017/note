<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/note/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/note/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/note/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/note/favicon.ico?v=5.1.2" />






<meta property="og:type" content="website">
<meta property="og:title" content="Local Playground">
<meta property="og:url" content="https://joyride2017.github.io/note/index.html">
<meta property="og:site_name" content="Local Playground">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Local Playground">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/note/',
    scheme: 'Gemini',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://joyride2017.github.io/note/"/>





  <title>Local Playground</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/note/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Local Playground</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/note/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/note/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://joyride2017.github.io/note/note/2017/11/07/SCF-preparation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="n0body">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/note/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Local Playground">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/note/2017/11/07/SCF-preparation/" itemprop="url">SCF preparation</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-11-07T16:55:17-06:00">
                2017-11-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="1983"><a href="#1983" class="headerlink" title="1983"></a>1983</h1><p>Yang uses the edited and imputed version for 1983.</p>
<blockquote>
<p>Weights for the 1983 survey were constructed in two phases. Relative weights for the <strong>area-probability sample</strong> were constructed to compensate for differential <strong>non-response rates</strong> across the survey’s 75 primary sampling units. Those weights were further <strong>post-stratified</strong> by region and degree of urbanization to <strong>reflect population estimates</strong> from the March 1983 Current Population Survey (CPS).</p>
<p>1983:   February - August ‘83<br>1986:   June - September ‘86<br>1989:   October ‘89 - March ‘90 </p>
</blockquote>
<ul>
<li><p>Full public data set: edited and imputed version<br>Final survey data COPY/EXPORT version (3.9 MB) <a href="https://www.federalreserve.gov/econres/files/1983_scf83bx.zip" target="_blank" rel="external">1983_scf83bx.zip</a>. Variables are prefixed with “B” and contain variables “V1 (in uncleaned version)” and “B1 (for edited version)” as unique observation identifier. Stata version <a href="https://www.federalreserve.gov/econres/files/1983_scf83bs.zip" target="_blank" rel="external">1983_scf83bs.zip</a></p>
<blockquote>
<p>Full sample seems to refer to the integration of <strong>area probability sample</strong> and <strong>high-income sample</strong>.</p>
<p><code>High-Income and full sample weights</code>: The weights for the combined sample containing both the area probability and high-income samples were more difficult to compute, and are more subject to question. Unfortunately full information on the high-income sampling procedure is not publicly available. Additional complications stem from the fact that the high-income observations were drawn from a 1980 sampling frame of taxpayers (but were contacted in 1983) and the fact that the reporting basis for tax files (individuals or married couples) is not always the same as the survey (families).</p>
<p>The <strong>fitted probit equation</strong> results can be used in two ways. The <strong>inverse of the predicted probability that an observation would have been included in the cleaned sample (conditioned on the predictor variables used), can be used to weight observations in analysis</strong>. In practice, this procedure implies higher weights for observations holding a large number of different assets.</p>
<p>Parameter format needs to be ‘xport’ in the Python Pandas command, pandas.read_sas.<br><code>B3004</code>, 1983 post-stratification sampling weights scheme, is used. Division by five is needed for correct weighted statistics. This scheme is essentially the same as that used by the Census Bureau in reporting the March 1983 CPS survey, which used a similar sampling strategy as that of the SCF. </p>
<p>All variables listed here have a “B” prefix followed by a four digit number ranging from 3001 to5749.  The original uncleaned survey responses are contained invariables with a “V” prefix.  These variables range from V1 to V2613.The codes for the “V” variables are described in the original survey codebook released by the SRC.  We note, though, that the “B” variables contain all the same types of information as those contained in the”V” variables.  Thus, for most analyses, it is possible to use the “B”variables without reference to the “V” variables.</p>
<p><strong>B3305</strong>     GROSS ASSETS EXCLUDING NON-THRIFT PENSIONS.<br>The sum of paper assets plus current value of home plus gross value of other properties plus total value of vehicles plus net value of <strong>businesses</strong> with and without management interest (B3304 + B3501 + B3502).  No missing values. xxxxxxxx. dollars (5 to 86,857,433) 0. none (147 cases)<br><strong>B3324</strong>    NET WORTH.<br>Gross assets excluding pensions plus total net present value of pensions minus <strong>total debt</strong> (B3305 + B3316 - B3320).  No missing values (currently the same as B3323). xxxxxxxx. dollars (-73,400 to 86,852,003) 0. none (105 cases)</p>
</blockquote>
<p>Codebook <a href="https://www.federalreserve.gov/econres/files/1983_codebk83.txt" target="_blank" rel="external">1983_codebk83</a><br>Appendix (inclusing occupation and industry codes) <a href="https://www.federalreserve.gov/econres/files/1983_appendix83.pdf" target="_blank" rel="external">1983_appendix83.pdf</a><br>Codebook contains the text, variable names, and responses for the questions asked in the survey.</p>
<p>​</p>
<blockquote>
<p><strong>Why uses weights?</strong> For a variety of reasons, final household survey data will rarely represent a random draw from the U.S. population.  Even if the original survey design were random, different types of households will have different likelihoods of completing interviews. Very high and very low income households, for example, are thought to be less likely to participate in surveys.  The 1983 SCF had an additional source of non-randomness because of the inclusion of the high-income supplement. These factors necessitated the construction of weighting variables to compensate for known or estimable sources of stratification in the final data set. </p>
<p>Inclusion of households in the <strong>final “cleaned” data set</strong> described in this manual results from a series of implicit stratified selection criteria. There are four major sources of implicit <code>stratification</code>. (1) there are different <code>response rates</code> for different household types. (2) The sample may not fully reflect U.S. population due to <code>sampling error</code> in the survey itself (in the sense that any random sample will not have the same average characteristics as the population from which it is drawn). (3) Not all survey observations were <code>usable</code> for analysis because of significant missing information due to deliberate or inadvertent actions.  In specific, of the 3,824 area probability sample survey households included in the original SRC data tape, 159 observations were dropped in the cleaned file. Finally, the SCF sample is drawn from both the area probability and high-income sampling frames. If both samples are used, it is necessary to properly mix them to have a representative national sample. </p>
<p><strong>Techniques</strong></p>
<ul>
<li><p>Area Probability sample weights: The original SRC sampling frame called for sampling 6,062 housing units in the cross-section. If each housing unit had yielded an interview, each observation would represent 13,333 housing units. In fact as shown earlier in table 1, only about 89 percent of the housing units were occupied, and of these, only about 71 percent (<strong>3824</strong>) contained households who were willing to participate in the survey. Obviously, the exact characteristics of the non-responding households are unknown; however, the response and occupancy rate differed significantly across the survey’s 75 PSUs. The <strong>“non-response” weight</strong> adjusts for this differential non-response. This weight is equal to <strong>the reciprocal of the household response rate</strong> for the PSU for which the household belongs. This weight should compensate for some location-related characteristics associated with non-response and occupancy.  </p>
</li>
<li><p>The second type of stratification cited above can be adjusted for by taking into account <strong>how the final area probability sample (weighted for “non-response”) </strong>compares with the population<strong> according to certain select characteristics. Obviously the sample could be adjusted for any one of a number of characteristics (age, income, size of household, region, etc.). SRC elected to compensate for regional sampling error by computing a “post-stratification” weight which adjusts the sample to have the same relative population as the 1980 census in the four major sample regions (Northeast, South, North Central, and West) further subdivided into urban and rural. We computed a similar weight, but </strong>post-stratified<strong> to the population and urban/rural definitions represented by the </strong>March 1983 CPS**.</p>
</li>
<li><p>The third type of stratification cited above can be adjusted for in two different ways.  The criteria for <strong>inclusion in the cleaned area probability sample</strong> was as follows.  Any observation with any dollar values given for earnings or income was automatically included. Remaining observations were excluded only if there were virtually no dollar values given for housing value (or rent), other property values, business, and financial assets.  Information on debts was not used in this section. None of the high-income sample observations were dropped.  In fact, these  observations were remarkably clean, with comparatively little missing information.</p>
</li>
<li><p>To compensate for these exclusions, a probit model was fit to model the probability that an observation in the complete 3824 area probability sample file would be included in the cleaned 3665-observation data set.</p>
<p><strong>Definition of full sample</strong></p>
</li>
<li><p>High-Income and full sample weights<strong>: The weights for the </strong>combined sample containing both the area probability and high-income samples** were more difficult to compute, and are more <code>subject to question</code>. Unfortunately full information on the high-income sampling procedure is not publicly available.  Additional complications stem from the fact that the high-income observations were drawn from a 1980 sampling frame of taxpayers (but were contacted in 1983) and the fact that the reporting basis for tax files (individuals or married couples) is not always the same as the survey (families).</p>
</li>
</ul>
<p><strong>Probit model</strong></p>
<p>To compensate for these types of sample stratification, <code>area probability</code> and <code>high-income</code> sampling (weighting) frames are introduced. If both samples are used, it is necessary to properly mix them to have a <strong>representative national sample</strong>. See the reference for the use of <strong>probit model</strong> to construct sampling weight.</p>
<p><strong>What’s the impact of unweighted SCF survey data?</strong> The unweighted sample clearly shows an over-representation of elderly, high-income, wealthy, white, and married households relative to all of the weighted samples.</p>
<p><strong>How is the compatibility of SCF data with others?</strong>  The 1983 SCF overstates comparable CPS income by about 6 percent. Most of this overstatement stems from business income and income from dividends, trusts, and real estate. Interestingly, in a comparison of data with an “independent source” in 1983, the Census Bureau concluded that CPS income data “underreported by about 10 percent” (U.S. Bureau of the Census (1985, p. 218)). The SCF also overstates IRS household income by about 7 percent. Much of the discrepancy can be explained by the SCF’s failure to find significant business, rental, and security losses.</p>
<p>B3505 (A)     LEGAL STRUCTURE.</p>
<p>B3518 (B)     All missing values were imputed.  Imputations were done with conditional mean tables with randomization.        </p>
<ol>
<li>proprietorship (254/39 cases)        </li>
<li>partnership (170/49 cases)</li>
<li>corporation (247/60 cases)</li>
<li>INAP (3432/3955 cases)</li>
</ol>
</blockquote>
<h1 id="1986"><a href="#1986" class="headerlink" title="1986"></a>1986</h1></li>
</ul>
<p>The 1983 SCF was conducted through in-person household interviews between <code>February</code> and <code>August</code> 1983.</p>
<blockquote>
<p>The 1986 SCF – sponsored by the Federal Reserve Board, the Department of Health and Human Services, the Office of the Comptroller of the Currency, and the General Accounting Office – was a more limited 27-minute <strong>re-interview survey</strong> with respondents to the <strong>1983 SCF</strong>.  When 1983 couples divorced or separated, the survey followed both parties. However, other members who left the household, such as young adults were not followed. A total of 2,822 interviews were completed, by telephone, between <code>June</code> and <code>September</code> 1986. As in 1983, the unit of observation was the family.</p>
<p>For many purposes, it is useful to view the 1986 sample as a sub-sample of the 1983 survey. However, it is also possible to view the 1986 sample as a <strong>new cross-section</strong>, representative of the structure of the 1986 household population. Accordingly, we have constructed two sampling weights for the 1986 sample.  The first weight – which we term the “1983/86 weight” – was designed to allow the sample of households reached in 1986 to represent the entire 1983 sample. The second 1986 sample weight – deemed the “<strong>1986 weight</strong>“ – may be used to represent the 1986 household population.</p>
<p>Because at any given time a significant proportion of younger adults are in school or the military, or live with their parents, those younger people living independently at the time of the 1983 SCF are <strong>unlikely to represent</strong> the population of households of their cohort three years later. Therefore, the sample has not been weighted to represent the population of <code>households with heads aged 24 and under in 1986</code>. Households that fell into that group in 1986 were assigned weights adjusted for attrition and marital status change, but were not post-stratified to 1986 control totals. For this reason, we strongly recommend that <code>only those households aged 25 or more in 1986</code> be used for <strong>analysis of changes</strong>. </p>
</blockquote>
<ul>
<li><p>Full public data set: edited and imputed version</p>
<p>Final survey data COPY/EXPORT version (1.6 MB) <a href="https://www.federalreserve.gov/econres/files/1986_scf86bx.zip" target="_blank" rel="external">1986_scf86bx.zip</a> Stata version <a href="https://www.federalreserve.gov/econres/files/1986_scf86bs.zip" target="_blank" rel="external">1986_scf86bs.zip</a></p>
<p>Coodbook <a href="https://www.federalreserve.gov/econres/files/1986_codebk86.txt" target="_blank" rel="external">1986_codebk86.txt</a></p>
<blockquote>
<p><strong>Financial Assets.</strong>  The amount, type, and source of each household checking, savings, and money market account.  Household holdings of publicly traded stock, bonds, certificates of deposit, mutual funds, trusts, and notes or land contracts.  Face and cash value of life insurance.</p>
<p><strong>Tangible Assets.</strong>  The value and purchase terms of the household’s principal residence, other real estate, and automobiles.</p>
<p><strong>Pension Assets.</strong> I.R.A., Keogh, thrift, profit sharing, 401K, and other tax-deferred account holdings. Estimates of the present value and other information on each current or expected pension, including Social Security, of the household head and spouse.</p>
<p><strong>C1013 FRB 1986 WEIGHT #1</strong> This weight was post-stratified to 1986 <strong>CPS</strong> control totals independently. This weight is zero for all cases not interviewed in 1986.</p>
</blockquote>
</li>
</ul>
<h1 id="1989"><a href="#1989" class="headerlink" title="1989"></a>1989</h1><ul>
<li><p>Full public data set: edited and imputed version</p>
<blockquote>
<p>The dataset contains several sets of nonresponse-adjusted sampling weights. <strong>X42001</strong> is the weight strongly recommended for the analysis of the data for most purposes. This variable is a partially design-based weight constructed at the Federal Reserve using original selection probabilities and frame information along with <strong>aggregate control totals</strong> estimated from the Current Population Survey. The population defined by the weights for <em>each implicate</em> is 93.0 million households.  This weight is a relatively minor revision of the consistent weight series (X42000) maintained for the SCFs beginning with 1989</p>
</blockquote>
<p>Main survey data: COPY/EXPORT version (5MB ZIP) <a href="https://www.federalreserve.gov/econres/files/scf89x.zip" target="_blank" rel="external">scf89x.zip</a> Stata version <a href="https://www.federalreserve.gov/econres/files/scf89s.zip" target="_blank" rel="external">scf89s.zip</a></p>
<p>Codebook <a href="https://www.federalreserve.gov/econres/files/codebk89.txt" target="_blank" rel="external">codebk89.txt</a></p>
<p>Summary extract data set <a href="https://www.federalreserve.gov/econres/files/scfp1989.zip" target="_blank" rel="external">scfp1989.zip </a> Stata version <a href="https://www.federalreserve.gov/econres/files/scfp1989s.zip" target="_blank" rel="external">scfp1989s.zip</a></p>
<p>SAS program (containing detailed definition of variables in the summary extract dataset) <a href="https://www.federalreserve.gov/econres/files/bulletin.macro.txt" target="_blank" rel="external">bulletin.macro.txt</a></p>
<blockquote>
<p>Unlike the case of our earlier SCFs, there are not separate files of “raw” and “cleaned” data.  Rather, virtually every missing variable in the dataset has been imputed and every variable has a “shadow” variable that describes the original state of the variable (i.e., whether it was missing for some reason, a range response was given, etc.).</p>
<p>The main data values are stored using variable names corresponding to the numbers given in the codebook below and having a prefix of “X.” The shadow variables have the same numbers, but with a prefix of “J.”</p>
<p>In this dataset, values have been MULTIPLY-IMPUTED. The imputations are stored as complete replicates of each case. In the release, there are 5 copies of each survey observation. Thus, the sum of the weights will be equal <code>five times</code> the number of families in the U.S. in 1989. Users should be aware that the sum of each of the weights over all sample cases and imputation replicates is equal to five times the number of households in the sample universe.</p>
<p>For an overview of the theory of multiple imputation and the analysis of multiply-imputed data, see <code>MULTIPLE IMPUTATION FOR NONRESONSE IN SURVEYS</code> by Donald B. Rubin, John Wiley and Sons, 1987.</p>
<p>​</p>
<p>The dataset contains several sets of <code>nonresponse-adjusted sampling weights</code>. <strong>X42001</strong> is the weight strongly recommended for the analysis of the data for most purposes. This variable is a partially design-based weight constructed at the Federal Reserve using original selection probabilities and frame information along with aggregate control totals estimated from the <strong>Current Population Survey</strong>.</p>
<p>Work status categories for head (OCCAT1):</p>
<pre><code>1=work for someone else, 2=self-employed/partnership,
3=retired/disabled + (student/homemaker/misc. not working and
age 65 or older), 4=other groups not working (mainly those under
65 and out of the labor force).
</code></pre><p>Occupation classification for head (OCCAT2):</p>
<pre><code>1=managerial/professional 2=technical/sales/services,
3=other (incl. production/craft/repair workers, operators, 
laborers, farmers, foresters, fishers) 4=not working.
</code></pre></blockquote>
<p>​</p>
</li>
</ul>
<h1 id="1992"><a href="#1992" class="headerlink" title="1992"></a>1992</h1><p>Full public data (with all SCF variables) <a href="https://www.federalreserve.gov/econres/files/scf92x.zip" target="_blank" rel="external">scf92x.zip</a> Stata version <a href="https://www.federalreserve.gov/econres/files/scf92s.zip" target="_blank" rel="external">scf92s.zip</a></p>
<p>Summary Extract Data set <a href="https://www.federalreserve.gov/econres/files/scfp1992.zip" target="_blank" rel="external">scfp1992.zip</a> Stata version <a href="https://www.federalreserve.gov/econres/files/scfp1992s.zip" target="_blank" rel="external">scfp1992s.zip</a></p>
<p>Coobook <a href="https://www.federalreserve.gov/econres/files/codebk92.txt" target="_blank" rel="external">codebk92.txt</a></p>
<blockquote>
<p>The main data values are stored using variable names corresponding to the numbers given in the codebook below prefixed by an “<strong>X</strong>.” We have tried, insofar as it was possible, to retain the variable numbering system used for the 1989 SCF. Each of these variables in the main dataset has a “shadow” variable that describes–in almost all cases–the original state of the variable. The shadow variables have <code>the same numbers</code> as the main variable, but have a prefix of “<strong>J</strong>.”</p>
</blockquote>
<h1 id="1995"><a href="#1995" class="headerlink" title="1995"></a>1995</h1><p>Full Public Data set <a href="https://www.federalreserve.gov/econres/files/scf95x.zip" target="_blank" rel="external">scf95x.zip</a> Stata version <a href="https://www.federalreserve.gov/econres/files/scf95s.zip" target="_blank" rel="external">scf95s.zip</a></p>
<p>Summary Extract Data set <a href="https://www.federalreserve.gov/econres/files/scfp1995.zip" target="_blank" rel="external">scfp1995.zip</a> Stata version <a href="https://www.federalreserve.gov/econres/files/scfp1995s.zip" target="_blank" rel="external">scfp1995s.zip</a></p>
<h1 id="1998"><a href="#1998" class="headerlink" title="1998"></a>1998</h1><p>Full Public Data set <a href="https://www.federalreserve.gov/econres/files/scf98x.zip" target="_blank" rel="external">scf98x.zip</a> Stata version <a href="https://www.federalreserve.gov/econres/files/scf98s.zip" target="_blank" rel="external">scf98s.zip</a></p>
<p>Summary Extract Data set <a href="https://www.federalreserve.gov/econres/files/scfp1998.zip" target="_blank" rel="external">scfp1998.zip</a> Stata version <a href="https://www.federalreserve.gov/econres/files/scfp1998s.zip" target="_blank" rel="external">scfp1998s.zip</a></p>
<h1 id="2001"><a href="#2001" class="headerlink" title="2001"></a>2001</h1><p>Full Public Data set <a href="https://www.federalreserve.gov/econres/files/scf2001x.zip" target="_blank" rel="external">scf2001x.zip</a> Stata version <a href="https://www.federalreserve.gov/econres/files/scf01s.zip" target="_blank" rel="external">scf01s.zip</a></p>
<p>Summary Extract Data set <a href="https://www.federalreserve.gov/econres/files/scfp2001.zip" target="_blank" rel="external">scfp2001.zip</a> Stata version <a href="https://www.federalreserve.gov/econres/files/scfp2001s.zip" target="_blank" rel="external">scfp2001s.zip</a></p>
<h1 id="2004"><a href="#2004" class="headerlink" title="2004"></a>2004</h1><p>Full Public Data set <a href="https://www.federalreserve.gov/econres/files/scf2004x.zip" target="_blank" rel="external">scf2004x.zip</a> Stata version <a href="https://www.federalreserve.gov/econres/files/scf2004s.zip" target="_blank" rel="external">scf2004s.zip</a></p>
<p>Summary Extract Data set <a href="https://www.federalreserve.gov/econres/files/scfp2004.zip" target="_blank" rel="external">scfp2004.zip</a> Stata version <a href="https://www.federalreserve.gov/econres/files/scfp2004s.zip" target="_blank" rel="external">scfp2004s.zip</a></p>
<h1 id="2007"><a href="#2007" class="headerlink" title="2007"></a>2007</h1><p>Full Public Data set <a href="https://www.federalreserve.gov/econres/files/scf2007x.zip" target="_blank" rel="external">scf2007x.zip</a> Stata version <a href="https://www.federalreserve.gov/econres/files/scf2007s.zip" target="_blank" rel="external">scf2007s.zip</a></p>
<p>Summary Extract Data set <a href="https://www.federalreserve.gov/econres/files/scfp2007.zip" target="_blank" rel="external">scfp2007.zip</a> Stata version <a href="https://www.federalreserve.gov/econres/files/scfp2007s.zip" target="_blank" rel="external">scfp2007s.zip</a></p>
<h1 id="2010"><a href="#2010" class="headerlink" title="2010"></a>2010</h1><p>Full Public Data set <a href="https://www.federalreserve.gov/econres/files/scf2010x.zip" target="_blank" rel="external">scf2010x.zip</a> Stata version <a href="https://www.federalreserve.gov/econres/files/scf2010s.zip" target="_blank" rel="external">scf2010s.zip</a></p>
<p>Summary Extract Data set <a href="https://www.federalreserve.gov/econres/files/scfp2010.zip" target="_blank" rel="external">scfp2010.zip</a> Stata version <a href="https://www.federalreserve.gov/econres/files/scfp2010s.zip" target="_blank" rel="external">scfp2010s.zip</a></p>
<h1 id="2013"><a href="#2013" class="headerlink" title="2013"></a>2013</h1><p>Full Public Data set <a href="https://www.federalreserve.gov/econres/files/scf2013x.zip" target="_blank" rel="external">scf2013x.zip</a> Stata version <a href="https://www.federalreserve.gov/econres/files/scf2013s.zip" target="_blank" rel="external">scf2013s.zip</a></p>
<p>Summary Extract Data set <a href="https://www.federalreserve.gov/econres/files/scfp2013.zip" target="_blank" rel="external">scfp2013.zip</a> Stata version <a href="https://www.federalreserve.gov/econres/files/scfp2013s.zip" target="_blank" rel="external">scfp2013s.zip</a></p>
<h1 id="CPI"><a href="#CPI" class="headerlink" title="CPI"></a>CPI</h1><p>CPI-ALL Urban Consumers (current series)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Series Id:     CUSR0000SA0</div><div class="line">Seasonally Adjusted</div><div class="line">Series Title:  All items in U.S. city average, all urban consumers, seasonally adjusted</div><div class="line">Area:          U.S. city average</div><div class="line">Item:          All items</div><div class="line">Base Period:   1982-84=100</div></pre></td></tr></table></figure>
<p>The CPI is generally the best measure for adjusting payments to consumers when the intent is to allow consumers to purchase at today’s prices, a market basket of goods and services equivalent to one that they could purchase in an earlier period. It is used to index federal programs such as indexing Social Security and the tax code for inflation.</p>
<blockquote>
<p><strong>12-month percent change vs. annual percent change</strong></p>
<p>From a statistical perspective, each of these types of indexes has its advantages. A 12-month percent change from, say, December-to-December, is arguably a more <strong>recent</strong> estimate of price change than an annual average percent change. Said another way, the December-to-December percent change is the <strong>most recent 12-month</strong> percent change in a year, while the annual average percent change reflects the change in the <strong>average index for all 12 months</strong> of one year to the average index for all 12 months the next year.</p>
<p>The December-to-December index percent change, however, tends to be more volatile than the percent change in the annual average index. Annual average indexes are based on 12 monthly data points which, when averaged, reduce volatility by smoothing out the highs and lows. </p>
<p><strong>Seasonal adjustment</strong></p>
<p>By using seasonally adjusted data, some users find it easier to see the underlying trend in short-term price changes. It is often difficult to tell from raw (unadjusted) statistics whether developments between any 2 months reflect changing economic conditions or only normal seasonal patterns. Therefore, many economic series, including the CPI, are adjusted to remove the effect of seasonal influences-those which occur at the same time and in about the same magnitude every year. Among these influences are price movements resulting from changing weather conditions, production cycles, changeovers of models, and holidays.</p>
<p><strong>CPI can not be used to compare living costs among areas</strong></p>
<p>No, an individual area index measures how much prices have changed over a specific period in that particular area; it does not show whether prices or living costs are higher or lower in that area relative to another. In general, <strong>the composition of the market basket</strong> and the relative prices of goods and services in the market basket during the expenditure base period vary substantially across areas. </p>
<p>The CPI cannot be used to measure differences in price levels or living costs between one place and another; it measures only time-to-time changes in each place. A higher index for one area does not necessarily mean that prices are higher there than in another area with a lower index.</p>
<p><strong>Drawbacks of the traditional CPI-U</strong></p>
<p>Inflation—a general increase in the prices of goods and services—can be measured in various ways. Traditionally, the rate of inflation has been computed by multiplying the percentage price change for each item that people purchase by that item’s share of consumer spending in a period before the prices changed and then adding up those changes for all items. But the actual growth in the cost of living—the amount of additional resources that someone would need to maintain the same standard of living this year as last year in the face of rising prices—is generally lower than the rate of inflation when measured that way. The reason for the difference is that many people can lessen the impact of inflation on their standard of living by purchasing fewer goods or services that have risen in price and, instead, buying more goods or services that have not risen in price or have risen less.</p>
<p>To be sure, increases in the general price level that exceed increases in income and wealth lower consumers’ <strong>standard of living</strong>. But the resulting decline in their standard of living is usually smaller than it would be if substitution were not possible. Thus, measures of inflation that do not account for such substitution overstate growth in the cost of living—a problem known as substitution bias.</p>
<p>The methodology used by the Bureau of Labor Statistics (BLS) to calculate indexes suffers from at least two drawbacks—substitution bias and small-sample bias. Both of those drawbacks cause those traditional versions of the CPI to grow more <strong>quickly</strong> than the chained CPI-U, an improved measure of overall inflation developed by BLS that is discussed below.</p>
<p><strong>Substitution bias</strong></p>
<p>The traditional versions of the CPI are based on spending patterns from <strong>a point in the past</strong>, and so do not fully incorporate the effects of consumers’ <strong>substitution</strong> between various goods and services when their relative prices change. As a result, those traditional versions of the CPI <strong>overstate</strong> the amount by which consumers’ well being declines when prices rise and understate the benefit of reductions in prices. Therefore, the traditional versions tend to grow faster than the cost of living does.</p>
<p><strong>Statistical bias</strong></p>
<p>The traditional versions of the CPI also suffer from a statistical bias that occurs because the index is calculated using prices for only a small portion of the items in the economy. BLS produces an inflation index for an item in a specific region—such as cheese in the Kansas City area—by averaging the growth rates of a sample of prices for that item in that locale. BLS then computes the geometric average of the change in those prices. When the sample of prices is <strong>large</strong>, the expected value of the geometric average of the price changes in that sample is very close to—but slightly higher than—the geometric average of all price changes for that item in that region. When the sample size is <strong>smaller</strong>, that upward <strong>bias is larger</strong>.</p>
<p><strong>The chained CPI-U</strong></p>
<p>Since August 2002, BLS has published an alternative index, the chained CPI-U, which attempts to <strong>account for the effects of substitution on changes in the cost of living</strong>. The chained CPI-U provides a more accurate estimate of changes in the cost of living from one month to the next by using market baskets from both months, thus “chaining” the two months together.</p>
<p>The chained CPI-U is also largely free of small-sample bias because of the way in which it is computed. Both the traditional CPI and the chained CPI-U are based on the same item-area indexes, which are calculated using a geometric average. To <strong>combine</strong> those indexes into an overall estimate of price growth in the United States, however, BLS uses a <strong>geometric-average formula</strong> for the chained CPI-U, as opposed to an arithmetic average formula for the traditional CPI. The use of a geometric-average formula to combine the item-area indexes effectively makes the number of elements in the geometric average much larger, which essentially eliminates small-sample bias.</p>
<p><strong>Differences between the traditional and chained CPI-U</strong></p>
<p>The chained CPI-U results in <strong>lower</strong> estimates of inflation than the traditional CPI does. CBO expects that annual inflation as measured by the chained CPI-U will be about 0.25 percentage points lower, on average, than annual inflation as measured by the traditional CPI. That estimate is based in part on the observed past differences between the chained CPI-U and the traditional CPI-U and CPI-W.</p>
<p>The difference has generally been <strong>smaller</strong> when <strong>overall</strong> inflation has been lower—perhaps reflecting fewer increases in the relative prices of goods and services for which consumers spend a great deal and <strong>less interest by consumers in substituting</strong> between goods and services when price increases are mostly smaller. In addition, the gap between the traditional and the chained CPI-U has generally been smaller when prices for <strong>energy</strong> have been declining and larger when those prices have been rising rapidly.</p>
<p><strong>Drawbacks of chained CPI-U</strong></p>
<p>The values of the chained CPI are revised over a period of several years, so affected programs and the tax code <strong>would have to be indexed to a preliminary estimate</strong> of the chained CPI that is subject to estimation error.</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://joyride2017.github.io/note/note/2017/10/25/CBS-tv-series/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="n0body">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/note/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Local Playground">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/note/2017/10/25/CBS-tv-series/" itemprop="url">CBS tv series</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-25T21:38:08-05:00">
                2017-10-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="Bull"><a href="#Bull" class="headerlink" title="Bull"></a>Bull</h1>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://joyride2017.github.io/note/note/2017/10/25/how-carnival-games-scam-you/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="n0body">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/note/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Local Playground">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/note/2017/10/25/how-carnival-games-scam-you/" itemprop="url">how carnival games scam you</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-25T09:37:27-05:00">
                2017-10-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css">
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://joyride2017.github.io/note/note/2017/10/24/China-s-prospect/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="n0body">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/note/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Local Playground">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/note/2017/10/24/China-s-prospect/" itemprop="url">China's prospect</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-24T19:40:43-05:00">
                2017-10-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          Whether or not Chinese President Xi Jinping signals a successor Wednesday, he’s amassed enough power to effectively rule for decades.
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/note/2017/10/24/China-s-prospect/">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://joyride2017.github.io/note/note/2017/10/23/Bitcoin/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="n0body">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/note/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Local Playground">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/note/2017/10/23/Bitcoin/" itemprop="url">Bitcoin</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-23T21:34:25-05:00">
                2017-10-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          Should individuals invest in bitcoin? In a word, no. While the potential upside is alluring, the significant risk of loss is incompatible with prudent investing for long-term goals like college savings, buying a home or retirement.
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/note/2017/10/23/Bitcoin/">
              Read more &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://joyride2017.github.io/note/note/2017/10/23/Central-Bank/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="n0body">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/note/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Local Playground">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/note/2017/10/23/Central-Bank/" itemprop="url">Central Bank</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-23T20:54:25-05:00">
                2017-10-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><strong>BOJ’s monetary policy: preventing yield from rising too much remains in place</strong></p>
<p>Oct 16, 2017 3:33 pm ET<br>The Federal Reserve is <code>raising interest rates</code> and the European Central Bank is considering <code>buying fewer bonds</code>, but the Bank of Japan will stick to its easing guns forever, right?</p>
<p>Wrong. In fact, Japan’s central bank’s latest moves make it seem like it is <code>tightening</code> policy, too. </p>
<p>The BOJ bought just ¥7.7 trillion ($68.8 billion) <code>worth of</code> Japanese government bonds in September, according to J.P. Morgan. The figure represents its smallest monthly amount of outright buying, which doesn’t account for maturing bonds, since October 2014. That looks a lot like tapering.</p>
<blockquote>
<p>Note: Senior officials are inclined to complete the planned purchase programme, <code>tapering it over</code> an extended period to avoid a <code>disruptive sudden stop</code>. </p>
<ol>
<li>be inclined to 倾向于</li>
<li>taper it over an extended period 花时间逐步减少</li>
</ol>
</blockquote>
<p>Since the rollout of the BOJ’s “<a href="https://www.wsj.com/articles/boj-changes-policy-framework-after-review-of-measures-1474432869" target="_blank" rel="external">yield curve control</a>” policy last year, the central bank has been able to buy as many or as few bonds as it needs to <code>keep</code> its 10-year government-bond yield <code>near zero</code>, which investors have interpreted as a range between negative 0.1% and 0.1%. So when the 10-year yield doesn’t move dramatically, the central bank doesn’t have to buy as many bonds</p>
<p>While the BOJ has <a href="https://www.wsj.com/articles/shhhthe-bank-of-japan-is-buying-fewer-bonds-1497445342" target="_blank" rel="external">slowed its bond buys this year</a>, its leader has been quick to <code>dispel any chatter about</code> a shift in policy. Gov. Haruhiko Kuroda said Sunday that <a href="https://www.wsj.com/articles/kuroda-says-bank-of-japan-will-keep-pursuing-aggressive-monetary-easing-1508082462" target="_blank" rel="external">aggressive easing will remain</a> in place as Japan’s inflation rate is still a long way from reaching the central bank’s 2% target.</p>
<blockquote>
<ol>
<li>remain in place 依然存在（施行等等）</li>
<li>be still a long way from 离目标还有一大差距</li>
</ol>
</blockquote>
<p>The big question is what the BOJ does if global bond yields <code>rise for a sustained period</code>. The Federal Reserve <a href="https://www.wsj.com/articles/fed-keeps-december-rate-rise-on-the-table-eyes-slower-path-for-increases-1505930513" target="_blank" rel="external">said it would start shrinking its portfolio</a> of bonds in October, while some investors expect the European Central Bank to also announce a <a href="https://www.wsj.com/articles/ecb-officials-discussed-options-for-recalibrating-qe-at-last-meeting-1507203413" target="_blank" rel="external">slowing of its bond purchases</a>. <strong>Rising bond yields could make life more difficult for Japan’s central bank, as holders of JGBs dump them in favor of higher-yielding alternatives in the U.S. and Europe. Bond yields rise as prices fall</strong>.</p>
<blockquote>
<ol>
<li>rise for a sustained period 持续上涨</li>
<li>日本公债殖利率上升，持有者会抛售日本公债，转而购买其他国家更高获利的公债。</li>
</ol>
</blockquote>
<p>The BOJ might then be forced to step up its bond purchases <strong>to prevent the 10-year yield from rising too much</strong>, a task that is growing increasingly difficult. The central bank already owned an estimated 44% of outstanding government debt in September, compared with 38% a year ago, according to Capital Economics.</p>
<blockquote>
<ol>
<li>日本央行持有的公债越来越多。</li>
</ol>
</blockquote>
<h1 id="What-happens-when-the-ECB-steps-back-from-corporate-bonds"><a href="#What-happens-when-the-ECB-steps-back-from-corporate-bonds" class="headerlink" title="What happens when the ECB steps back from corporate bonds?"></a>What happens when the ECB steps back from corporate bonds?</h1><p>In the spring of 2016, traders at Germany’s central bank sat down with investment bank advisers in Frankfurt to discuss a once unthinkable project: how to build a multibillion-euro corporate-debt fund.</p>
<blockquote>
<ol>
<li>once unthinkable 不曾想像的</li>
</ol>
</blockquote>
<p>Fast forward 18 months and the European Central Bank has changed the face of the euro corporate-debt market, having bought almost €120 billion ($141 billion) of these securities. Financing costs for companies have fallen <code>to the point where</code> junk-rated firms can borrow at similar yields to U.S. government debt, prompting concerns it is fueling a bubble.</p>
<blockquote>
<ol>
<li>fast forward 18 months 一段时间之后</li>
<li>to the point where 到了连。。。的程度</li>
</ol>
</blockquote>
<p>Few investors think a bubble will burst Thursday, when <a href="https://www.wsj.com/articles/ecb-must-strike-right-balance-in-scaling-back-bond-purchases-1508837400" target="_blank" rel="external">the ECB is widely expected to announce plans to trim its asset purchases </a>of €60 billion a month. But the fact that corporate bonds now trade around levels not seen since before the financial crisis makes many uneasy about the market’s long-term trajectory.</p>
<blockquote>
<ol>
<li>market’s long term trajectory 市场的长期发展</li>
</ol>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://joyride2017.github.io/note/note/2017/10/21/data-manipulating/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="n0body">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/note/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Local Playground">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/note/2017/10/21/data-manipulating/" itemprop="url">Data mingling</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-21T23:40:11-05:00">
                2017-10-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>Reference: <a href="https://chrisalbon.com/python/pandas_join_merge_dataframe.html" target="_blank" rel="external">Chris Albon</a></p>
<h4 id="Data-manipulating"><a href="#Data-manipulating" class="headerlink" title="Data manipulating"></a>Data manipulating</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</div><div class="line"></div><div class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</div><div class="line"><span class="keyword">import</span> pandas</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># data set 1: names and ID numbers</span></div><div class="line">raw_data = &#123;</div><div class="line">        <span class="string">'subject_id'</span>: [<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>],</div><div class="line">        <span class="string">'first_name'</span>: [<span class="string">'Alex'</span>, <span class="string">'Amy'</span>, <span class="string">'Allen'</span>, <span class="string">'Alice'</span>, <span class="string">'Ayoung'</span>],</div><div class="line">        <span class="string">'last_name'</span>: [<span class="string">'Anderson'</span>, <span class="string">'Ackerman'</span>, <span class="string">'Ali'</span>, <span class="string">'Aoni'</span>, <span class="string">'Atiches'</span>]&#125;</div><div class="line">df_a = pd.DataFrame(raw_data, columns = [<span class="string">'subject_id'</span>, <span class="string">'first_name'</span>, <span class="string">'last_name'</span>])</div><div class="line">df_a</div></pre></td></tr></table></figure>
<p><img src="s1e01.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># data set 2: more names and ID numbers</span></div><div class="line">raw_data = &#123;</div><div class="line">        <span class="string">'subject_id'</span>: [<span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'6'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>],</div><div class="line">        <span class="string">'first_name'</span>: [<span class="string">'Billy'</span>, <span class="string">'Brian'</span>, <span class="string">'Bran'</span>, <span class="string">'Bryce'</span>, <span class="string">'Betty'</span>],</div><div class="line">        <span class="string">'last_name'</span>: [<span class="string">'Bonder'</span>, <span class="string">'Black'</span>, <span class="string">'Balwner'</span>, <span class="string">'Brice'</span>, <span class="string">'Btisan'</span>]&#125;</div><div class="line">df_b = pd.DataFrame(raw_data, columns = [<span class="string">'subject_id'</span>, <span class="string">'first_name'</span>, <span class="string">'last_name'</span>])</div><div class="line">df_b</div></pre></td></tr></table></figure>
<p><img src="s1e02.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># data set 3: Only test scores and ID numbers without names</span></div><div class="line">raw_data = &#123;</div><div class="line">        <span class="string">'subject_id'</span>: [<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>, <span class="string">'4'</span>, <span class="string">'5'</span>, <span class="string">'7'</span>, <span class="string">'8'</span>, <span class="string">'9'</span>, <span class="string">'10'</span>, <span class="string">'11'</span>],</div><div class="line">        <span class="string">'test_id'</span>: [<span class="number">51</span>, <span class="number">15</span>, <span class="number">15</span>, <span class="number">61</span>, <span class="number">16</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">61</span>, <span class="number">16</span>]&#125;</div><div class="line">df_grade = pd.DataFrame(raw_data, columns = [<span class="string">'subject_id'</span>,<span class="string">'test_id'</span>])</div><div class="line">df_grade</div></pre></td></tr></table></figure>
<p><img src="s1e03.png" alt=""></p>
<h5 id="Join-the-two-dataframes-along-rows"><a href="#Join-the-two-dataframes-along-rows" class="headerlink" title="Join the two dataframes along rows"></a>Join the two dataframes along rows</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># First, join the two distinctive data sets with only names and ID numbers</span></div><div class="line">df_roster = pd.concat([df_a, df_b])</div><div class="line">df_roster</div></pre></td></tr></table></figure>
<p><img src="s1e04.png" alt=""></p>
<h5 id="Join-the-two-dataframes-along-columns"><a href="#Join-the-two-dataframes-along-columns" class="headerlink" title="Join the two dataframes along columns"></a>Join the two dataframes along columns</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.concat([df_a, df_b], axis=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e05.png" alt=""></p>
<h5 id="Join-a-collection-of-series-into-data-frame"><a href="#Join-a-collection-of-series-into-data-frame" class="headerlink" title="Join a collection of series into data frame"></a>Join a collection of series into data frame</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">s1 = Series([<span class="number">0</span>, <span class="number">1</span>], index=[<span class="string">'a'</span>, <span class="string">'b'</span>])</div><div class="line">s2 = Series([<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], index=[<span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</div><div class="line">s3 = Series([<span class="number">5</span>, <span class="number">6</span>], index=[<span class="string">'f'</span>, <span class="string">'g'</span>])</div><div class="line"></div><div class="line">pd.concat([s1, s2, s3])</div></pre></td></tr></table></figure>
<p><img src="s1e18.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.concat([s1, s2, s3], axis=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e19.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">s4 = pd.concat([s1 * <span class="number">5</span>, s3])</div><div class="line">pd.concat([s1, s4], axis=<span class="number">1</span>, join=<span class="string">'outer'</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e19.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.concat([s1, s4], axis=<span class="number">1</span>, join_axes=[[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>, <span class="string">'e'</span>]])</div></pre></td></tr></table></figure>
<p><img src="s1e21.png" alt=""></p>
<h5 id="Merge-two-dataframes-along-the-subject-id-value"><a href="#Merge-two-dataframes-along-the-subject-id-value" class="headerlink" title="Merge two dataframes along the subject_id value"></a>Merge two dataframes along the subject_id value</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(df_roster, df_grade, on=<span class="string">'subject_id'</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e06.png" alt=""></p>
<h5 id="Merge-with-key-named-differently-across-data-frames"><a href="#Merge-with-key-named-differently-across-data-frames" class="headerlink" title="Merge with key named differently across data frames"></a>Merge with key named differently across data frames</h5><p>Suppose column subject_id in data frame df_roster is renamed as sub_id. How do we get the same merge as above?<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># revised df_roster</span></div><div class="line">df_roster.rename(columns=&#123;<span class="string">'subject_id'</span>:<span class="string">'sub_id'</span>&#125;, inplace=<span class="keyword">True</span>)</div><div class="line">df_roster</div></pre></td></tr></table></figure></p>
<p><img src="s1e07.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># merge: sub_id is equivalent to subject_id</span></div><div class="line">pd.merge(df_roster, df_grade, left_on=<span class="string">'sub_id'</span>, right_on=<span class="string">'subject_id'</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e08.png" alt=""></p>
<h5 id="Merge-with-outer-join"><a href="#Merge-with-outer-join" class="headerlink" title="Merge with outer join"></a>Merge with outer join</h5><blockquote>
<p>Full outer join produces the set of all records in Table A and Table B, with matching records from both sides where available. If there is no match, the missing side will contain null.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(df_a, df_b, on=<span class="string">'subject_id'</span>, how=<span class="string">'outer'</span>)</div></pre></td></tr></table></figure></p>
</blockquote>
<p><img src="s1e09.png" alt=""></p>
<h5 id="Merge-with-inner-join"><a href="#Merge-with-inner-join" class="headerlink" title="Merge with inner join"></a>Merge with inner join</h5><p>Inner join produces only the set of records that match in both Table A and Table B.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(df_a, df_b, on=<span class="string">'subject_id'</span>, how=<span class="string">'inner'</span>)</div></pre></td></tr></table></figure></p>
<h5 id="Merge-with-right-join"><a href="#Merge-with-right-join" class="headerlink" title="Merge with right join"></a>Merge with right join</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(df_a, df_b, on=<span class="string">'subject_id'</span>, how=<span class="string">'right'</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e10.png" alt=""></p>
<h5 id="Merge-while-adding-a-suffix-to-duplicate-column-names"><a href="#Merge-while-adding-a-suffix-to-duplicate-column-names" class="headerlink" title="Merge while adding a suffix to duplicate column names"></a>Merge while adding a suffix to duplicate column names</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(df_a, df_b, on=<span class="string">'subject_id'</span>, how=<span class="string">'left'</span>, suffixes=(<span class="string">'_A'</span>, <span class="string">'_B'</span>))</div></pre></td></tr></table></figure>
<p><img src="s1e11.png" alt=""></p>
<h5 id="Merge-based-on-indexes"><a href="#Merge-based-on-indexes" class="headerlink" title="Merge based on indexes"></a>Merge based on indexes</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">df_wide = pd.merge(df_a, df_b, right_index=<span class="keyword">True</span>, left_index=<span class="keyword">True</span>)</div><div class="line">df_wide</div></pre></td></tr></table></figure>
<p><img src="s1e12.png" alt=""></p>
<h5 id="Merge-with-multiple-keys"><a href="#Merge-with-multiple-keys" class="headerlink" title="Merge with multiple keys"></a>Merge with multiple keys</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(df_a, df_b, on=[<span class="string">'first_name'</span>,<span class="string">'last_name'</span>], how=<span class="string">'outer'</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e13.png" alt=""></p>
<h5 id="Merge-with-mixed-types-of-keys"><a href="#Merge-with-mixed-types-of-keys" class="headerlink" title="Merge with mixed types of keys"></a>Merge with mixed types of keys</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">df_group = DataFrame(&#123;<span class="string">'groups'</span>:[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>],</div><div class="line">                      <span class="string">'points'</span>:[<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>,<span class="number">40</span>,<span class="number">50</span>]&#125;)</div><div class="line"></div><div class="line">pd.merge(df_wide,df_group,left_index=<span class="keyword">True</span>,right_on=<span class="string">'groups'</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e14.png" alt=""></p>
<h5 id="Merge-with-hierarchically-indexed-data"><a href="#Merge-with-hierarchically-indexed-data" class="headerlink" title="Merge with hierarchically-indexed data"></a>Merge with hierarchically-indexed data</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">lefth = DataFrame(&#123;<span class="string">'States'</span>: [<span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Nevada'</span>, <span class="string">'Nevada'</span>],</div><div class="line">                   <span class="string">'Years'</span>: [<span class="number">2000</span>, <span class="number">2001</span>, <span class="number">2002</span>, <span class="number">2001</span>, <span class="number">2002</span>],</div><div class="line">                   <span class="string">'data'</span>: np.arange(<span class="number">5.</span>)&#125;)</div><div class="line">righth = DataFrame(np.arange(<span class="number">12</span>).reshape((<span class="number">6</span>, <span class="number">2</span>)),</div><div class="line">                   index=[[<span class="string">'Nevada'</span>, <span class="string">'Nevada'</span>, <span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>],</div><div class="line">                          [<span class="number">2001</span>, <span class="number">2000</span>, <span class="number">2000</span>, <span class="number">2000</span>, <span class="number">2001</span>, <span class="number">2002</span>]],</div><div class="line">                   columns=[<span class="string">'event1'</span>, <span class="string">'event2'</span>])</div><div class="line">lefth</div><div class="line">righth</div></pre></td></tr></table></figure>
<p><img src="s1e15.png" alt=""><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pd.merge(lefth, righth, left_on=[<span class="string">'States'</span>, <span class="string">'Years'</span>], right_index=<span class="keyword">True</span>,how=<span class="string">'outer'</span>)</div></pre></td></tr></table></figure></p>
<p><img src="s1e16.png" alt=""></p>
<h5 id="Using-the-indexes-of-both-sides-of-the-merge"><a href="#Using-the-indexes-of-both-sides-of-the-merge" class="headerlink" title="Using the indexes of both sides of the merge"></a>Using the indexes of both sides of the merge</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">left2 = DataFrame([[<span class="number">1.</span>, <span class="number">2.</span>], [<span class="number">3.</span>, <span class="number">4.</span>], [<span class="number">5.</span>, <span class="number">6.</span>]], index=[<span class="string">'1998'</span>, <span class="string">'1999'</span>, <span class="string">'2002'</span>],</div><div class="line">                 columns=[<span class="string">'Ohio'</span>, <span class="string">'Nevada'</span>])</div><div class="line">right2 = DataFrame([[<span class="number">7.</span>, <span class="number">8.</span>], [<span class="number">9.</span>, <span class="number">10.</span>], [<span class="number">11.</span>, <span class="number">12.</span>], [<span class="number">13</span>, <span class="number">14</span>]],</div><div class="line">                 index=[<span class="string">'1999'</span>, <span class="string">'2000'</span>, <span class="string">'2001'</span>, <span class="string">'2002'</span>], columns=[<span class="string">'Missouri'</span>, <span class="string">'Alabama'</span>])</div><div class="line"></div><div class="line">pd.merge(left2, right2, left_index=<span class="keyword">True</span>, right_index=<span class="keyword">True</span>, how=<span class="string">'inner'</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e17.png" alt=""></p>
<h5 id="Replace-missing-values"><a href="#Replace-missing-values" class="headerlink" title="Replace missing values"></a>Replace missing values</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">a = Series([np.nan, <span class="number">2.5</span>, np.nan, <span class="number">3.5</span>, <span class="number">4.5</span>, np.nan],</div><div class="line">           index=[<span class="string">'f'</span>, <span class="string">'e'</span>, <span class="string">'d'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>])</div><div class="line">b = Series(np.arange(len(a), dtype=np.float64),</div><div class="line">           index=[<span class="string">'f'</span>, <span class="string">'e'</span>, <span class="string">'d'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>])</div><div class="line">b[<span class="number">-1</span>] = np.nan</div><div class="line"></div><div class="line">a</div><div class="line"></div><div class="line">b</div></pre></td></tr></table></figure>
<p><img src="s1e22.png" alt=""></p>
<p>Replacing missing values of <strong>a</strong> with counterparts of <strong>b</strong>:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">c = np.where(pd.isnull(a), b, a)</div><div class="line">Series(c,index=[<span class="string">'f'</span>, <span class="string">'e'</span>, <span class="string">'d'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>])</div></pre></td></tr></table></figure></p>
<p><img src="s1e23.png" alt=""></p>
<p>Updating partial series:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">d = b[:<span class="number">-2</span>].combine_first(a[<span class="number">2</span>:])</div><div class="line">Series(d,index=[<span class="string">'f'</span>, <span class="string">'e'</span>, <span class="string">'d'</span>, <span class="string">'c'</span>, <span class="string">'b'</span>])</div></pre></td></tr></table></figure></p>
<p><img src="s1e24.png" alt=""></p>
<h5 id="Reshaping-with-hierarchical-indexing"><a href="#Reshaping-with-hierarchical-indexing" class="headerlink" title="Reshaping with hierarchical indexing"></a>Reshaping with hierarchical indexing</h5><p>Hierarchical indexing provides a consistent way to rearrange data in a DataFrame. There are two primary actions:</p>
<ul>
<li>stack: this <code>rotates</code> or pivots from the columns in the data to the rows.</li>
<li>unstack: this pivots from the rows into the columns.<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(np.arange(<span class="number">6</span>).reshape((<span class="number">2</span>, <span class="number">3</span>)),</div><div class="line">                 index=pd.Index([<span class="string">'Ohio'</span>, <span class="string">'Colorado'</span>], name=<span class="string">'state'</span>),</div><div class="line">                 columns=pd.Index([<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>], name=<span class="string">'number'</span>))</div><div class="line">data</div></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="s1e25.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">result = data.stack()</div><div class="line">result</div></pre></td></tr></table></figure>
<p><img src="s1e26.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">result.unstack() <span class="comment"># revert the stacking process</span></div><div class="line"></div><div class="line">result.unstack(<span class="number">0</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e27.png" alt=""><br>Similar to <code>unstack</code>:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">result.unstack(<span class="string">'state'</span>)</div></pre></td></tr></table></figure></p>
<p><img src="s1e28.png" alt=""></p>
<h5 id="Merge-with-hierarchical-indexing"><a href="#Merge-with-hierarchical-indexing" class="headerlink" title="Merge with hierarchical indexing"></a>Merge with hierarchical indexing</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data_a = Series([<span class="string">'a1'</span>, <span class="string">'a2'</span>, <span class="string">'a3'</span>, <span class="string">'a4'</span>], index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</div><div class="line">data_b = Series([<span class="string">'b4'</span>, <span class="string">'b5'</span>, <span class="string">'b6'</span>], index=[<span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</div><div class="line">data2 = pd.concat([data_a, data_b], keys=[<span class="string">'one'</span>, <span class="string">'two'</span>])</div><div class="line">data2</div></pre></td></tr></table></figure>
<p><img src="s1e29.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data2.unstack()</div></pre></td></tr></table></figure>
<p><img src="s1e30.png" alt=""></p>
<p>Stacking filters out missing data by default:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data2.unstack().stack()</div></pre></td></tr></table></figure></p>
<p><img src="s1e31.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data2.unstack().stack(dropna=<span class="keyword">False</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e32.png" alt=""></p>
<h5 id="When-unstacking-in-a-DataFrame-the-level-unstacked-becomes-the-lowest-level-in-the-result"><a href="#When-unstacking-in-a-DataFrame-the-level-unstacked-becomes-the-lowest-level-in-the-result" class="headerlink" title="When unstacking in a DataFrame, the level unstacked becomes the lowest level in the result:"></a>When unstacking in a DataFrame, the level unstacked becomes the lowest level in the result:</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># preparation</span></div><div class="line">data = DataFrame(np.arange(<span class="number">6</span>).reshape((<span class="number">2</span>, <span class="number">3</span>)),</div><div class="line">                 index=pd.Index([<span class="string">'Ohio'</span>, <span class="string">'Colorado'</span>], name=<span class="string">'state'</span>),</div><div class="line">                 columns=pd.Index([<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>], name=<span class="string">'number'</span>))</div><div class="line">result = data.stack()</div><div class="line">result</div><div class="line"></div><div class="line">df = DataFrame(&#123;<span class="string">'left'</span>: result, <span class="string">'right'</span>: result + <span class="number">5</span>&#125;,</div><div class="line">               columns=pd.Index([<span class="string">'left'</span>, <span class="string">'right'</span>], name=<span class="string">'side'</span>))</div><div class="line">df</div></pre></td></tr></table></figure>
<p><img src="s1e33.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.unstack(<span class="string">'state'</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e34.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.unstack(<span class="string">'state'</span>).stack(<span class="string">'side'</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e35.png" alt=""></p>
<h5 id="Pivoting-LONG-to-WIDE-format"><a href="#Pivoting-LONG-to-WIDE-format" class="headerlink" title="Pivoting LONG to WIDE format"></a>Pivoting LONG to WIDE format</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os</div><div class="line">os.chdir(<span class="string">'F:/note/source/_posts/Data-manipulating'</span>)</div><div class="line">data = pd.read_csv(<span class="string">'data/macrodata.csv'</span>)</div><div class="line">data.head(<span class="number">5</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e36.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (continued)</span></div><div class="line">periods = pd.PeriodIndex(year=data.year, quarter=data.quarter, name=<span class="string">'date'</span>)</div><div class="line"></div><div class="line">data = DataFrame(data.to_records(),</div><div class="line">                 columns=pd.Index([<span class="string">'realgdp'</span>, <span class="string">'infl'</span>, <span class="string">'unemp'</span>], name=<span class="string">'item'</span>),</div><div class="line">                 index=periods.to_timestamp(<span class="string">'D'</span>, <span class="string">'end'</span>))</div><div class="line"></div><div class="line">data.head(<span class="number">5</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e37.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># long format</span></div><div class="line">ldata = data.stack().reset_index().rename(columns=&#123;<span class="number">0</span>: <span class="string">'value1'</span>&#125;)</div><div class="line"><span class="comment"># wide format</span></div><div class="line">wdata = ldata.pivot(<span class="string">'date'</span>, <span class="string">'item'</span>, <span class="string">'value1'</span>)</div><div class="line"></div><div class="line">ldata.head(<span class="number">5</span>)</div><div class="line"></div><div class="line">wdata.head(<span class="number">5</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e42.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pivoted = ldata.pivot(<span class="string">'date'</span>, <span class="string">'item'</span>, <span class="string">'value1'</span>)</div><div class="line">pivoted.head()</div></pre></td></tr></table></figure>
<p><img src="s1e39.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ldata[<span class="string">'value2'</span>] = np.random.randn(len(ldata))</div><div class="line">ldata.head(<span class="number">5</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e43.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pivoted = ldata.pivot(<span class="string">'date'</span>, <span class="string">'item'</span>)</div><div class="line">pivoted.head(<span class="number">5</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e44.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pivoted[<span class="string">'value1'</span>][:<span class="number">5</span>]</div></pre></td></tr></table></figure>
<p><img src="s1e45.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># similarly</span></div><div class="line">ldata.head(<span class="number">5</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e46.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (continued)</span></div><div class="line">unstacked = ldata.set_index([<span class="string">'date'</span>, <span class="string">'item'</span>]).unstack(<span class="string">'item'</span>)</div><div class="line">unstacked.head(<span class="number">5</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e47.png" alt=""></p>
<h5 id="Removing-duplicates"><a href="#Removing-duplicates" class="headerlink" title="Removing duplicates"></a>Removing duplicates</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(&#123;<span class="string">'k1'</span>: [<span class="string">'one'</span>] * <span class="number">3</span> + [<span class="string">'two'</span>] * <span class="number">4</span>,</div><div class="line">                  <span class="string">'k2'</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>]&#125;)</div><div class="line">data</div></pre></td></tr></table></figure>
<p><img src="s1e48.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.duplicated()</div></pre></td></tr></table></figure>
<p><img src="s1e49.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">data.drop_duplicates()</div></pre></td></tr></table></figure>
<p><img src="s1e50.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data[<span class="string">'v1'</span>] = range(<span class="number">7</span>)</div><div class="line">data</div><div class="line">data.drop_duplicates([<span class="string">'k1'</span>])</div></pre></td></tr></table></figure>
<p><img src="s1e51.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data</div><div class="line">data.drop_duplicates([<span class="string">'k1'</span>, <span class="string">'k2'</span>], keep=<span class="string">'last'</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e53.png" alt=""></p>
<h5 id="Data-recoding"><a href="#Data-recoding" class="headerlink" title="Data recoding"></a>Data recoding</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(&#123;<span class="string">'food'</span>: [<span class="string">'bacon'</span>, <span class="string">'pulled pork'</span>, <span class="string">'bacon'</span>, <span class="string">'Pastrami'</span>,</div><div class="line">                           <span class="string">'corned beef'</span>, <span class="string">'Bacon'</span>, <span class="string">'pastrami'</span>, <span class="string">'honey ham'</span>,</div><div class="line">                           <span class="string">'nova lox'</span>],</div><div class="line">                  <span class="string">'ounces'</span>: [<span class="number">4</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">6</span>, <span class="number">7.5</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>]&#125;)</div><div class="line">data</div><div class="line"></div><div class="line">meat_to_animal = &#123;</div><div class="line">  <span class="string">'bacon'</span>: <span class="string">'pig'</span>,</div><div class="line">  <span class="string">'pulled pork'</span>: <span class="string">'pig'</span>,</div><div class="line">  <span class="string">'pastrami'</span>: <span class="string">'cow'</span>,</div><div class="line">  <span class="string">'corned beef'</span>: <span class="string">'cow'</span>,</div><div class="line">  <span class="string">'honey ham'</span>: <span class="string">'pig'</span>,</div><div class="line">  <span class="string">'nova lox'</span>: <span class="string">'salmon'</span>&#125;</div></pre></td></tr></table></figure>
<p><img src="s1e54.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data[<span class="string">'animal_1'</span>] = data[<span class="string">'food'</span>].map(str.lower).map(meat_to_animal)</div><div class="line">data</div></pre></td></tr></table></figure>
<p><img src="s1e56.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># similarly</span></div><div class="line">data[<span class="string">'animal_2'</span>] = data[<span class="string">'food'</span>].map(<span class="keyword">lambda</span> x: meat_to_animal[x.lower()])</div><div class="line">data</div></pre></td></tr></table></figure>
<p><img src="s1e57.png" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://joyride2017.github.io/note/note/2017/10/01/groupby/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="n0body">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/note/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Local Playground">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/note/2017/10/01/groupby/" itemprop="url">Grouping data in Python</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-01T23:30:38-05:00">
                2017-10-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><span>$$\alpha \beta \gamma$$</span><!-- Has MathJax -->
<h4 id="Groupby"><a href="#Groupby" class="headerlink" title="Groupby"></a>Groupby</h4><p>Reference: <a href="https://pandas.pydata.org/pandas-docs/stable/groupby.html" target="_blank" rel="external">pandas</a></p>
<p>By “group by”, we are referring to a process involving one or more of the following steps:</p>
<ul>
<li>Splitting the data into groups based on some criteria</li>
<li>Applying a function to each group independently</li>
<li>Combining the results into a data structure</li>
</ul>
<p>In the apply step, we might wish to one of the following:</p>
<ul>
<li>Aggregation: computing a <code>summary statistic</code> (or statistics) about each group. Some examples:<ul>
<li>Compute group sums or means</li>
<li>Compute group sizes / counts</li>
</ul>
</li>
<li>Transformation: perform some group-specific computations and return a like-indexed. Some examples:<ul>
<li>Standardizing data (zscore) <code>within</code> groups</li>
<li>Filling NAs within groups with a value <code>derived from each</code> groups</li>
</ul>
</li>
<li>Filtration: discard some groups, according to a group-wsie computation that evaluates True or False. Some examples:<ul>
<li><code>Discarding</code> data that belongs to groups with only a few membership</li>
<li><code>Filtering out</code> data based on the group sum or mean</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</div></pre></td></tr></table></figure>
<p>Suppose we have a data frame:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">df = DataFrame(&#123;<span class="string">'key1'</span> : [<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>],</div><div class="line">                <span class="string">'key2'</span> : [<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'one'</span>],</div><div class="line">                <span class="string">'data1'</span> : np.random.randn(<span class="number">5</span>),</div><div class="line">                <span class="string">'data2'</span> : np.random.randn(<span class="number">5</span>)&#125;)</div><div class="line">df</div></pre></td></tr></table></figure></p>
<p><img src="s1e01.png" alt=""></p>
<h5 id="Group-by-columns"><a href="#Group-by-columns" class="headerlink" title="Group by columns"></a>Group by columns</h5><p>To get the mean of data1 by groups of key1:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># case 1</span></div><div class="line"><span class="comment"># grouped = df['data1'].groupby('key1') is wrong.</span></div><div class="line"><span class="comment"># The above quick command only applies to DataFrame</span></div><div class="line"><span class="comment"># This's the correct one:</span></div><div class="line">grouped = df[<span class="string">'data1'</span>].groupby(df[<span class="string">'key1'</span>])</div><div class="line">grouped.mean()</div></pre></td></tr></table></figure></p>
<p><img src="s1e02.png" alt=""></p>
<h6 id="Mean"><a href="#Mean" class="headerlink" title="Mean"></a>Mean</h6><p>To get the mean of data1 by groups of the pair of key1 and key2:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># case 2: multiple grouping keys</span></div><div class="line">means = df[<span class="string">'data1'</span>].groupby([df[<span class="string">'key1'</span>], df[<span class="string">'key2'</span>]]).mean()</div><div class="line">means</div></pre></td></tr></table></figure></p>
<p><img src="s1e03.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># case 3: equivalently,</span></div><div class="line">df.groupby([<span class="string">'key1'</span>,<span class="string">'key2'</span>])[<span class="string">'data1'</span>].mean()</div></pre></td></tr></table></figure>
<p><img src="p-basic-70.png" alt=""></p>
<p>Using groupby on DataFrame instead of Series, <code>column names</code> as arguments are acceptable:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># case 1</span></div><div class="line">df.groupby(<span class="string">'key1'</span>).mean()</div></pre></td></tr></table></figure></p>
<p><img src="s1e05.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># case 2: a resulting DataFrame with hierarchical index</span></div><div class="line">df.groupby([<span class="string">'key1'</span>, <span class="string">'key2'</span>]).mean()</div></pre></td></tr></table></figure>
<p><img src="s1e06.png" alt=""></p>
<h6 id="Return-size"><a href="#Return-size" class="headerlink" title="Return size"></a>Return size</h6><p>To obtain the summary of group size:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.groupby([<span class="string">'key1'</span>, <span class="string">'key2'</span>]).size()</div></pre></td></tr></table></figure></p>
<p><img src="s1e07.png" alt=""></p>
<h6 id="By-external-levels"><a href="#By-external-levels" class="headerlink" title="By external levels"></a>By external levels</h6><p>To set up grouping attributes for each entry by external ndarray:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># New data</span></div><div class="line">states = np.array([<span class="string">'Ohio'</span>, <span class="string">'California'</span>, <span class="string">'California'</span>, <span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>])</div><div class="line">years = np.array([<span class="number">2005</span>, <span class="number">2005</span>, <span class="number">2006</span>, <span class="number">2005</span>, <span class="number">2006</span>])</div><div class="line">df[<span class="string">'data1'</span>].groupby([states, years]).mean()</div><div class="line">df</div></pre></td></tr></table></figure></p>
<p><img src="s1e04.png" alt=""></p>
<h5 id="Iterate-on-group-items"><a href="#Iterate-on-group-items" class="headerlink" title="Iterate on group items"></a>Iterate on group items</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (continued)</span></div><div class="line"><span class="keyword">for</span> name, group <span class="keyword">in</span> df.groupby(<span class="string">'key1'</span>):</div><div class="line">    print(name) <span class="comment"># the levels (codes) in key1</span></div><div class="line">    print(group) <span class="comment"># the corresponding summary of columns other than key1</span></div><div class="line"></div><div class="line"><span class="comment"># the idea can be extended to multiple keys:</span></div><div class="line"><span class="keyword">for</span> (k1, k2), group <span class="keyword">in</span> df.groupby([<span class="string">'key1'</span>, <span class="string">'key2'</span>]):</div><div class="line">    print((k1, k2))</div><div class="line">    print(group)</div></pre></td></tr></table></figure>
<p><img src="s1e08.png" alt=""></p>
<p>To display group information in Dictionary format:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">pieces = dict(list(df.groupby(<span class="string">'key1'</span>))) <span class="comment"># each level of key1 turns out to be keys in the created dictionary.</span></div><div class="line">pieces <span class="comment"># the whole grouped data</span></div><div class="line">pieces[<span class="string">'b'</span>] <span class="comment"># only have two entries</span></div></pre></td></tr></table></figure></p>
<p><img src="s1e10.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.dtypes</div></pre></td></tr></table></figure>
<p><img src="s1e11.png" alt=""></p>
<h5 id="Group-by-data-types"><a href="#Group-by-data-types" class="headerlink" title="Group by data types"></a>Group by data types</h5><p>This trick can be used for renaming columns or indexes.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># axis=1 refers to column wise operations, because columns pooled with columns of the same type together.</span></div><div class="line">grouped = df.groupby(df.dtypes, axis=<span class="number">1</span>)</div><div class="line">dict(list(grouped))</div></pre></td></tr></table></figure></p>
<p><img src="s1e12.png" alt=""></p>
<h5 id="Outputs-series-vs-dataframe"><a href="#Outputs-series-vs-dataframe" class="headerlink" title="Outputs: series vs dataframe"></a>Outputs: series vs dataframe</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">df</div><div class="line"><span class="comment"># return series</span></div><div class="line">df.groupby(<span class="string">'key1'</span>)[<span class="string">'data1'</span>].mean()</div><div class="line"><span class="comment"># return data frame</span></div><div class="line">df.groupby(<span class="string">'key1'</span>)[[<span class="string">'data2'</span>]].mean()</div></pre></td></tr></table></figure>
<p><img src="s1e13.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># are syntactic sugar for</span></div><div class="line">df[<span class="string">'data1'</span>].groupby(df[<span class="string">'key1'</span>]).describe()</div><div class="line">df[[<span class="string">'data2'</span>]].groupby(df[<span class="string">'key1'</span>]).describe()</div></pre></td></tr></table></figure>
<p><img src="s1e15.png" alt=""></p>
<h6 id="By-multiple-keys"><a href="#By-multiple-keys" class="headerlink" title="By multiple keys"></a>By multiple keys</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># return a grouped data frame</span></div><div class="line">df.groupby([<span class="string">'key1'</span>, <span class="string">'key2'</span>])[[<span class="string">'data2'</span>]].mean()</div><div class="line"><span class="comment"># return a grouped series</span></div><div class="line">s_grouped = df.groupby([<span class="string">'key1'</span>, <span class="string">'key2'</span>])[<span class="string">'data2'</span>]</div><div class="line">s_grouped.mean()</div></pre></td></tr></table></figure>
<p><img src="s1e16.png" alt=""></p>
<h5 id="Grouping-columns"><a href="#Grouping-columns" class="headerlink" title="Grouping columns"></a>Grouping columns</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">people = DataFrame(np.random.randn(<span class="number">5</span>, <span class="number">5</span>),</div><div class="line">                   columns=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>],</div><div class="line">                   index=[<span class="string">'Joe'</span>, <span class="string">'Steve'</span>, <span class="string">'Wes'</span>, <span class="string">'Jim'</span>, <span class="string">'Travis'</span>])</div><div class="line"></div><div class="line">people.loc[<span class="number">2</span>:<span class="number">3</span>, [<span class="string">'b'</span>, <span class="string">'c'</span>]] = np.nan <span class="comment"># Add a few NA values</span></div><div class="line">people</div></pre></td></tr></table></figure>
<p><img src="s1e17.png" alt=""></p>
<p>suppose I have a group correspondence for the columns and want to sum together the columns by group:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mapping = &#123;<span class="string">'a'</span>: <span class="string">'red'</span>, <span class="string">'b'</span>: <span class="string">'red'</span>, <span class="string">'c'</span>: <span class="string">'blue'</span>,</div><div class="line">           <span class="string">'d'</span>: <span class="string">'blue'</span>, <span class="string">'e'</span>: <span class="string">'red'</span>, <span class="string">'f'</span> : <span class="string">'orange'</span>&#125;</div><div class="line"></div><div class="line">by_column = people.groupby(mapping, axis=<span class="number">1</span>)</div><div class="line">by_column.sum()</div></pre></td></tr></table></figure></p>
<p><img src="s1e18.png" alt=""></p>
<p>The same functionality holds for Series, which can be viewed as a fixed size mapping. When I used Series as group keys in the above examples, pandas inspects each Series to ensure that its index is aligned with the axis it’s grouping:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">map_series = Series(mapping)</div><div class="line">map_series</div></pre></td></tr></table></figure></p>
<p><img src="s1e19.png" alt=""></p>
<h6 id="Count-members-of-groups"><a href="#Count-members-of-groups" class="headerlink" title="Count members of groups"></a>Count members of groups</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">people.groupby(map_series, axis=<span class="number">1</span>).count()</div></pre></td></tr></table></figure>
<p><img src="s1e20.png" alt=""></p>
<h5 id="Group-by-functions"><a href="#Group-by-functions" class="headerlink" title="Group by functions"></a>Group by functions</h5><p>Using Python functions is a more generic way of defining a group mapping compared with a dict or Series. Any function passed as a <code>group key</code> will be called once <code>per index value</code>, with the return values being used as the group names.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">people</div><div class="line"><span class="comment"># group by length of string</span></div><div class="line">people.groupby(len).sum()</div></pre></td></tr></table></figure></p>
<p><img src="s1e21.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Mixing functions with arrays, dicts, or Series is not a problem as everything gets converted to arrays internally:</span></div><div class="line">key_list = [<span class="string">'one'</span>, <span class="string">'one'</span>, <span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'two'</span>]</div><div class="line">people.groupby([len, key_list]).min()</div></pre></td></tr></table></figure>
<p><img src="s1e22.png" alt=""></p>
<h5 id="MultiIndexing"><a href="#MultiIndexing" class="headerlink" title="MultiIndexing"></a>MultiIndexing</h5><p>A final convenience for <code>hierarchically-indexed data</code> sets is the ability to <code>aggregate</code> using one of <code>the levels of an axis index</code>. To do this, pass the level number or name using the level keyword:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">columns = pd.MultiIndex.from_arrays([[<span class="string">'US'</span>, <span class="string">'US'</span>, <span class="string">'US'</span>, <span class="string">'JP'</span>, <span class="string">'JP'</span>],</div><div class="line">                                    [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">3</span>]], names=[<span class="string">'cty'</span>, <span class="string">'tenor'</span>])</div><div class="line">hier_df = DataFrame(np.random.randn(<span class="number">4</span>, <span class="number">5</span>), columns=columns)</div><div class="line">hier_df</div></pre></td></tr></table></figure></p>
<p><img src="s1e23.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hier_df.groupby(level=<span class="string">'cty'</span>, axis=<span class="number">1</span>).count()</div></pre></td></tr></table></figure>
<p><img src="s1e24.png" alt=""></p>
<h5 id="Applications-on-groups"><a href="#Applications-on-groups" class="headerlink" title="Applications on groups"></a>Applications on groups</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># operation assignment by function</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">myfunc</span><span class="params">(group)</span>:</span></div><div class="line">    <span class="comment"># only modify cost if there are nan's</span></div><div class="line">    <span class="keyword">if</span> len(group) != group.cost.count():</div><div class="line">        <span class="comment"># set all cost values to the mean</span></div><div class="line">        group[<span class="string">'cost'</span>] = group.cost.sum() / len(group)</div><div class="line">        <span class="comment"># multiply by 1.5 if the duration equals 1</span></div><div class="line">        group[<span class="string">'cost'</span>][group.duration == <span class="number">1</span>] = group[<span class="string">'cost'</span>] * <span class="number">1.5</span></div><div class="line">    <span class="keyword">return</span> group</div><div class="line"><span class="comment"># data set</span></div><div class="line">data = &#123;<span class="string">'duration'</span>: [<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>], <span class="string">'cost'</span>: [<span class="number">180</span>, <span class="number">120</span>, <span class="number">300</span>, np.nan, <span class="number">80</span>, np.nan, np.nan, <span class="number">120</span>, np.nan], <span class="string">'channel'</span>: [<span class="string">'t1'</span>,<span class="string">'t2'</span>,<span class="string">'t3'</span>,<span class="string">'t1'</span>,<span class="string">'t2'</span>,<span class="string">'t3'</span>,<span class="string">'t1'</span>,<span class="string">'t2'</span>,<span class="string">'t3'</span>]&#125;</div><div class="line">frame = DataFrame(data)</div><div class="line">frame</div><div class="line">frame.groupby(<span class="string">'channel'</span>).apply(myfunc)</div></pre></td></tr></table></figure>
<p><img src="p-basic-94.png" alt=""></p>
<h5 id="Data-aggregation"><a href="#Data-aggregation" class="headerlink" title="Data aggregation"></a>Data aggregation</h5><p>Aggregations refer to any data transformation that produces scalar values from arrays. In the examples above I have used several of them, such as <code>mean</code>, <code>count</code>, <code>min</code> and <code>sum</code>.</p>
<h6 id="Divide-row-value-by-aggregated-conditional-sum"><a href="#Divide-row-value-by-aggregated-conditional-sum" class="headerlink" title="Divide row value by aggregated conditional sum"></a>Divide row value by aggregated conditional sum</h6><p>Reference <a href="https://stackoverflow.com/questions/39387954/pandas-divide-row-value-by-aggregated-sum-with-a-condition-set-by-other-cell" target="_blank" rel="external">stackoverflow</a></p>
<h6 id="Quantile"><a href="#Quantile" class="headerlink" title="Quantile"></a>Quantile</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">df = DataFrame(&#123;<span class="string">'key1'</span> : [<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>],</div><div class="line">                <span class="string">'key2'</span> : [<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'one'</span>],</div><div class="line">                <span class="string">'data1'</span> : np.random.randn(<span class="number">5</span>),</div><div class="line">                <span class="string">'data2'</span> : np.random.randn(<span class="number">5</span>)&#125;)</div><div class="line">df</div></pre></td></tr></table></figure>
<p><img src="s1e25.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># While quantile is not explicitly implemented for GroupBy, it is a Series method and thus available for use.</span></div><div class="line">grouped = df.groupby(<span class="string">'key1'</span>)</div><div class="line">grouped[<span class="string">'data1'</span>].quantile(<span class="number">0.9</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e26.png" alt=""></p>
<h6 id="Within-group-statistic"><a href="#Within-group-statistic" class="headerlink" title="Within-group statistic"></a>Within-group statistic</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">peak_to_peak</span><span class="params">(arr)</span>:</span></div><div class="line">    <span class="keyword">return</span> arr.max() - arr.min()</div><div class="line">grouped.agg(peak_to_peak)</div></pre></td></tr></table></figure>
<p><img src="s1e27.png" alt=""></p>
<h6 id="Select-the-first-rows-by-Groups"><a href="#Select-the-first-rows-by-Groups" class="headerlink" title="Select the first rows by Groups"></a>Select the first rows by Groups</h6><p>Reference <a href="https://stackoverflow.com/questions/20067636/pandas-dataframe-get-first-row-of-each-group" target="_blank" rel="external">stackoverflow</a><br>Reference <a href="https://stackoverflow.com/questions/30486417/pandas-how-do-i-select-first-row-in-each-group-by-group" target="_blank" rel="external">stackoverflow</a><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># data</span></div><div class="line">df = pd.DataFrame(&#123;<span class="string">'id'</span> : [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">7</span>],</div><div class="line">                <span class="string">'value'</span>  : [<span class="string">"first"</span>,<span class="string">"second"</span>,<span class="string">"second"</span>,<span class="string">"first"</span>,</div><div class="line">                            <span class="string">"second"</span>,<span class="string">"first"</span>,<span class="string">"third"</span>,<span class="string">"fourth"</span>,</div><div class="line">                            <span class="string">"fifth"</span>,<span class="string">"second"</span>,<span class="string">"fifth"</span>,<span class="string">"first"</span>,</div><div class="line">                            <span class="string">"first"</span>,<span class="string">"second"</span>,<span class="string">"third"</span>,<span class="string">"fourth"</span>,<span class="string">"fifth"</span>]&#125;)</div><div class="line">df</div></pre></td></tr></table></figure></p>
<p><img src="s1e53.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># trick 3.</span></div><div class="line">df[<span class="string">'unit'</span>] = <span class="number">1</span></div><div class="line">dg = df.groupby(<span class="string">'id'</span>)</div><div class="line">df[dg[<span class="string">'unit'</span>].cumsum()==<span class="number">1</span>]</div></pre></td></tr></table></figure>
<p><img src="s1e54.png" alt=""></p>
<h6 id="Select-some-after-sorting-within-groups"><a href="#Select-some-after-sorting-within-groups" class="headerlink" title="Select some after sorting within groups"></a>Select some after sorting within groups</h6><p>Reference <a href="https://stackoverflow.com/questions/27842613/pandas-groupby-sort-within-groups" target="_blank" rel="external">stackoverflow</a></p>
<h6 id="Case-Identifying-consecutive-occurrences"><a href="#Case-Identifying-consecutive-occurrences" class="headerlink" title="Case: Identifying consecutive occurrences"></a>Case: Identifying consecutive occurrences</h6><p>Reference: <a href="http://pbpython.com/pandas_transform.html" target="_blank" rel="external">Understanding the transform function in pandas</a><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># data</span></div><div class="line">data = &#123;<span class="string">'Count'</span>:[<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>]&#125;</div><div class="line">df = DataFrame(data)</div><div class="line">df</div></pre></td></tr></table></figure></p>
<p><img src="s1e50.png" alt=""><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># continued</span></div><div class="line">df.Count != df.Count.shift()</div></pre></td></tr></table></figure></p>
<p><img src="s1e51.png" alt=""><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(df.Count != df.Count.shift()).cumsum()</div></pre></td></tr></table></figure></p>
<p><img src="s1e52.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">df[<span class="string">'consecutive'</span>] = df.Count.groupby((df.Count != df.Count.shift()).cumsum()).transform(<span class="string">'size'</span>)</div><div class="line">df</div><div class="line">df[<span class="string">'consecutive'</span>] = df.Count.groupby((df.Count != df.Count.shift()).cumsum()).transform(<span class="string">'size'</span>) * df.Count <span class="comment"># times the original 0, 1 series to correctly show group number on valid entries.</span></div><div class="line">df</div></pre></td></tr></table></figure>
<p><img src="s1e46.png" alt=""></p>
<p>From here you can get, for any threshold:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">threshold = <span class="number">1</span></div><div class="line">df[<span class="string">'consecutive'</span>] = (df.consecutive &gt; threshold).astype(int)</div><div class="line"><span class="comment"># or in a single step. (df.Count.groupby((df.Count != df.Count.shift()).cumsum()).transform('size') * df.Count &gt;= threshold).astype(int)</span></div><div class="line">df</div></pre></td></tr></table></figure></p>
<p><img src="s1e47.png" alt=""></p>
<p><strong>Efficiency test</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">data = &#123;<span class="string">'Count'</span>:[<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>]&#125;</div><div class="line">df = DataFrame(data)</div><div class="line">df = pd.concat([df <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">10</span>)])</div><div class="line">threshold = <span class="number">1</span></div><div class="line"><span class="comment"># method 1 very efficient</span></div><div class="line">%timeit (df.Count.groupby((df.Count != df.Count.shift()).cumsum()).transform(<span class="string">'size'</span>) * df.Count &gt;= threshold).astype(int) <span class="comment"># 100 loops, best of 3: 3.2 ms per loop</span></div><div class="line"></div><div class="line"><span class="comment"># method 2. for loop. not efficient in terms of computing time.</span></div><div class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span>  groupby</div><div class="line">%timeit</div><div class="line">l = []</div><div class="line"><span class="keyword">for</span> k, g <span class="keyword">in</span> groupby(df.Count):</div><div class="line">    size = sum(<span class="number">1</span> <span class="keyword">for</span> _ <span class="keyword">in</span> g)</div><div class="line">    <span class="keyword">if</span> k == <span class="number">1</span> <span class="keyword">and</span> size &gt;= <span class="number">2</span>:</div><div class="line">        l = l + [<span class="number">1</span>]*size</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        l = l + [<span class="number">0</span>]*size</div><div class="line">pd.Series(l)</div></pre></td></tr></table></figure></p>
<h6 id="Case-identify-discontinuous-values"><a href="#Case-identify-discontinuous-values" class="headerlink" title="Case: identify discontinuous values"></a>Case: identify discontinuous values</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># data</span></div><div class="line">data = &#123;<span class="string">'count'</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>]&#125;</div><div class="line">df = DataFrame(data)</div><div class="line">df</div><div class="line"><span class="comment"># method 1</span></div><div class="line">df[<span class="string">'diff'</span>] = df[<span class="string">'count'</span>].diff()</div><div class="line">sr = df.loc[df[<span class="string">'diff'</span>]&gt;<span class="number">1</span>,<span class="string">'count'</span>].index.tolist()</div><div class="line">dt = df.iloc[sr,:]</div><div class="line">dt</div><div class="line"><span class="comment"># method 2</span></div><div class="line">df[<span class="string">'diff2'</span>] = (df[<span class="string">'count'</span>]!=df[<span class="string">'count'</span>].shift()+<span class="number">1</span>)</div><div class="line">dt = df.loc[df[<span class="string">'diff2'</span>],[<span class="string">'count'</span>,<span class="string">'diff'</span>]]</div><div class="line">dt[<span class="number">1</span>:]</div></pre></td></tr></table></figure>
<p><img src="s1e48.png" alt=""></p>
<h6 id="Case-slice-by-consecutive-instances"><a href="#Case-slice-by-consecutive-instances" class="headerlink" title="Case: slice by consecutive instances"></a>Case: slice by consecutive instances</h6><p><a href="https://stackoverflow.com/questions/33063766/slice-pandas-df-based-on-n-consecutive-instances-of-element" target="_blank" rel="external">stackoverflow</a><br><a href="https://stackoverflow.com/questions/43132008/pandas-how-to-check-consecutive-order-of-dates-and-copy-groups-of-them" target="_blank" rel="external">stackoverflow</a><br><a href="https://stackoverflow.com/questions/46303356/pandas-count-streak-of-values-higher-lower-than-current-rows" target="_blank" rel="external">stackoverflow</a></p>
<h6 id="Exercise-groupby-agg"><a href="#Exercise-groupby-agg" class="headerlink" title="Exercise: groupby, agg"></a>Exercise: groupby, agg</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># You may notice that some methods like describe also work, even though they are not aggregations, strictly speaking:</span></div><div class="line"><span class="keyword">import</span> os</div><div class="line">grouped.describe()</div><div class="line">os.chdir(<span class="string">'F:/note/source/_posts/groupby'</span>)</div><div class="line">tips = pd.read_csv(<span class="string">'tips.csv'</span>)</div><div class="line">tips.head(<span class="number">10</span>)</div><div class="line"><span class="comment"># Add tip percentage of total bill</span></div><div class="line">tips[<span class="string">'tip_pct'</span>] = tips[<span class="string">'tip'</span>] / tips[<span class="string">'total_bill'</span>]</div><div class="line">tips[:<span class="number">6</span>]</div></pre></td></tr></table></figure>
<p><img src="s1e28.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">grouped = tips.groupby([<span class="string">'sex'</span>, <span class="string">'smoker'</span>])</div><div class="line">grouped_pct = grouped[<span class="string">'tip_pct'</span>]</div><div class="line">grouped_pct.agg(<span class="string">'mean'</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e29.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># If you pass a list of functions or function names instead, you get back a DataFrame with column names taken from the functions:</span></div><div class="line">grouped_pct.agg([<span class="string">'mean'</span>, <span class="string">'std'</span>, peak_to_peak])</div></pre></td></tr></table></figure>
<p><img src="s1e30.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># You don’t need to accept the names that GroupBy gives to the columns:</span></div><div class="line">grouped_pct.agg([(<span class="string">'foo'</span>, <span class="string">'mean'</span>), (<span class="string">'bar'</span>, np.std)])</div></pre></td></tr></table></figure>
<p><img src="s1e32.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># With a DataFrame, you have more options as you can specify a list of functions to apply to all of the columns or different functions per column.</span></div><div class="line">functions = [<span class="string">'count'</span>, <span class="string">'mean'</span>, <span class="string">'max'</span>]</div><div class="line">grouped = tips.groupby([<span class="string">'sex'</span>, <span class="string">'smoker'</span>])</div><div class="line">result = grouped[<span class="string">'tip_pct'</span>, <span class="string">'total_bill'</span>].agg(functions)</div><div class="line">result</div></pre></td></tr></table></figure>
<p><img src="s1e33.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">result[<span class="string">'tip_pct'</span>]</div></pre></td></tr></table></figure>
<p><img src="s1e35.png" alt=""></p>
<p>Rename groups:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># As above, a list of tuples with custom names can be passed:</span></div><div class="line">ftuples = [(<span class="string">'Durchschnitt'</span>, <span class="string">'mean'</span>), (<span class="string">'Abweichung'</span>, np.var)]</div><div class="line">grouped[<span class="string">'tip_pct'</span>, <span class="string">'total_bill'</span>].agg(ftuples)</div></pre></td></tr></table></figure></p>
<p><img src="s1e36.png" alt=""><br>More exercises:</p>
<ol>
<li><a href="https://stackoverflow.com/questions/24707208/subtract-subgroup-averages-from-individuals-without-resorting-to-for-loop" target="_blank" rel="external">subtract group mean from respective group</a></li>
<li><a href="https://stackoverflow.com/questions/32832624/how-to-subtract-rows-within-groups-of-a-dataframe" target="_blank" rel="external">subtract rows within groups</a></li>
</ol>
<h6 id="heterogeneous-agg-functions"><a href="#heterogeneous-agg-functions" class="headerlink" title="heterogeneous agg functions"></a>heterogeneous agg functions</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Now, suppose you wanted to apply potentially different functions to one or more of the columns.</span></div><div class="line">grouped.agg(&#123;<span class="string">'tip'</span> : np.max, <span class="string">'size'</span> : <span class="string">'sum'</span>&#125;)</div></pre></td></tr></table></figure>
<p><img src="s1e37.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">grouped.agg(&#123;<span class="string">'tip_pct'</span> : [<span class="string">'min'</span>, <span class="string">'max'</span>, <span class="string">'mean'</span>, <span class="string">'std'</span>],</div><div class="line">             <span class="string">'size'</span> : <span class="string">'sum'</span>&#125;)</div></pre></td></tr></table></figure>
<p><img src="s1e38.png" alt=""></p>
<h6 id="Unindexed"><a href="#Unindexed" class="headerlink" title="Unindexed"></a>Unindexed</h6><p>In all of the examples up until now, the aggregated data comes back with an index, potentially hierarchical, composed from the unique group key combinations observed. Since this isn’t always desirable, you can disable this behavior in most cases by passing as_index=False to groupby:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">tips.groupby([<span class="string">'sex'</span>, <span class="string">'smoker'</span>]).mean()</div><div class="line">tips.groupby([<span class="string">'sex'</span>, <span class="string">'smoker'</span>], as_index=<span class="keyword">False</span>).mean()</div></pre></td></tr></table></figure></p>
<p><img src="s1e39.png" alt=""></p>
<p>Of course, it’s always possible to obtain the result in this format by calling reset_index on the result.</p>
<h6 id="Case-display-the-largest-few-rows"><a href="#Case-display-the-largest-few-rows" class="headerlink" title="Case: display the largest few rows"></a>Case: display the largest few rows</h6><p>Suppose you wanted to select the top five tip_pct values by group. First, write a function that selects the rows with the largest values in a particular column:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tips.head(<span class="number">5</span>)</div></pre></td></tr></table></figure></p>
<p><img src="s1e40.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">top</span><span class="params">(df, n=<span class="number">5</span>, column=<span class="string">'tip_pct'</span>)</span>:</span></div><div class="line">    <span class="keyword">return</span> df.sort_index(by=column)[-n:]</div><div class="line">top(tips, n=<span class="number">6</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e40.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tips.groupby(<span class="string">'smoker'</span>).apply(top)</div></pre></td></tr></table></figure>
<p><img src="s1e42.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tips.groupby([<span class="string">'smoker'</span>, <span class="string">'day'</span>]).apply(top, n=<span class="number">1</span>, column=<span class="string">'total_bill'</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e43.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">result = tips.groupby(<span class="string">'smoker'</span>)[<span class="string">'tip_pct'</span>].describe()</div><div class="line">result</div><div class="line">result.unstack(<span class="string">'smoker'</span>)</div></pre></td></tr></table></figure>
<p><img src="s1e44.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># alternative,</span></div><div class="line">f = <span class="keyword">lambda</span> x: x.std()</div><div class="line">grouped.apply(f)</div></pre></td></tr></table></figure>
<p><img src="s1e45.png" alt=""></p>
<h6 id="Histogram-from-grouped-data"><a href="#Histogram-from-grouped-data" class="headerlink" title="Histogram from grouped data"></a>Histogram from grouped data</h6><p>Reference <a href="https://stackoverflow.com/questions/34878948/how-to-create-histogram-from-grouped-data" target="_blank" rel="external">stackoverflow</a></p>
<h6 id="Group-weighted-stat"><a href="#Group-weighted-stat" class="headerlink" title="Group weighted stat"></a>Group weighted stat</h6><h6 id="Qunatile"><a href="#Qunatile" class="headerlink" title="Qunatile"></a>Qunatile</h6><h6 id="Filling-missing-values"><a href="#Filling-missing-values" class="headerlink" title="Filling missing values"></a>Filling missing values</h6><h6 id="Random-sampling"><a href="#Random-sampling" class="headerlink" title="Random sampling"></a>Random sampling</h6><h6 id="Groupwise-regression"><a href="#Groupwise-regression" class="headerlink" title="Groupwise regression"></a>Groupwise regression</h6><h5 id="Pivot-tables"><a href="#Pivot-tables" class="headerlink" title="Pivot tables"></a>Pivot tables</h5><h5 id="Application-II"><a href="#Application-II" class="headerlink" title="Application II"></a>Application II</h5><h6 id="Raw-data"><a href="#Raw-data" class="headerlink" title="Raw data"></a>Raw data</h6><h6 id="Donation-statistics"><a href="#Donation-statistics" class="headerlink" title="Donation statistics"></a>Donation statistics</h6><h6 id="Bucketing-donation-amounts"><a href="#Bucketing-donation-amounts" class="headerlink" title="Bucketing donation amounts"></a>Bucketing donation amounts</h6><h6 id="Donation-stat-by-state"><a href="#Donation-stat-by-state" class="headerlink" title="Donation stat by state"></a>Donation stat by state</h6>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://joyride2017.github.io/note/note/2017/09/08/python-basics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="n0body">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/note/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Local Playground">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/note/2017/09/08/python-basics/" itemprop="url">Python modules: Numpy & Pandas</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-08T16:13:22-05:00">
                2017-09-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><span>$$\alpha \beta \gamma$$</span><!-- Has MathJax -->
<h1 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h1><h2 id="Library"><a href="#Library" class="headerlink" title="Library"></a>Library</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="comment"># -- matplotlib (1)</span></div><div class="line"><span class="keyword">import</span> matplotlib</div><div class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</div><div class="line"><span class="comment"># import matplotlib.pyplot as plt #! also works</span></div><div class="line"><span class="comment"># -- pandas (2)</span></div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</div><div class="line"><span class="comment"># -- numpy (3)</span></div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</div><div class="line"><span class="keyword">import</span> random</div><div class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choices</div><div class="line">np.random.seed(<span class="number">12321</span>)</div><div class="line"><span class="comment"># np.set_printoptions(precision=4) #</span></div><div class="line"><span class="comment"># -- Jupyter</span></div><div class="line"><span class="comment"># plt.rc('figure', figsize=(10, 6)) # used in Jupyter</span></div></pre></td></tr></table></figure>
<h2 id="Standard-output"><a href="#Standard-output" class="headerlink" title="Standard output"></a>Standard output</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> sys</div><div class="line">sys.stdout = open(<span class="string">'log.txt'</span>, <span class="string">'w'</span>)</div><div class="line"><span class="keyword">print</span> <span class="string">'Write this to file.'</span></div></pre></td></tr></table></figure>
<p>Close the file when you are done writing: sys.stdout.close()</p>
<h2 id="Working-directory"><a href="#Working-directory" class="headerlink" title="Working directory"></a>Working directory</h2><p>OS here refers to the Windows operating system. Jupyter refers to Jupyter Notebook, a web-based application on server-client structure allowing users to create and manipulate .pynb file and execute it through an internet browser.</p>
<h3 id="Change-current-directory"><a href="#Change-current-directory" class="headerlink" title="Change current directory"></a>Change current directory</h3><p>To get the full path to the directory a Python file is contained in, write this in that file:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os</div><div class="line">cwd = os.getcwd()</div></pre></td></tr></table></figure></p>
<p>Documentation references for the modules, constants and functions used above:</p>
<ul>
<li>The <code>os</code> and <code>os.path</code> modules.</li>
<li><code>os.getcwd()</code> (returns “a string representing the current working directory”)</li>
<li><code>os.chdir(&quot;C:/path/to/location&quot;)</code> (“change the current working directory to path”)</li>
</ul>
<p><strong>Use a context manager to change the working directory</strong> Note that changing the current working directory in a subprocess (such as <code>os.chdir(path)</code>) does not change the current working directory in the parent process. This is true of the Python interpreter as well. You cannot use os.chdir() to change the CWD of the calling process. Instead use a context manager and with statement for this task:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> os</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">cd</span>:</span></div><div class="line">    <span class="string">"""Context manager for changing the current working directory"""</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, newPath)</span>:</span></div><div class="line">        self.newPath = os.path.expanduser(newPath)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></div><div class="line">        self.savedPath = os.getcwd()</div><div class="line">        os.chdir(self.newPath)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, etype, value, traceback)</span>:</span></div><div class="line">        os.chdir(self.savedPath)</div></pre></td></tr></table></figure></p>
<p>Example:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> subprocess <span class="comment"># just to call an arbitrary command e.g. 'ls'</span></div><div class="line"></div><div class="line"><span class="comment"># enter the directory like this:</span></div><div class="line"><span class="keyword">with</span> cd(<span class="string">"~/Library"</span>):</div><div class="line">   <span class="comment"># we are in ~/Library</span></div><div class="line">   subprocess.call(<span class="string">"ls"</span>)</div><div class="line"></div><div class="line"><span class="comment"># outside the context manager we are back wherever we started.</span></div></pre></td></tr></table></figure></p>
<h2 id="IDE-for-python"><a href="#IDE-for-python" class="headerlink" title="IDE for python"></a>IDE for python</h2><h3 id="Spyder"><a href="#Spyder" class="headerlink" title="Spyder"></a>Spyder</h3><h4 id="Clear-all-variables-in-Spyder"><a href="#Clear-all-variables-in-Spyder" class="headerlink" title="Clear all variables in Spyder"></a>Clear all variables in Spyder</h4><p>Simply type <code>%reset</code>. For removing a particular variable <code>bar</code>, use <code>del bar</code>.</p>
<h4 id="Autocompletion-amp-search"><a href="#Autocompletion-amp-search" class="headerlink" title="Autocompletion &amp; search"></a>Autocompletion &amp; search</h4><p><strong>Tab.</strong> Python shell is tab completion, a feature common to most interactive data analysis environments. While entering expressions in the shell, pressing <code>&lt;Tab&gt;</code> will search the namespace for any variables (objects, functions, etc.) matching the characters you have typed so far.</p>
<p><strong>Question Mark.</strong> Using a question mark (?) before or after a variable will display some general information about the object. This is referred to as <code>object introspection</code>.</p>
<p><strong>Wildcard.</strong> A number of characters combined with the wildcard <code>(*)</code> will show all names matching the wildcard expression. For example, we could get a list of <code>all functions in the top level NumPy namespace</code> containing <code>load</code><br><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ np.*load*?</div></pre></td></tr></table></figure></p>
<h3 id="Jupyter"><a href="#Jupyter" class="headerlink" title="Jupyter"></a>Jupyter</h3><h4 id="Execute-code-from-the-clipboard"><a href="#Execute-code-from-the-clipboard" class="headerlink" title="Execute code from the clipboard"></a>Execute code from the clipboard</h4><p>Jupyter command <code>%cpaste</code> takes whatever text is in the clipboard and executes it as a single block in the shell.</p>
<h4 id="Dos-mode"><a href="#Dos-mode" class="headerlink" title="Dos mode"></a>Dos mode</h4><p><code>!cmd</code> execute cmd in the system shell and <code>%pwd</code> returns the current system working directory in Jupyter Notebook.</p>
<h4 id="Timing-the-runtime"><a href="#Timing-the-runtime" class="headerlink" title="Timing the runtime"></a>Timing the runtime</h4><p>Timing code by hand using the built-in time module and its functions <code>time.clock</code> and<br><code>time.time</code> is often tedious and repetitive:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Given an arbitrary statement, this method has a heuristic to run a statement multiple times to produce an average runtime.</span></div><div class="line"><span class="keyword">import</span> time</div><div class="line">start = time.time()</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(iterations):</div><div class="line">    <span class="comment"># some code to run here</span></div><div class="line">elapsed_per = (time.time() - start) / iterations</div></pre></td></tr></table></figure></p>
<p>Otherwise, in Jupyter Notebook, two magic functions can automate the process for you: <code>%time</code> and <code>%timeit</code>.</p>
<h2 id="Basic-data-structure"><a href="#Basic-data-structure" class="headerlink" title="Basic data structure"></a>Basic data structure</h2><h3 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h3><h4 id="List-of-floating-point-number"><a href="#List-of-floating-point-number" class="headerlink" title="List of floating point number"></a>List of floating point number</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#method 1 by for loop</span></div><div class="line">list1 = [x/<span class="number">10.0</span> <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">5</span>,<span class="number">100</span>,<span class="number">15</span>)] <span class="comment"># [0.5, 2.0, 3.5, 5.0, 6.5, 8.0, 9.5]</span></div><div class="line">print(len(list1),sum(list1)) <span class="comment"># 7 35.0</span></div><div class="line"></div><div class="line"><span class="comment"># method 2 by map</span></div><div class="line">list2 = map(<span class="keyword">lambda</span> x: x/<span class="number">10.0</span>, range(<span class="number">5</span>,<span class="number">100</span>,<span class="number">15</span>))</div><div class="line">list2 <span class="comment"># not a list yet</span></div><div class="line">list(list2) <span class="comment"># [0.5, 2.0, 3.5, 5.0, 6.5, 8.0, 9.5]</span></div><div class="line"></div><div class="line"><span class="comment"># method 3 by generator</span></div><div class="line"><span class="keyword">import</span> decimal</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">frange</span><span class="params">(x,y,step)</span>:</span></div><div class="line">  <span class="keyword">while</span> x&lt;y:</div><div class="line">    <span class="keyword">yield</span> x</div><div class="line">    x += step</div><div class="line">list(frange(<span class="number">0.5</span>,<span class="number">10.0</span>,<span class="number">1.5</span>)) <span class="comment"># [0.5, 2.0, 3.5, 5.0, 6.5, 8.0, 9.5]</span></div></pre></td></tr></table></figure>
<h4 id="Read-list"><a href="#Read-list" class="headerlink" title="Read    list"></a>Read    list</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># element</span></div><div class="line">x = range(<span class="number">10</span>) <span class="comment"># is the list [0, 1, ..., 9]</span></div><div class="line">zero  = x[<span class="number">0</span>]  <span class="comment"># equals 0, lists are 0-indexed</span></div><div class="line">one   = x[<span class="number">1</span>]  <span class="comment"># equals 1</span></div><div class="line">nine  = x[<span class="number">-1</span>] <span class="comment"># equals 9, 'Pythonic' for last element</span></div><div class="line">eight = x[<span class="number">-2</span>] <span class="comment"># equals 8, 'Pythonic' for next-to-last element</span></div><div class="line">x[<span class="number">0</span>]  = <span class="number">-1</span>    <span class="comment"># now x is [-1, 1, 2, 3, ..., 9]</span></div><div class="line"></div><div class="line"><span class="comment"># segment</span></div><div class="line">first_three  = x[:<span class="number">3</span>]              <span class="comment"># [-1, 1, 2]</span></div><div class="line">three_to_end = x[<span class="number">3</span>:]              <span class="comment"># [3, 4, ..., 9]</span></div><div class="line">one_to_four  = x[<span class="number">1</span>:<span class="number">5</span>]             <span class="comment"># [1, 2, 3, 4]</span></div><div class="line">last_three   = x[<span class="number">-3</span>:]             <span class="comment"># [7, 8, 9]</span></div><div class="line">without_first_and_last = x[<span class="number">1</span>:<span class="number">-1</span>]  <span class="comment"># [1, 2, ..., 8]</span></div><div class="line">copy_of_x    = x[:]               <span class="comment"># [-1, 1, 2, ..., 9]</span></div></pre></td></tr></table></figure>
<h4 id="Membership-in-list"><a href="#Membership-in-list" class="headerlink" title="Membership in list"></a>Membership in list</h4><p>Pythons has an in operator to check for list membership and a list can be concatenate with other lists.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="number">1</span> <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]    <span class="comment"># True</span></div><div class="line"><span class="number">0</span> <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]    <span class="comment"># False</span></div><div class="line"></div><div class="line"><span class="comment"># extend with a list</span></div><div class="line">x = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</div><div class="line">x.extend([<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]) <span class="comment"># x is now [1,2,3,4,5,6]</span></div><div class="line"></div><div class="line"><span class="comment"># append with an element</span></div><div class="line">x = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</div><div class="line">x.append(<span class="number">0</span>)       <span class="comment"># x is now [1, 2, 3, 0]</span></div><div class="line">y = x[<span class="number">-1</span>]         <span class="comment"># refers to the last one. equals 0</span></div><div class="line">z = len(x)        <span class="comment"># equals 4</span></div></pre></td></tr></table></figure></p>
<h4 id="Get-the-index-of-a-cell"><a href="#Get-the-index-of-a-cell" class="headerlink" title="Get the index of a cell"></a>Get the index of a cell</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">x = random.sample(range(<span class="number">100</span>),<span class="number">10</span>)</div><div class="line">x <span class="comment"># [53, 85, 47, 88, 57, 99, 52, 81, 61, 38]</span></div><div class="line">x.index(<span class="number">88</span>) <span class="comment"># 3</span></div></pre></td></tr></table></figure>
<h4 id="Get-the-index-of-matched-item-from-a-list"><a href="#Get-the-index-of-matched-item-from-a-list" class="headerlink" title="Get the index of matched item from a list"></a>Get the index of matched item from a list</h4><p>Reference: <a href="https://stackoverflow.com/questions/32061786/get-the-index-of-the-exact-match-from-a-list" target="_blank" rel="external">stackoverflow</a></p>
<h4 id="Unpack-list"><a href="#Unpack-list" class="headerlink" title="Unpack list"></a>Unpack list</h4><p>It is often convenient to unpack lists if you know how many elements they contain:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">x, y = [<span class="number">1</span>, <span class="number">2</span>] <span class="comment"># now x is 1, y is 2</span></div><div class="line"></div><div class="line"><span class="comment"># It’s common to use an underscore for a value you’re going to throw away:</span></div><div class="line">_, y = [<span class="number">1</span>, <span class="number">2</span>] <span class="comment"># now y == 2, didn't care about the first element</span></div></pre></td></tr></table></figure></p>
<h4 id="Concatenation"><a href="#Concatenation" class="headerlink" title="Concatenation"></a>Concatenation</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">a = list(range(<span class="number">1</span>,<span class="number">3</span>,<span class="number">1</span>)) <span class="comment"># [1,2]</span></div><div class="line">b = list(range(<span class="number">2</span>,<span class="number">6</span>,<span class="number">2</span>)) <span class="comment"># [2,4]</span></div><div class="line"><span class="comment"># method 1</span></div><div class="line">c = a + b</div><div class="line">c <span class="comment"># [1, 2, 2, 4]</span></div><div class="line"></div><div class="line"><span class="comment"># method 2</span></div><div class="line"><span class="keyword">import</span> itertools</div><div class="line">d = itertools.chain(a,b)</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> d:</div><div class="line">  print(i)</div></pre></td></tr></table></figure>
<p><img src="p-basic-40.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># method 3 -- easiest</span></div><div class="line"><span class="comment"># You can use `sum` if you give it a `start` argument</span></div><div class="line">e = sum([a,b],[])</div><div class="line">e <span class="comment"># [1, 2, 2, 4]</span></div><div class="line"></div><div class="line"><span class="comment"># method 4 -- pythonic</span></div><div class="line"><span class="keyword">import</span> operator</div><div class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</div><div class="line">reduce(operator.add, [a,b]) <span class="comment"># [1, 2, 2, 4]</span></div></pre></td></tr></table></figure>
<h4 id="Combine-list-elements"><a href="#Combine-list-elements" class="headerlink" title="Combine list elements"></a>Combine list elements</h4><p>Generate a list of pairs consisting of combinations of a set of letters = ‘A’, ‘B’, ‘C’ with a set of numbers = 1, 2 such that we have:</p>
<ol>
<li>A1 B2</li>
<li>B1 A2</li>
<li>A1 C2</li>
<li>C1 A2</li>
<li>B1 C2</li>
<li>C1 B2</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> itertools</div><div class="line">list1 = [<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>]</div><div class="line">list2 = [<span class="number">1</span>,<span class="number">2</span>]</div><div class="line">result = [zip(x,list2) <span class="keyword">for</span> x <span class="keyword">in</span> itertools.permutations(list1,len(list2))]</div></pre></td></tr></table></figure>
<p><img src="p-basic-74.png" alt=""></p>
<p>For a simple Cartesian product:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> itertools</div><div class="line">list1 = [<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>]</div><div class="line">list2 = [<span class="number">1</span>,<span class="number">2</span>]</div><div class="line">result = list(itertools.product(list1,list2))</div><div class="line">result <span class="comment"># [('A', 1), ('A', 2), ('B', 1), ('B', 2), ('C', 1), ('C', 2)]</span></div></pre></td></tr></table></figure></p>
<h4 id="Index-of-an-list-item"><a href="#Index-of-an-list-item" class="headerlink" title="Index of an list item"></a>Index of an list item</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (continued)</span></div><div class="line">ans = result.index((<span class="string">'A'</span>,<span class="number">1</span>)) <span class="comment"># returns index 0.</span></div></pre></td></tr></table></figure>
<h4 id="Unzip-a-list"><a href="#Unzip-a-list" class="headerlink" title="Unzip a list"></a>Unzip a list</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (continued)</span></div><div class="line">result = zip(*result)</div><div class="line">result <span class="comment"># [('A', 'A', 'B', 'B', 'C', 'C'), (1, 2, 1, 2, 1, 2)]</span></div></pre></td></tr></table></figure>
<h4 id="Split-into-equal-chunks"><a href="#Split-into-equal-chunks" class="headerlink" title="Split into equal chunks"></a>Split into equal chunks</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">chunks</span><span class="params">(l, n)</span>:</span></div><div class="line">    <span class="string">"""Yield successive n-sized chunks from l."""</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(l), n):</div><div class="line">        <span class="keyword">yield</span> l[i:i + n]</div><div class="line"><span class="keyword">import</span> pprint</div><div class="line">pprint.pprint(list(chunks(range(<span class="number">10</span>, <span class="number">75</span>), <span class="number">10</span>)))</div></pre></td></tr></table></figure>
<p><img src="p-basic-83.png" alt=""><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (continued)</span></div><div class="line"><span class="comment"># Simply use list comprehension instead of writing a function.</span></div><div class="line">l = np.arange(<span class="number">10</span>,<span class="number">75</span>)</div><div class="line">n = <span class="number">10</span></div><div class="line">[l[i:i + n] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(l), n)]</div></pre></td></tr></table></figure></p>
<p><img src="p-basic-84.png" alt=""></p>
<h4 id="Clong-rows-and-columns"><a href="#Clong-rows-and-columns" class="headerlink" title="Clong rows and columns"></a>Clong rows and columns</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># method 1 efficient one.</span></div><div class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> tile, array, matrix</div><div class="line">tile(array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]),(<span class="number">3</span>,<span class="number">1</span>))</div><div class="line">tile(array([[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]]).transpose(),(<span class="number">1</span>,<span class="number">3</span>))</div></pre></td></tr></table></figure>
<p><img src="p-basic-86.png" alt=""><br>Note that the transpose has no effect for an array but a matrix.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> tile, array, matrix</div><div class="line">x = array([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</div><div class="line">x.transpose() <span class="comment"># array([1, 2, 3]), which is the same as the original.</span></div><div class="line">matrix([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]) <span class="comment"># matrix([[1, 2, 3]])</span></div><div class="line">matrix([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]).transpose</div></pre></td></tr></table></figure></p>
<h3 id="Strings"><a href="#Strings" class="headerlink" title="Strings"></a>Strings</h3><p>Strings    can    be delimited by single or double quotation marks (but the quotes have to match):<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">single_quoted_string = <span class="string">'data science'</span></div><div class="line">double_quoted_string = <span class="string">"data science"</span></div></pre></td></tr></table></figure></p>
<p>Python uses backslashes to encode special characters.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">tab_string = <span class="string">"\t"</span>       <span class="comment"># represents the tab character</span></div><div class="line">len(tab_string)         <span class="comment"># is 1</span></div></pre></td></tr></table></figure></p>
<p>If you want backslashes as backslashes (which you might in Windows directory names or in regular expressions), you can create raw strings using r””:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">not_tab_string = <span class="string">r"\t"</span>  <span class="comment"># represents the characters '\' and 't'</span></div><div class="line">len(not_tab_string)     <span class="comment"># is 2</span></div></pre></td></tr></table></figure></p>
<p>You can create multiline strings using triple-double-quotes:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">multi_line_string = <span class="string">"""This is the first line.</span></div><div class="line"><span class="string">and this is the second line</span></div><div class="line"><span class="string">and this is the third line"""</span></div></pre></td></tr></table></figure></p>
<h3 id="Tuples"><a href="#Tuples" class="headerlink" title="Tuples"></a>Tuples</h3><p>Tuples are lists’ immutable cousins. Pretty much anything you can do to a list that doesn’t involve modifying it, you can do to a tuple. You specify a tuple by using parentheses (or nothing) instead of square brackets:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">my_list = [<span class="number">1</span>, <span class="number">2</span>]</div><div class="line">my_tuple = (<span class="number">1</span>, <span class="number">2</span>)</div><div class="line">other_tuple = <span class="number">3</span>, <span class="number">4</span></div><div class="line">my_list[<span class="number">1</span>] = <span class="number">3</span>      <span class="comment"># my_list is now [1, 3]</span></div><div class="line"></div><div class="line"><span class="keyword">try</span>:</div><div class="line">    my_tuple[<span class="number">1</span>] = <span class="number">3</span></div><div class="line"><span class="keyword">except</span> TypeError:</div><div class="line">    <span class="keyword">print</span> <span class="string">"cannot modify a tuple"</span></div></pre></td></tr></table></figure></p>
<p>Tuples are a convenient way to return multiple values from functions:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum_and_product</span><span class="params">(x, y)</span>:</span></div><div class="line">    <span class="keyword">return</span> (x + y),(x * y)</div><div class="line">sp = sum_and_product(<span class="number">2</span>, <span class="number">3</span>)    <span class="comment"># equals (5, 6)</span></div><div class="line">s, p = sum_and_product(<span class="number">5</span>, <span class="number">10</span>) <span class="comment"># s is 15, p is 50</span></div><div class="line">print(s,p)</div></pre></td></tr></table></figure></p>
<p>Tuples (and lists) can also be used for multiple assignment:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">x, y = <span class="number">1</span>, <span class="number">2</span>     <span class="comment"># now x is 1, y is 2</span></div><div class="line">x, y = y, x     <span class="comment"># Pythonic way to swap variables; now x is 2, y is 1</span></div></pre></td></tr></table></figure></p>
<h3 id="Dictionaries"><a href="#Dictionaries" class="headerlink" title="Dictionaries"></a>Dictionaries</h3><h4 id="Basics"><a href="#Basics" class="headerlink" title="Basics"></a>Basics</h4><p>Another    fundamental    data structure is a dictionary, which associates values with keys and allows you to quickly retrieve the value corresponding to a given key:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">empty_dict = &#123;&#125;               <span class="comment"># Pythonic</span></div><div class="line">empty_dict2 = dict()              <span class="comment"># less Pythonic</span></div><div class="line">grades = &#123; <span class="string">"Joel"</span> : <span class="number">80</span>, <span class="string">"Tim"</span> : <span class="number">95</span> &#125;    <span class="comment"># dictionary literal</span></div><div class="line"></div><div class="line">joels_grade = grades[<span class="string">"Joel"</span>]         <span class="comment"># equals 80</span></div><div class="line"></div><div class="line"><span class="keyword">try</span>:</div><div class="line">    kates_grade = grades[<span class="string">"Kate"</span>]</div><div class="line"><span class="keyword">except</span> KeyError:</div><div class="line">    <span class="keyword">print</span> <span class="string">"no grade for Kate!"</span></div></pre></td></tr></table></figure></p>
<p>You can check for the existence of a key using in:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">joel_has_grade = <span class="string">"Joel"</span> <span class="keyword">in</span> grades     <span class="comment"># True</span></div><div class="line">kate_has_grade = <span class="string">"Kate"</span> <span class="keyword">in</span> grades     <span class="comment"># False</span></div></pre></td></tr></table></figure></p>
<p>Dictionaries have a get method that returns a default value (instead of raising an exception) when you look up a key that’s not in the dictionary:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">joels_grade = grades.get(<span class="string">"Joel"</span>, <span class="number">0</span>)  <span class="comment"># equals 80</span></div><div class="line">kates_grade = grades.get(<span class="string">"Kate"</span>, <span class="number">0</span>)  <span class="comment"># equals 0</span></div><div class="line">no_ones_grade = grades.get(<span class="string">"No One"</span>)  <span class="comment"># default default is None</span></div></pre></td></tr></table></figure></p>
<p>You assign key-value pairs using the same square brackets:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">grades[<span class="string">"Tim"</span>] = <span class="number">99</span>         <span class="comment"># replaces the old value</span></div><div class="line">grades[<span class="string">"Kate"</span>] = <span class="number">100</span>        <span class="comment"># adds a third entry</span></div><div class="line">num_students = len(grades)     <span class="comment"># equals 3</span></div></pre></td></tr></table></figure></p>
<p>We use dictionaries as a simple way to represent structured data:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">tweet = &#123;</div><div class="line">    <span class="string">"user"</span> : <span class="string">"joelgrus"</span>,</div><div class="line">    <span class="string">"text"</span> : <span class="string">"Data Science is Awesome"</span>,</div><div class="line">    <span class="string">"retweet_count"</span> : <span class="number">100</span>,</div><div class="line">    <span class="string">"hashtags"</span> : [<span class="string">"#data"</span>, <span class="string">"#science"</span>, <span class="string">"#datascience"</span>, <span class="string">"#awesome"</span>, <span class="string">"#yolo"</span>]</div><div class="line">&#125;</div><div class="line"></div><div class="line">tweet_keys  = tweet.keys()    <span class="comment"># list of keys</span></div><div class="line">tweet_values = tweet.values()   <span class="comment"># list of values</span></div><div class="line">tweet_items  = tweet.items()    <span class="comment"># list of (key, value) tuples</span></div><div class="line"><span class="string">"user"</span> <span class="keyword">in</span> tweet_keys       <span class="comment"># True, but uses a slow list in</span></div><div class="line"><span class="string">"user"</span> <span class="keyword">in</span> tweet          <span class="comment"># more Pythonic, uses faster dict in</span></div><div class="line"><span class="string">"joelgrus"</span> <span class="keyword">in</span> tweet_values    <span class="comment"># True</span></div></pre></td></tr></table></figure></p>
<h4 id="Task-word-counts-in-article"><a href="#Task-word-counts-in-article" class="headerlink" title="Task: word counts in article"></a>Task: word counts in article</h4><p>As you check each word, you can increment its count if it’s already in the dictionary and add it to the dictionary if it’s not:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Method 1</span></div><div class="line">word_counts = &#123;&#125;</div><div class="line"><span class="keyword">for</span> word <span class="keyword">in</span> document:</div><div class="line">    <span class="keyword">if</span> word <span class="keyword">in</span> word_counts:</div><div class="line">        word_counts[word] += <span class="number">1</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line"><span class="comment"># Method 2</span></div><div class="line">word_counts = &#123;&#125;</div><div class="line"><span class="keyword">for</span> word <span class="keyword">in</span> document:</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        word_counts[word] += <span class="number">1</span></div><div class="line">    <span class="keyword">except</span> KeyError:</div><div class="line">        word_counts[word] = <span class="number">1</span></div><div class="line"><span class="comment"># Method 3</span></div><div class="line">word_counts = &#123;&#125;</div><div class="line"><span class="keyword">for</span> word <span class="keyword">in</span> document:</div><div class="line">    previous_count = word_counts.get(word, <span class="number">0</span>)</div><div class="line">    word_counts[word] = previous_count + <span class="number">1</span></div></pre></td></tr></table></figure></p>
<p>A defaultdict is like a regular dictionary, except that when you try to look up a key it doesn’t contain, it first adds a value for it using a zero-argument function you provided when you created it.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Method 4</span></div><div class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</div><div class="line">word_counts = defaultdict(int)  <span class="comment"># int() produces 0</span></div><div class="line"><span class="keyword">for</span> word <span class="keyword">in</span> document:</div><div class="line">    word_counts[word] += <span class="number">1</span></div></pre></td></tr></table></figure></p>
<p>Defaultdict can also be useful with list or dict or even your own functions:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">dd_list = defaultdict(list)    <span class="comment"># list() produces an empty list</span></div><div class="line">dd_list[<span class="number">2</span>].append(<span class="number">1</span>)       <span class="comment"># now dd_list contains &#123;2: [1]&#125;</span></div></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">dd_dict = defaultdict(dict)       <span class="comment"># dict() produces an empty dict</span></div><div class="line">dd_dict[<span class="string">"Joel"</span>][<span class="string">"City"</span>] = <span class="string">"Seattle"</span>   <span class="comment"># &#123; "Joel" : &#123; "City" : Seattle"&#125;&#125;</span></div></pre></td></tr></table></figure>
<p>These will be useful when we’re using dictionaries to “collect” results by some key and don’t want to have to check every time to see if the key exists yet.<br>A Counter turns a sequence of values into a defaultdict(int)-like object mapping keys to counts. We will primarily use it to create histograms:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</div><div class="line">c = Counter([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>])          <span class="comment"># c is (basically) &#123; 0 : 2, 1 : 1, 2 : 1 &#125;</span></div></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Method 5: to solve our word_counts problem above</span></div><div class="line">word_counts = Counter(document)</div><div class="line"><span class="comment"># print the 10 most common words and their counts</span></div><div class="line"><span class="keyword">for</span> word, count <span class="keyword">in</span> word_counts.most_common(<span class="number">10</span>):</div><div class="line">    <span class="keyword">print</span> word, count</div></pre></td></tr></table></figure>
<h4 id="Task-nested-dictionary"><a href="#Task-nested-dictionary" class="headerlink" title="Task: nested dictionary"></a>Task: nested dictionary</h4><p>Reference: <a href="https://stackoverflow.com/questions/30360964/how-to-store-multiple-entries-for-each-student-using-dictionaries" target="_blank" rel="external">stackoverflow</a></p>
<p>Create a file with students, each record having name of student, percent marks obtained in different subjects such as Maths, Physics and Chemistry, which may look like:<br><img src="p-basic-28.png" alt=""><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">num_students = int(input(<span class="string">"Please enter number of students:"</span>))</div><div class="line">print(<span class="string">"you entered &#123;&#125; students"</span>.format(num_students))</div><div class="line">student_info = &#123;&#125;</div><div class="line">student_data = [<span class="string">'Math marks : '</span>, <span class="string">'Physics marks : '</span>, <span class="string">'Chemistry marks : '</span>]</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,num_students):</div><div class="line">    student_name = input(<span class="string">"Name :"</span>)</div><div class="line">    student_info[student_name] = &#123;&#125;</div><div class="line">    <span class="keyword">for</span> entry <span class="keyword">in</span> student_data:</div><div class="line">        student_info[student_name][entry] = int(input(entry)) <span class="comment">#storing the marks entered as integers to perform arithmetic operations later on.</span></div><div class="line"><span class="comment">#print student_info</span></div><div class="line">print(<span class="string">"Please enter student name ?"</span>)</div><div class="line">name = input(<span class="string">"Student name : "</span>)</div><div class="line"><span class="keyword">if</span> name <span class="keyword">in</span> student_info.keys():</div><div class="line">    print(<span class="string">"Average student marks : &#123;&#125;"</span>.format(sum(student_info[name].values())/<span class="number">3.0</span>))</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    <span class="keyword">print</span><span class="string">"please enter valid name"</span></div></pre></td></tr></table></figure></p>
<p>To print the newly created dictionary student_info:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">pretty</span><span class="params">(d, indent=<span class="number">0</span>)</span>:</span></div><div class="line">   <span class="keyword">for</span> key, value <span class="keyword">in</span> d.items():</div><div class="line">      print(<span class="string">'\t'</span> * indent + str(key))</div><div class="line">      <span class="keyword">if</span> isinstance(value, dict):</div><div class="line">         pretty(value, indent+<span class="number">1</span>)</div><div class="line">      <span class="keyword">else</span>:</div><div class="line">         print(<span class="string">'\t'</span> * (indent+<span class="number">1</span>) + str(value))</div><div class="line"></div><div class="line">pretty(student_info)</div></pre></td></tr></table></figure></p>
<p><img src="p-basic-29.png" alt=""></p>
<h3 id="Sets"><a href="#Sets" class="headerlink" title="Sets"></a>Sets</h3><h4 id="Basics-1"><a href="#Basics-1" class="headerlink" title="Basics"></a>Basics</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">s = set()</div><div class="line">s.add(<span class="number">1</span>)      <span class="comment"># s is now &#123; 1 &#125;</span></div><div class="line">s.add(<span class="number">2</span>)      <span class="comment"># s is now &#123; 1, 2 &#125;</span></div><div class="line">s.add(<span class="number">2</span>)      <span class="comment"># s is still &#123; 1, 2 &#125;</span></div><div class="line">x = len(s)     <span class="comment"># equals 2</span></div><div class="line">y = <span class="number">2</span> <span class="keyword">in</span> s     <span class="comment"># equals True</span></div><div class="line">z = <span class="number">3</span> <span class="keyword">in</span> s     <span class="comment"># equals False</span></div></pre></td></tr></table></figure>
<h4 id="Check-membership"><a href="#Check-membership" class="headerlink" title="Check membership"></a>Check membership</h4><p>We’ll use sets for two main reasons. The first is that in is a very fast operation on sets. If we have a large collection of items that we want to use for a membership test, a set is more appropriate than a list:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">stopwords_list = [<span class="string">"a"</span>,<span class="string">"an"</span>,<span class="string">"at"</span>] + hundreds_of_other_words + [<span class="string">"yet"</span>, <span class="string">"you"</span>]</div><div class="line"><span class="string">"zip"</span> <span class="keyword">in</span> stopwords_list     <span class="comment"># False, but have to check every element</span></div><div class="line">stopwords_set = set(stopwords_list)</div><div class="line"><span class="string">"zip"</span> <span class="keyword">in</span> stopwords_set      <span class="comment"># very fast to check</span></div></pre></td></tr></table></figure></p>
<p>The second reason is to find the distinct items in a collection:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">item_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</div><div class="line">num_items = len(item_list)           <span class="comment"># 6</span></div><div class="line">item_set = set(item_list)            <span class="comment"># &#123;1, 2, 3&#125;</span></div><div class="line">num_distinct_items = len(item_set)   <span class="comment"># 3</span></div><div class="line">distinct_item_list = list(item_set)  <span class="comment"># [1, 2, 3]</span></div></pre></td></tr></table></figure></p>
<h3 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h3><h4 id="enumerate"><a href="#enumerate" class="headerlink" title="enumerate"></a>enumerate</h4><p>When indexing data, a useful pattern that uses enumerate is computing a dict mapping the values of a sequence (which are assumed to be unique) to their locations in the sequence:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">some_list = [<span class="string">'foo'</span>,<span class="string">'bar'</span>,<span class="string">'baz'</span>]</div><div class="line">mapping = dict((v,i) <span class="keyword">for</span> i, v <span class="keyword">in</span> enumerate(some_list))</div><div class="line">mapping <span class="comment"># &#123;'bar': 1, 'baz': 2, 'foo': 0&#125;</span></div></pre></td></tr></table></figure></p>
<h4 id="sorted"><a href="#sorted" class="headerlink" title="sorted"></a>sorted</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sorted([<span class="number">7</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>]) <span class="comment"># [0, 1, 2, 2, 3, 6, 7]</span></div><div class="line">sorted(<span class="string">'horse race'</span>) <span class="comment"># [' ', 'a', 'c', 'e', 'e', 'h', 'o', 'r', 'r', 's']</span></div></pre></td></tr></table></figure>
<p>A common pattern for getting a sorted list of the unique elements in a sequence is to combine sorted with set:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sorted(set(<span class="string">'this is just some string'</span>)) <span class="comment"># [' ', 'e', 'g', 'h', 'i', 'j', 'm', 'n', 'o', 'r', 's', 't', 'u']</span></div></pre></td></tr></table></figure></p>
<h4 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h4><p>zip “pairs” up the elements of a number of lists, tuples, or other sequences, to create a list of tuples:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">seq1 = [<span class="string">'foo'</span>,<span class="string">'bar'</span>,<span class="string">'baz'</span>]</div><div class="line">seq2 = [<span class="string">'one'</span>,<span class="string">'two'</span>,<span class="string">'three'</span>]</div><div class="line">zipped = zip(seq1,seq2)</div><div class="line">list(zipped)</div></pre></td></tr></table></figure></p>
<p>zip can take an arbitrary number of sequences, and the number of elements it produces is determined by the shortest sequence:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">seq3 = [<span class="keyword">False</span>, <span class="keyword">True</span>]</div><div class="line">list(zip(seq1,seq2,seq3)) <span class="comment"># [('foo', 'one', False), ('bar', 'two', True)]</span></div></pre></td></tr></table></figure></p>
<p>A very common use of zip is for simultaneously iterating over multiple sequences, possibly also combined with enumerate:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> i, (a,b) <span class="keyword">in</span> enumerate(zip(seq1,seq2)):</div><div class="line">  print(<span class="string">'&#123;0&#125;: &#123;1&#125;, &#123;2&#125;'</span>.format(i,a,b))</div></pre></td></tr></table></figure></p>
<table>
<thead>
<tr>
<th style="text-align:center">0</th>
<th style="text-align:center">foo</th>
<th style="text-align:center">one</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">bar</td>
<td style="text-align:center">two</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">baz</td>
<td style="text-align:center">three</td>
</tr>
</tbody>
</table>
<h4 id="unzip"><a href="#unzip" class="headerlink" title="unzip"></a>unzip</h4><p>Another way to think about this is converting a list of rows into a list of columns.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line">pitchers = [(<span class="string">'Nolan'</span>, <span class="string">'Ryan'</span>), (<span class="string">'Roger'</span>, <span class="string">'Clemens'</span>),(<span class="string">'Schilling'</span>, <span class="string">'Curt'</span>)]</div><div class="line">first_names, last_names = zip(*pitchers)</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(pitchers)):</div><div class="line">  print(<span class="string">'&#123;0&#125; &#123;1&#125;'</span>.format(first_names[i],last_names[i]))</div></pre></td></tr></table></figure></p>
<p>Nolan Ryan<br>Roger Clemens<br>Schilling Curt</p>
<h2 id="Flow-control"><a href="#Flow-control" class="headerlink" title="Flow control"></a>Flow control</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># incomplete example</span></div><div class="line"><span class="keyword">if</span> integer &gt; <span class="number">3</span> <span class="keyword">and</span> integer &lt; <span class="number">34</span>:</div><div class="line"><span class="comment"># more example</span></div><div class="line"><span class="keyword">if</span> <span class="number">3</span> &lt; integer &lt; <span class="number">34</span>:</div></pre></td></tr></table></figure>
<p>Python replaces the usual C-style boolean operators (&amp;&amp;, ||, !) with words: and, or, and not respectively. For readability, you can add parentheses.</p>
<h2 id="NumPy"><a href="#NumPy" class="headerlink" title="NumPy"></a>NumPy</h2><p>NumPy is a library for the Python programming language, adding support for large, multi-dimensional arrays and matrices, along with a large collection of high-level mathematical functions to operate on these arrays.</p>
<p>String and tuples are immutable, while lists, dicts, NumPy arrays, user-defined types (classes) are mutable, meaning that the object or values that they contain can be modified. You can preface the leading quote of the string with rwhich means that the characters should be interpreted as is.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">s = <span class="string">'python'</span></div><div class="line">list(s)</div><div class="line">s[:<span class="number">3</span>]</div><div class="line">s[<span class="number">0</span>] = <span class="string">"z"</span> <span class="comment"># error message shows.</span></div></pre></td></tr></table></figure>
<h3 id="Create-ndarray"><a href="#Create-ndarray" class="headerlink" title="Create ndarray"></a>Create ndarray</h3><p>An <code>ndarray</code>, short for n-dimensional array, object is a generic multidimentional container for homogeneous data; all of the elements must be the same type.</p>
<h4 id="By-randomization"><a href="#By-randomization" class="headerlink" title="By randomization"></a>By randomization</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Set precision of printout</span></div><div class="line">np.set_printoptions(precision=<span class="number">4</span>, suppress=<span class="keyword">True</span>)</div><div class="line">data = randn(<span class="number">2</span>,<span class="number">3</span>)</div><div class="line">data.dtype <span class="comment"># dtype('float64')</span></div><div class="line">data.shape <span class="comment"># tuple type; (2L, 3L)</span></div></pre></td></tr></table></figure>
<h4 id="By-functions"><a href="#By-functions" class="headerlink" title="By functions"></a>By functions</h4><h5 id="array-amp-dtype"><a href="#array-amp-dtype" class="headerlink" title="array() &amp; dtype"></a>array() &amp; dtype</h5><p>The <code>array</code> function accepts any sequence-like object (<strong>including other arrays</strong>) and produces a new NumPy array containing the passed data. A <code>list</code> is a good candidate for conversion:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data1 = [<span class="number">6</span>, <span class="number">7.5</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">1</span>]</div><div class="line">arr1 = np.array(data1)</div><div class="line">arr1.dtype <span class="comment"># dtype('float64')</span></div></pre></td></tr></table></figure></p>
<h5 id="nan"><a href="#nan" class="headerlink" title="nan()"></a>nan()</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">v = np.any([<span class="keyword">False</span>, <span class="keyword">False</span>, np.nan, <span class="keyword">True</span>])</div><div class="line">v <span class="comment"># True</span></div><div class="line">w = np.array(range(<span class="number">3</span>),dtype=np.float64)</div><div class="line">w <span class="comment"># array([ 0.,  1.,  2.])</span></div><div class="line">w[<span class="number">2</span>] = np.nan</div><div class="line">w <span class="comment"># array([  0.,   1.,  nan])</span></div></pre></td></tr></table></figure>
<h5 id="shape-amp-ndim"><a href="#shape-amp-ndim" class="headerlink" title="shape() &amp; ndim"></a>shape() &amp; ndim</h5><p>Nested sequences, like a list of <code>equal-length</code> lists, will be converted into a multi-dimentional array:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">data2 = [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]]</div><div class="line">arr2 = np.array(data2)</div><div class="line">arr2 <span class="comment">#</span></div><div class="line">arr2.ndim <span class="comment"># 2</span></div><div class="line">arr2.shape <span class="comment"># (2L, 4L)</span></div><div class="line">arr2.dtype <span class="comment"># dtype('int32'). np.array() tries to infer a good data type for the array that it creates.</span></div></pre></td></tr></table></figure></p>
<h5 id="zeros-amp-ones-amp-empty"><a href="#zeros-amp-ones-amp-empty" class="headerlink" title="zeros() &amp; ones() &amp; empty()"></a>zeros() &amp; ones() &amp; empty()</h5><p><code>zeros</code> and <code>ones</code> create arrays of 0’s or 1’s. To create a higher dimensional array with these methods, pass a <code>tuple</code> for the shape. Note that it’s not safe to assume that np.empty will return an array of all zeros.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">np.zeros(<span class="number">10</span>) <span class="comment"># derivative: zeros_like(), ones(), ones_like()</span></div><div class="line">np.zeros((<span class="number">3</span>, <span class="number">6</span>)) <span class="comment">#</span></div><div class="line">np.empty((<span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>)) <span class="comment"># derivative: empty_like()</span></div></pre></td></tr></table></figure></p>
<h5 id="arange-amp-reshape"><a href="#arange-amp-reshape" class="headerlink" title="arange() &amp; reshape()"></a>arange() &amp; reshape()</h5><p><code>arange()</code> is an array-valued version of the built-in Python range function. It returns an <code>ndarray</code> instead of a list:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">15</span>)</div><div class="line">arr <span class="comment"># array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14])</span></div><div class="line">arr.dtype <span class="comment"># dtype('int32')</span></div></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr2d = np.array(range(<span class="number">12</span>)).reshape((<span class="number">3</span>,<span class="number">4</span>))</div><div class="line">arr2d <span class="comment">#</span></div></pre></td></tr></table></figure>
<p>Reference: <a href="https://stackoverflow.com/questions/18691084/what-does-1-mean-in-numpy-reshape" target="_blank" rel="external">stackoverflow</a><br>Numpy allow us to give one of new shape parameter as -1 (eg: (2,-1) or (-1,3) but not (-1, -1)) which will throw an error. It simply means that it is an unknown dimension and we want numpy to figure it out.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># data</span></div><div class="line">z = np.arange(<span class="number">12</span>).reshape(<span class="number">3</span>,<span class="number">4</span>)</div><div class="line">z</div><div class="line">z.reshape(<span class="number">-1</span>) <span class="comment"># array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11])</span></div><div class="line"><span class="comment"># Now trying to reshape with (-1, 1) . We have provided column as 1 but rows as unknown . So we get result new shape as (12, 1).</span></div><div class="line">z.reshape(<span class="number">-1</span>,<span class="number">1</span>)</div><div class="line"><span class="comment"># New shape as (-1, 2). row unknown, column 2. we get result new shape as (6, 2)</span></div><div class="line">z.reshape(<span class="number">-1</span>, <span class="number">2</span>)</div></pre></td></tr></table></figure></p>
<p><img src="p-basic-82.png" alt=""></p>
<p>The <code>order</code> keyword of reshape gives the index ordering both for <strong>fetching</strong> the values from the initial data, and then <strong>placing</strong> the values into the output array.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">a = np.arange(<span class="number">6</span>).reshape((<span class="number">3</span>,<span class="number">2</span>))</div><div class="line">a</div><div class="line">np.reshape(a,(<span class="number">2</span>,<span class="number">3</span>)) <span class="comment"># C-like index order. That is, fetching the values in row major ordering, then placing them in the same ording into the output matrix.</span></div><div class="line"><span class="comment"># similarly,</span></div><div class="line">np.reshape(np.ravel(a),(<span class="number">2</span>,<span class="number">3</span>)) <span class="comment"># equivalent to C ravel then C reshape</span></div></pre></td></tr></table></figure></p>
<p><img src="p-basic-78.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">np.reshape(a,(<span class="number">2</span>,<span class="number">3</span>),order=<span class="string">'F'</span>) <span class="comment"># Fortran-like index ordering</span></div><div class="line"><span class="comment"># similarly,</span></div><div class="line">np.reshape(np.ravel(a,order=<span class="string">'F'</span>),(<span class="number">2</span>,<span class="number">3</span>),order=<span class="string">'F'</span>)</div></pre></td></tr></table></figure>
<p><img src="p-basic-77.png" alt=""><br>Reference: <a href="https://docs.scipy.org/doc/numpy-1.13.0/reference/generated/numpy.reshape.html" target="_blank" rel="external">scipy</a></p>
<h5 id="view"><a href="#view" class="headerlink" title="view()"></a>view()</h5><p>Taking a view makes it possible to modify the newly produced matrix without modifying the initial object:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#data</span></div><div class="line">a = np.zeros((<span class="number">10</span>,<span class="number">2</span>))</div><div class="line">a</div><div class="line">b = a.T</div><div class="line">b</div><div class="line"><span class="comment">#take a view</span></div><div class="line">c = b.view()</div><div class="line">c.shape = (<span class="number">20</span>) <span class="comment">#error message raises.</span></div><div class="line">c.shape <span class="comment"># (2, 10)</span></div></pre></td></tr></table></figure></p>
<h3 id="Type-conversion"><a href="#Type-conversion" class="headerlink" title="Type conversion"></a>Type conversion</h3><h4 id="Numpy-matrix-vs-Numpy-array"><a href="#Numpy-matrix-vs-Numpy-array" class="headerlink" title="Numpy matrix vs Numpy array"></a>Numpy matrix vs Numpy array</h4><p>Reference <a href="https://www.ibm.com/developerworks/community/blogs/jfp/entry/Elementary_Matrix_Operations_In_Python?lang=en" target="_blank" rel="external">IBM developerworks</a></p>
<h4 id="dtype"><a href="#dtype" class="headerlink" title="dtype"></a>dtype</h4><p>A standard double-precision floating point value (what’s used under the hood in Python’s <code>float</code> object) takes up 8 bytes or 64 bits. This type is known in NumPy as <code>float64</code>.</p>
<p>To create a string dtype with length 10, use the type code <code>S10</code>(1 byte per character). For creating a unicode dtype with length 10, use <code>U10</code>:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr1 = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], dtype=np.float64)</div><div class="line">arr2 = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], dtype=np.int32)</div><div class="line">arr1.dtype <span class="comment"># dtype('float64')</span></div><div class="line">arr2.dtype <span class="comment"># dtype('int32')</span></div></pre></td></tr></table></figure></p>
<h4 id="astype"><a href="#astype" class="headerlink" title="astype()"></a>astype()</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">int_arr = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</div><div class="line"></div><div class="line"><span class="comment"># method 1: astype()</span></div><div class="line"><span class="comment"># Calling astype always creates a new array (a copy of the data).</span></div><div class="line">float_arr = int_arr.astype(np.float64)</div><div class="line">float_arr.dtype <span class="comment"># dtype('float64')</span></div><div class="line"></div><div class="line"><span class="comment"># method 2: parameter dtype</span></div><div class="line">float_arr1 = np.array(int_arr, dtype=np.float64)</div><div class="line">float_arr1.dtype</div><div class="line"></div><div class="line"><span class="comment"># method 3: read dtype of existing array</span></div><div class="line">float_arr2 = int_arr.astype(float_arr1.dtype)</div><div class="line">float_arr2 <span class="comment"># array([ 1.,  2.,  3.,  4.,  5.])</span></div></pre></td></tr></table></figure>
<p>Optional parameters: np.string_ and np.unicode_<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># method 1</span></div><div class="line">ray_strings = np.array([<span class="string">'1.25'</span>, <span class="string">'-9.6'</span>, <span class="string">'42'</span>], dtype=np.string_)</div><div class="line">ray_strings <span class="comment"># array(['1.25', '-9.6', '42'], dtype='|S4')</span></div><div class="line">ray_strings.astype(float) <span class="comment"># array([  1.25,  -9.6 ,  42.  ])</span></div></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># method 2</span></div><div class="line">int_array = np.arange(<span class="number">10</span>)</div><div class="line">calibers = np.array([<span class="number">.22</span>, <span class="number">.270</span>, <span class="number">.357</span>, <span class="number">.380</span>, <span class="number">.44</span>, <span class="number">.50</span>], dtype=np.float64)</div><div class="line">int_array.astype(calibers.dtype)</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># unit32 examples</span></div><div class="line">empty_uint32 = np.empty(<span class="number">8</span>, dtype=<span class="string">'u4'</span>)</div><div class="line">empty_uint32 <span class="comment"># array([0, 0, 0, 0, 0, 0, 0, 0], dtype=uint32)</span></div></pre></td></tr></table></figure>
<h4 id="String-to-numeric-string"><a href="#String-to-numeric-string" class="headerlink" title="String to numeric_string"></a>String to numeric_string</h4><p>See the topic about “missing data” in the Pandas section.</p>
<h4 id="Factorization"><a href="#Factorization" class="headerlink" title="Factorization"></a>Factorization</h4><h5 id="basic"><a href="#basic" class="headerlink" title="basic"></a>basic</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># general</span></div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line">df = pd.DataFrame(&#123;<span class="string">"A"</span>:[<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>,<span class="string">"a"</span>]&#125;)</div><div class="line">df</div><div class="line">df[<span class="string">"B"</span>] = df[<span class="string">"A"</span>].astype(<span class="string">'category'</span>)</div><div class="line">df</div></pre></td></tr></table></figure>
<p><img src="p-basic-01.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df.describe()</div></pre></td></tr></table></figure>
<p><img src="p-basic-02.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># customary ordered categories (with undefined cateogries)</span></div><div class="line">df1 = pd.Series([<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>,<span class="string">"a"</span>])</div><div class="line">df1</div><div class="line">df1 = df1.astype(<span class="string">"category"</span>, categories=[<span class="string">"b"</span>,<span class="string">"c"</span>,<span class="string">"d"</span>], ordered=<span class="keyword">False</span>)</div><div class="line">df1</div></pre></td></tr></table></figure>
<p><img src="p-basic-03.png" alt=""></p>
<h5 id="string-vector-creation-amp-frequency"><a href="#string-vector-creation-amp-frequency" class="headerlink" title="string vector creation &amp; frequency"></a>string vector creation &amp; frequency</h5><p><strong>[Trick]</strong> Based on a list of automatically generated strings to perform grouping:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line">df = pd.DataFrame(&#123;<span class="string">'value'</span>: np.random.randint(<span class="number">0</span>, <span class="number">100</span>, <span class="number">20</span>)&#125;)</div><div class="line">df.head(<span class="number">5</span>)</div><div class="line"></div><div class="line">labels = [ <span class="string">"&#123;0&#125; - &#123;1&#125;"</span>.format(i, i + <span class="number">9</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">100</span>, <span class="number">10</span>) ]</div><div class="line">labels</div><div class="line">df[<span class="string">'group'</span>] = pd.cut(df.value, range(<span class="number">0</span>, <span class="number">105</span>, <span class="number">10</span>), right=<span class="keyword">False</span>, labels=labels)</div><div class="line">df.head(<span class="number">10</span>)</div></pre></td></tr></table></figure></p>
<p><strong>Operations between arrays and scalars</strong> Arrays are important because they enable you to express batch operations on data without writing any for loops. This is usually called <code>vectorization</code>. Any arithmetic operations between equal-size arrays applies the operation element-wise.</p>
<h3 id="Indexing"><a href="#Indexing" class="headerlink" title="Indexing"></a>Indexing</h3><p>If you assign a scalar value to a slice, as in arr[5:8] = 12, the value is <code>propagated</code> (or <code>broadcasted</code> henceforth) to the entire selection. An important first distinction from lists is that array slices are <code>views</code> on the original array. This means that the data is not copied, and any modifications to the view <strong>will be</strong> reflected in the source array:</p>
<h4 id="One-dimension-indexing"><a href="#One-dimension-indexing" class="headerlink" title="One-dimension indexing"></a>One-dimension indexing</h4><p>Python (and C++) is row-major, while Fortran (Julia, R, and Matlab) is column-major.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">10</span>)</div><div class="line">arr[<span class="number">5</span>:<span class="number">8</span>] = <span class="number">12</span></div><div class="line">arr</div><div class="line"></div><div class="line">arr[:] = <span class="number">100</span></div><div class="line">arr <span class="comment"># array([100, 100, 100, 100, 100, 100, 100, 100, 100, 100])</span></div><div class="line"></div><div class="line">part_arr = arr[<span class="number">5</span>:<span class="number">8</span>] <span class="comment"># part_arr remains a view of arr</span></div><div class="line">part_arr[<span class="number">2</span>] = <span class="number">2</span></div><div class="line">arr <span class="comment"># array([100, 100, 100, 100, 100, 100, 100,   2, 100, 100])</span></div></pre></td></tr></table></figure></p>
<p>If you need to explicitly copy the array instead of a view of it, use <code>copy()</code>:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">copy_arr = arr[<span class="number">5</span>:<span class="number">8</span>].copy() <span class="comment"># Don't miss the parenthesis!!</span></div><div class="line">copy_arr</div><div class="line">copy_arr[<span class="number">2</span>] = <span class="number">-1</span></div><div class="line">arr <span class="comment"># remains unchanged: array([100, 100, 100, 100, 100, 100, 100,   2, 100, 100])</span></div></pre></td></tr></table></figure></p>
<p>Note that when assigning a variable (or name) in Python, you are creating a reference to the object on the right hand side of the equals sign. Python is said to always pass-by-reference, whereas some other languages (like C++) support various argument passing conventions, including as pass-by-value (creating copies) and pass-by-reference. This means that a function in Python can alter the internals of its arguments.</p>
<h4 id="Numpy-indexing"><a href="#Numpy-indexing" class="headerlink" title="Numpy indexing"></a>Numpy indexing</h4><p>In multidimensional arrays, if you omit later indices, the returned object will be a lower-dimensional ndarray consisting of all the data along the higher dimensions.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># create a 3x4 array</span></div><div class="line">arr2d = np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]])</div><div class="line">arr2d[<span class="number">2</span>] <span class="comment"># array([7, 8, 9])</span></div><div class="line">arr2d[<span class="number">0</span>][<span class="number">2</span>] <span class="comment"># 3; from the outermost brackets toward the innermost</span></div><div class="line">arr2d[<span class="number">0</span>, <span class="number">2</span>] <span class="comment"># 3</span></div></pre></td></tr></table></figure></p>
<p>Note that the “outtermost” bracket represents the “lowest” dimension.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr3d = np.array([[[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]], [[<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>], [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]]])</div><div class="line">arr3d.shape <span class="comment"># (2L, 2L, 3L)</span></div><div class="line">arr3d[<span class="number">0</span>] <span class="comment"># the 1st element of the "outtermost" bracket ("lowest" dimension)</span></div><div class="line">         <span class="comment"># array([[1, 2, 3], [4, 5, 6]])</span></div></pre></td></tr></table></figure></p>
<p>A slice selects a range of elements along an axis.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">arr2d = np.array(range(<span class="number">12</span>)).reshape((<span class="number">3</span>,<span class="number">4</span>))</div><div class="line">arr2d <span class="comment"># array([[ 0,  1,  2,  3],</span></div><div class="line">      <span class="comment"># [ 4,  5,  6,  7],</span></div><div class="line">      <span class="comment"># [ 8,  9, 10, 11]])</span></div><div class="line">arr2d[:<span class="number">2</span>] <span class="comment"># array([[0, 1, 2, 3],</span></div><div class="line">          <span class="comment">#        [4, 5, 6, 7]])</span></div></pre></td></tr></table></figure></p>
<p>Note that a colon by itself means to take the entire axis, so you can slice only higher dimensional axes by doing:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr2d[:, :<span class="number">1</span>] <span class="comment"># array([[0],</span></div><div class="line">             <span class="comment">#        [4],</span></div><div class="line">             <span class="comment">#        [8]])</span></div></pre></td></tr></table></figure></p>
<h4 id="Numpy-conditional-indexing"><a href="#Numpy-conditional-indexing" class="headerlink" title="Numpy conditional indexing"></a>Numpy conditional indexing</h4><p><strong>Make a subset of observations</strong> The boolean array must be of the same length as the axis it’s indexing. Selecting data from an array by boolean indexing always creates a copy of the data, even if the returned array is <strong>unchanged</strong>.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">names = np.array([<span class="string">'Bob'</span>, <span class="string">'Joe'</span>, <span class="string">'Will'</span>, <span class="string">'Bob'</span>, <span class="string">'Will'</span>, <span class="string">'Joe'</span>, <span class="string">'Joe'</span>])</div><div class="line">data = np.arange(<span class="number">28</span>).reshape((<span class="number">7</span>,<span class="number">4</span>))</div><div class="line">data</div><div class="line">names <span class="comment"># array(['Bob', 'Joe', 'Will', 'Bob', 'Will', 'Joe', 'Joe'], dtype='|S4')</span></div><div class="line"><span class="comment"># example 1:</span></div><div class="line">names == <span class="string">'Bob'</span> <span class="comment"># array([ True, False, False,  True, False, False, False], dtype=bool)</span></div><div class="line">data[names == <span class="string">'Bob'</span>] <span class="comment"># row 0 and row 4 remain</span></div><div class="line">data[names == <span class="string">'Bob'</span>, <span class="number">2</span>:] <span class="comment"># from column 2 to the last (included)</span></div><div class="line">data[names == <span class="string">'Bob'</span>, <span class="number">3</span>]</div><div class="line">names != <span class="string">'Bob'</span></div><div class="line">data[-(names == <span class="string">'Bob'</span>)] <span class="comment"># remove</span></div><div class="line"><span class="comment"># example 2:</span></div><div class="line">mask = (names == <span class="string">'Bob'</span>) | (names == <span class="string">'Will'</span>)</div><div class="line">mask <span class="comment"># array([ True, False,  True,  True,  True, False, False], dtype=bool)</span></div><div class="line">data[mask]</div></pre></td></tr></table></figure></p>
<p><strong>Multiple conditions</strong><br>The Python keywords <code>and</code> and <code>or</code> do not work with boolean arrays, because the boolean operators <code>and</code> and <code>or</code> in Python are so-called short-circuit operators: their arguments are evaluated from left to right, and evaluation stops as soon as the outcome is determined.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># example 1:</span></div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line">data = np.arange(<span class="number">28</span>).reshape((<span class="number">7</span>,<span class="number">4</span>))</div><div class="line">data</div><div class="line">data[data &lt; <span class="number">3</span> ] = <span class="number">0</span> <span class="comment"># OK.</span></div><div class="line">data</div><div class="line"><span class="comment"># example 2:</span></div><div class="line">data[data &gt;=<span class="number">24</span> <span class="keyword">and</span> data &lt;= <span class="number">26</span>] = <span class="number">10</span> <span class="comment"># It doesn't work. More than one condition.</span></div><div class="line">data[(data &gt;=<span class="number">24</span>) <span class="keyword">and</span> (data &lt;= <span class="number">26</span>)] = <span class="number">10</span> <span class="comment"># it doesn't work</span></div><div class="line">data</div><div class="line">data[np.all([data&gt;=<span class="number">24</span>,data&lt;=<span class="number">26</span>],axis=<span class="number">0</span>)]=<span class="number">10</span> <span class="comment"># it works!!</span></div><div class="line">data</div></pre></td></tr></table></figure></p>
<p><img src="p-basic-04.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># example 3:</span></div><div class="line">names = np.array([<span class="string">'Bob'</span>, <span class="string">'Joe'</span>, <span class="string">'Will'</span>, <span class="string">'Bob'</span>, <span class="string">'Will'</span>, <span class="string">'Joe'</span>, <span class="string">'Joe'</span>])</div><div class="line">data[names != <span class="string">'Joe'</span>] = <span class="number">7</span></div><div class="line">data</div></pre></td></tr></table></figure>
<p><img src="p-basic-05.png" alt=""></p>
<h4 id="Indexing-tricks"><a href="#Indexing-tricks" class="headerlink" title="Indexing tricks"></a>Indexing tricks</h4><h5 id="Re-ordering"><a href="#Re-ordering" class="headerlink" title="Re-ordering"></a>Re-ordering</h5><p>Fancy indexing is a term adopted by NumPy to describe indexing using integer <code>arrays</code>. To select out a subset of the <code>rows</code> in a particular order, you can simply pass a list or ndarray of integers specifying the desired order<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">arr = np.empty((<span class="number">8</span>, <span class="number">4</span>))</div><div class="line"><span class="comment"># [Trick] fill up row data with loop.</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</div><div class="line">    arr[i] = i</div><div class="line">arr</div><div class="line">arr[[<span class="number">4</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">6</span>]]</div><div class="line"><span class="comment"># Using negative indices select rows from the end</span></div><div class="line">arr[[<span class="number">-3</span>, <span class="number">-5</span>, <span class="number">-7</span>]]</div></pre></td></tr></table></figure></p>
<h5 id="Select-a-square-region"><a href="#Select-a-square-region" class="headerlink" title="Select a square region"></a>Select a square region</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">32</span>).reshape((<span class="number">8</span>, <span class="number">4</span>))</div><div class="line">arr</div></pre></td></tr></table></figure>
<p><img src="p-basic-06.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr[[<span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">2</span>], [<span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>]] <span class="comment"># returns four elements: array([ 4, 23, 29, 10])</span></div><div class="line"><span class="comment"># method 1:</span></div><div class="line">arr[[<span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">2</span>]][:, [<span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>]] <span class="comment"># the rectangular region formed by the four elements</span></div></pre></td></tr></table></figure>
<p><img src="p-basic-07.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Similarly, the np.ix_ function converts two 1D integer arrays to an indexer that selects the square region</span></div><div class="line"><span class="comment"># method 2:</span></div><div class="line">arr[np.ix_([<span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">2</span>], [<span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>])]</div></pre></td></tr></table></figure>
<h4 id="Meshgrid-method"><a href="#Meshgrid-method" class="headerlink" title="Meshgrid method"></a>Meshgrid method</h4><p>The np.meshgrid function takes two 1D arrays and produces two 2D matrices corresponding to all pairs of (x, y) in the two arrays.</p>
<h5 id="With-equal-number-of-points"><a href="#With-equal-number-of-points" class="headerlink" title="With equal number of points"></a>With equal number of points</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">from</span> matplotlib.pyplot <span class="keyword">import</span> imshow, title</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line">points = np.arange(<span class="number">-5</span>, <span class="number">5</span>, <span class="number">0.01</span>) <span class="comment"># 1000 equally spaced points</span></div><div class="line">xs, ys = np.meshgrid(points, points)</div><div class="line">xs <span class="comment"># in increasing order from left to right</span></div><div class="line">ys <span class="comment"># in increasing order from top to bottom</span></div><div class="line"><span class="comment"># mesh plot</span></div><div class="line">z = np.sqrt(xs ** <span class="number">2</span> + ys ** <span class="number">2</span>)</div><div class="line">z.shape</div><div class="line">plt.imshow(z, cmap=plt.cm.gray)</div><div class="line">plt.colorbar()</div><div class="line">plt.title(<span class="string">"Image plot of $\sqrt&#123;x^2 + y^2&#125;$ for a grid of values"</span>)</div><div class="line">plt.show()</div></pre></td></tr></table></figure>
<p><img src="p-basic-08.png" alt=""><br>Note that <code>a//b</code> means “floor-divide” a by b, dropping any fractional remainder. a**b means “raise a to the b power”</p>
<h5 id="With-different-number-of-points-in-x-y-axis"><a href="#With-different-number-of-points-in-x-y-axis" class="headerlink" title="With different number of points in x, y axis"></a>With different number of points in x, y axis</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"><span class="comment"># similarly, from matplotlib import pyplot as plt</span></div><div class="line"><span class="keyword">import</span> matplotlib</div><div class="line">fig = plt.figure()</div><div class="line">ax = fig.add_subplot(<span class="number">111</span>,projection=<span class="string">'3d'</span>)</div><div class="line"><span class="comment">#! It won't show in notebook but spyder!</span></div><div class="line"><span class="comment"># To create a data matrix:</span></div><div class="line">dx = [x/<span class="number">10.</span> <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">-5</span>,<span class="number">30</span>,<span class="number">5</span>)]</div><div class="line">dy = [y/<span class="number">10.</span> <span class="keyword">for</span> y <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">30</span>,<span class="number">5</span>)]</div><div class="line">mat1 = [[dx[i]+dy[j] <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(dx))] <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,len(dy))]</div><div class="line"><span class="comment">#! row-major operations over pairs of (i,j) above</span></div><div class="line">X, Y = np.meshgrid(dx,dy)</div><div class="line">Z = mat1</div><div class="line">ax.plot_surface(X,Y,Z)</div><div class="line"></div><div class="line"><span class="comment"># to display latex needs to affix the string with "r"</span></div><div class="line">ax.set_xlabel(<span class="string">'X Label'</span>)</div><div class="line">ax.set_ylabel(<span class="string">'Y Label'</span>)</div><div class="line">ax.set_zlabel(<span class="string">'Z Label'</span>)</div><div class="line">ax.set_title(<span class="string">r"$\beta=1$ and $\alpha=5$"</span>)</div><div class="line">plt.show()</div></pre></td></tr></table></figure>
<h5 id="Task-utility-surface"><a href="#Task-utility-surface" class="headerlink" title="Task: utility surface"></a>Task: utility surface</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</div><div class="line"><span class="keyword">from</span> mpl_toolkits.mplot3d <span class="keyword">import</span> axes3d, Axes3D</div><div class="line"></div><div class="line">sigma = <span class="number">1.8</span></div><div class="line">theta = <span class="number">0.05</span></div><div class="line">epsilon = <span class="number">0.1</span> <span class="comment">#</span></div><div class="line">homeeps = <span class="number">1.</span></div><div class="line">cst = <span class="number">0.</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x,h,sigma=<span class="number">1.5</span>,theta=<span class="number">0.1359</span>,epsilon=<span class="number">1.e-3</span>)</span>:</span></div><div class="line">    g = (x)**(<span class="number">1.</span>-theta)*(h+epsilon*homeeps)**(theta)</div><div class="line">    <span class="keyword">return</span> (g**(<span class="number">1.</span>-sigma)-cst)/(<span class="number">1.</span>-sigma)</div><div class="line"></div><div class="line">dc = [a/<span class="number">10.</span> <span class="keyword">for</span> a <span class="keyword">in</span> range( <span class="number">1</span>,<span class="number">100</span>,<span class="number">2</span>)]</div><div class="line">dh = [h/<span class="number">10.</span> <span class="keyword">for</span> h <span class="keyword">in</span> range( <span class="number">1</span>,<span class="number">100</span>,<span class="number">2</span>)]</div><div class="line">C, H = np.meshgrid(dc,dh)</div><div class="line">F = [[ f(dc[i],dh[j],sigma,theta,epsilon) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,len(dc))] <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>,len(dh))]</div><div class="line">F = np.array(F)</div><div class="line"></div><div class="line">fig = plt.figure()</div><div class="line">ax  = Axes3D(fig)</div><div class="line">ax.plot_wireframe(C,H,F,rstride=<span class="number">2</span>,cstride=<span class="number">2</span>)</div><div class="line">cset = ax.contour(C,H,F)</div><div class="line"></div><div class="line">ax.set_xlabel(<span class="string">'consumption'</span>)</div><div class="line">ax.set_ylabel(<span class="string">'housing asset'</span>)</div><div class="line">ax.set_zlabel(<span class="string">'util'</span>)</div><div class="line">ax.set_title(<span class="string">"cst=&#123;0&#125;"</span>.format(cst))</div><div class="line">ax.view_init(<span class="number">25</span>, <span class="number">210</span>)</div><div class="line">plt.savefig(<span class="string">"0.png"</span>,transparent=<span class="keyword">True</span>)</div><div class="line">plt.show()</div></pre></td></tr></table></figure>
<p><img src="p-basic-39.png" alt=""></p>
<h3 id="Pairing-lists"><a href="#Pairing-lists" class="headerlink" title="Pairing lists"></a>Pairing lists</h3><p>Expressing conditional logic as array operations:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">xarr = np.array([<span class="number">1.1</span>, <span class="number">1.2</span>, <span class="number">1.3</span>, <span class="number">1.4</span>, <span class="number">1.5</span>])</div><div class="line">yarr = np.array([<span class="number">2.1</span>, <span class="number">2.2</span>, <span class="number">2.3</span>, <span class="number">2.4</span>, <span class="number">2.5</span>])</div><div class="line">cond = np.array([<span class="keyword">True</span>, <span class="keyword">False</span>, <span class="keyword">True</span>, <span class="keyword">True</span>, <span class="keyword">False</span>])</div><div class="line">result = [(x <span class="keyword">if</span> c <span class="keyword">else</span> y)</div><div class="line">          <span class="keyword">for</span> x, y, c <span class="keyword">in</span> zip(xarr, yarr, cond)]</div><div class="line">result <span class="comment"># [1.1000000000000001, 2.2000000000000002, 1.3, 1.3999999999999999, 2.5]</span></div></pre></td></tr></table></figure></p>
<h4 id="Boolean-toolkits"><a href="#Boolean-toolkits" class="headerlink" title="Boolean toolkits"></a>Boolean toolkits</h4><p>The numpy.where function is a vectorized version of the ternary expression <code>x if condition else y</code>. A typical use of where in data analysis is to produce a new array of values based on another array. Suppose you had a matrix of randomly generated data and you wanted to replace all positive values with 2 and all negative values with -2.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (continued)</span></div><div class="line">result = np.where(cond, xarr, yarr)</div><div class="line">result <span class="comment"># array([ 1.1,  2.2,  1.3,  1.4,  2.5])</span></div></pre></td></tr></table></figure></p>
<h3 id="Conditional-replacement"><a href="#Conditional-replacement" class="headerlink" title="Conditional replacement"></a>Conditional replacement</h3><p><strong>Example 1.</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">4</span>, <span class="number">4</span>)</div><div class="line">arr</div><div class="line">np.where(arr &gt; <span class="number">0</span>, <span class="number">2</span>, <span class="number">-2</span>)</div><div class="line">np.where(arr &gt; <span class="number">0</span>, <span class="number">2</span>, arr) <span class="comment"># set only positive values to 2</span></div></pre></td></tr></table></figure></p>
<p><img src="p-basic-09.png" alt=""></p>
<p><strong>Example 2.</strong> Consider I have two boolean arrays, cond1 and cond2, and wish to assign a different value for each of the 4 (2x2=4) possible pairs of boolean values.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Method 1. traditional version</span></div><div class="line">result = []</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(n):</div><div class="line">    <span class="keyword">if</span> cond1[i] <span class="keyword">and</span> cond2[i]:</div><div class="line">        result.append(<span class="number">0</span>)</div><div class="line">    <span class="keyword">elif</span> cond1[i]:</div><div class="line">        result.append(<span class="number">1</span>)</div><div class="line">    <span class="keyword">elif</span> cond2[i]:</div><div class="line">        result.append(<span class="number">2</span>)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        result.append(<span class="number">3</span>)</div><div class="line"></div><div class="line"><span class="comment"># Method 2. improved version</span></div><div class="line">np.where(cond1 &amp; cond2, <span class="number">0</span>, np.where(cond1, <span class="number">1</span>, np.where(cond2, <span class="number">2</span>, <span class="number">3</span>)))</div><div class="line"></div><div class="line"><span class="comment"># (continued)</span></div><div class="line"><span class="comment"># Method 3. Alternative method</span></div><div class="line">result = <span class="number">1</span> * cond1 + <span class="number">2</span> * cond2 + <span class="number">3</span> * - (cond1 | cond2)</div><div class="line"><span class="comment"># Example:</span></div><div class="line">ray =  <span class="number">10</span></div><div class="line">result = <span class="number">1</span>*(ray&gt;<span class="number">7</span>) + <span class="number">2</span>*(ray&lt;<span class="number">3</span>) + <span class="number">3</span> * -( ray&gt;<span class="number">7</span> | ray&lt;<span class="number">3</span> ) <span class="comment"># we use bitwise operator OR.</span></div><div class="line">result</div></pre></td></tr></table></figure></p>
<p>more: <a href="https://www.programiz.com/python-programming/operators#bitwise_operators" target="_blank" rel="external">Bitwise operators</a>; <a href="http://blog.csdn.net/carolzhang8406/article/details/6091649" target="_blank" rel="external">Operator Precednece</a></p>
<h5 id="Counting-events"><a href="#Counting-events" class="headerlink" title="Counting events"></a>Counting events</h5><p>Boolean values are coerced to 1 (True) and 0 (False) in the above methods. Thus, sum is often used as a means of <code>counting</code> True values in a boolean array:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr = randn(<span class="number">100</span>)</div><div class="line">(arr &gt; <span class="number">0</span>).sum() <span class="comment"># Number of positive values</span></div></pre></td></tr></table></figure></p>
<p><code>any</code> tests whether one or more values in an array is True, while <code>all</code> checks if every value is True:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">bools = np.array([<span class="keyword">False</span>, <span class="keyword">False</span>, <span class="keyword">True</span>, <span class="keyword">False</span>])</div><div class="line">bools.any()</div><div class="line">bools.all()</div></pre></td></tr></table></figure></p>
<h4 id="Sets-1"><a href="#Sets-1" class="headerlink" title="Sets"></a>Sets</h4><p>NumPy has some basic set operations for <code>one-dimensional</code> ndarrays. Probably the most commonly used one is np.unique, which returns the sorted unique values in an array.</p>
<h5 id="Basic-operations"><a href="#Basic-operations" class="headerlink" title="Basic operations"></a>Basic operations</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">names = np.array([<span class="string">'Bob'</span>,  <span class="string">'Will'</span>, <span class="string">'Joe'</span>, <span class="string">'Bob'</span>, <span class="string">'Will'</span>, <span class="string">'Joe'</span>, <span class="string">'Joe'</span>])</div><div class="line">np.unique(names) <span class="comment"># array(['Bob', 'Joe', 'Will'], dtype='|S4')</span></div><div class="line">ints = np.array([<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">4</span>])</div><div class="line"></div><div class="line"><span class="comment"># Method 1.</span></div><div class="line">np.unique(ints) <span class="comment"># array([1, 2, 3, 4])</span></div><div class="line"></div><div class="line"><span class="comment"># Method 2. a pure Python alternavie</span></div><div class="line">set(names)</div><div class="line">set</div><div class="line">sorted(set(names)) <span class="comment"># ['Bob', 'Joe', 'Will']</span></div><div class="line">set</div></pre></td></tr></table></figure>
<h5 id="Membership"><a href="#Membership" class="headerlink" title="Membership"></a>Membership</h5><p>To test membership of the values in one array in another, returning a boolean array, use <code>in1d</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">values = np.array([<span class="number">6</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>])</div><div class="line">np.in1d(values, [<span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>]) <span class="comment"># array([ True, False, False,  True,  True, False,  True], dtype=bool)</span></div></pre></td></tr></table></figure></p>
<p>More: intersect1d, union1d, setdiff1d, setxor1d<sup id="fnref:2"><a href="#fn:2" rel="footnote">2</a></sup></p>
<h5 id="Column-grouping-by-types"><a href="#Column-grouping-by-types" class="headerlink" title="Column grouping by types"></a>Column grouping by types</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line">df = pd.DataFrame([[<span class="number">1</span>, <span class="number">2.3456</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="number">78</span>]], columns=list(<span class="string">"ABCDE"</span>))</div><div class="line">df</div><div class="line">df.dtypes</div><div class="line"><span class="comment"># trick 1-1</span></div><div class="line">g = df.columns.to_series().groupby(df.dtypes).groups</div><div class="line">g</div><div class="line"><span class="comment"># trick 1-2</span></div><div class="line">dg = &#123;k.name: v <span class="keyword">for</span> k,v <span class="keyword">in</span> g.items()&#125; <span class="comment"># generate a dictionary of groups with contents</span></div><div class="line"><span class="comment"># outcome</span></div><div class="line">value = dg[<span class="string">'int64'</span>].values</div><div class="line">value</div></pre></td></tr></table></figure>
<h4 id="Numpy-functions"><a href="#Numpy-functions" class="headerlink" title="Numpy functions"></a>Numpy functions</h4><p>Almost every object in Python has attached functions, known as methods, that have access to the object’s internal contents.</p>
<h5 id="Summary-statistics"><a href="#Summary-statistics" class="headerlink" title="Summary statistics"></a>Summary statistics</h5><p>A universal function is a function that performs element-wise operations on data in ndarrays: <strong>sqrt(), square(), ceil(), floor(), rint(), modf(), isnan(), isfinite(), isinf().</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">10</span>)</div><div class="line">np.sqrt(arr)</div><div class="line">np.exp(arr)</div></pre></td></tr></table></figure></p>
<p>For example: swapaxes(), sum() &amp; mean()<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">16</span>).reshape((<span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>))</div><div class="line">arr.swapaxes(<span class="number">1</span>, <span class="number">2</span>) .shape <span class="comment"># (2L, 4L, 2L)</span></div><div class="line"></div><div class="line">arr = np.random.randn(<span class="number">5</span>, <span class="number">4</span>) <span class="comment"># normally-distributed data</span></div><div class="line">arr</div><div class="line">arr.mean() <span class="comment"># its own method (method 1)</span></div><div class="line">np.mean(arr) <span class="comment"># function from NumPy (method 2)</span></div><div class="line"></div><div class="line">arr.sum()</div><div class="line">arr.mean(axis=<span class="number">1</span>) <span class="comment"># Over axis 1: take average over axis=1 (columns) for each row; axis=1 collapses in the end)</span></div><div class="line">arr.sum(<span class="number">0</span>) <span class="comment"># Over axis 0: sum over rows for each column; axis=0 collapses</span></div></pre></td></tr></table></figure></p>
<h5 id="Cumulation"><a href="#Cumulation" class="headerlink" title="Cumulation"></a>Cumulation</h5><p>Other methods like <code>cumsum</code> and <code>cumprod</code> do not aggregate, instead producing an array<br>of the intermediate results:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = np.array([[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], [<span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]])</div><div class="line">arr.cumsum(<span class="number">0</span>) <span class="comment"># Over axis 0: sum over rows for each column</span></div><div class="line">arr.cumprod(<span class="number">1</span>) <span class="comment"># Over axis 1: product across columns for each row; values related to horizontal neighboring elements</span></div></pre></td></tr></table></figure></p>
<p>More: min, max, argmin, argmax</p>
<h5 id="Sorting"><a href="#Sorting" class="headerlink" title="Sorting"></a>Sorting</h5><p>The top level method <code>np.sort</code> returns a sorted copy of an array instead of modifying<br>the array in place.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> random</div><div class="line">l = range(<span class="number">1</span>,<span class="number">10</span>)</div><div class="line">ray = random.sample(l,<span class="number">8</span>)</div><div class="line">ray <span class="comment"># [4, 7, 2, 6, 5, 1, 8, 3]</span></div><div class="line"></div><div class="line">arr = np.array(ray)</div><div class="line">arr</div><div class="line"><span class="comment"># Method 1</span></div><div class="line">np.sort(arr) <span class="comment"># returns array([1, 2, 3, 4, 5, 6, 7, 8]), but arr doesn't change.</span></div><div class="line">arr</div><div class="line"><span class="comment"># Method 2</span></div><div class="line">arr.sort() <span class="comment"># use its own method. arr changes.</span></div><div class="line">arr</div></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> numpy.random <span class="keyword">import</span> randn</div><div class="line">arr = randn(<span class="number">8</span>)</div><div class="line">arr</div><div class="line">arr.sort()</div><div class="line">arr</div><div class="line"><span class="comment"># two dimensional ndarray</span></div><div class="line">arr = randn(<span class="number">5</span>, <span class="number">3</span>)</div><div class="line">arr</div><div class="line">arr.sort(<span class="number">1</span>) <span class="comment"># Over axis 1 (sorting within each row vector)</span></div><div class="line">arr</div></pre></td></tr></table></figure>
<h5 id="Quantiles"><a href="#Quantiles" class="headerlink" title="Quantiles"></a>Quantiles</h5><p>Task: Compute the quantiles of an array.<br>Hint: use the <code>sort</code> method to have it sorted in-place.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">large_arr = randn(<span class="number">10</span>)</div><div class="line">large_arr</div><div class="line">large_arr.sort()</div><div class="line">large_arr</div><div class="line">large_arr[int(<span class="number">0.05</span> * len(large_arr))] <span class="comment"># 5% quantile</span></div></pre></td></tr></table></figure></p>
<h5 id="tile-amp-repeat"><a href="#tile-amp-repeat" class="headerlink" title="tile &amp; repeat"></a>tile &amp; repeat</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">x = np.tile(np.arange(<span class="number">3</span>),<span class="number">3</span>)</div><div class="line">y = np.repeat(np.arange(<span class="number">3</span>),<span class="number">3</span>)</div><div class="line">df = pd.DataFrame(&#123;<span class="string">"x"</span>: x, <span class="string">"y"</span>: y&#125;)</div></pre></td></tr></table></figure>
<h4 id="Binary-universal-functions"><a href="#Binary-universal-functions" class="headerlink" title="Binary universal functions"></a>Binary universal functions</h4><p>Take 2 arrays (thus, binary ufuncs) and return a single array as the result: <strong>maximum(), subtract(), modf()</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">x = randn(<span class="number">8</span>)</div><div class="line">y = randn(<span class="number">8</span>)</div><div class="line">x</div><div class="line">y</div><div class="line">np.maximum(x, y) <span class="comment"># element-wise maximum</span></div><div class="line">np.subtract(x,y) <span class="comment"># the same as x-y</span></div><div class="line">x - y</div><div class="line"><span class="comment"># more:</span></div><div class="line">arr = randn(<span class="number">7</span>) * <span class="number">5</span></div><div class="line">np.modf(arr)</div></pre></td></tr></table></figure></p>
<p>More functions: add, subtract, multiply, divide, floor_divide, power, maximum, fmax, minimum, fmin, mod, copysign</p>
<h5 id="Transpose-and-swap-axes"><a href="#Transpose-and-swap-axes" class="headerlink" title="Transpose and swap axes"></a>Transpose and swap axes</h5><p>To compute the inner matrix product $X^T X$ use <code>np.dot</code>.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">15</span>).reshape((<span class="number">3</span>, <span class="number">5</span>))</div><div class="line">arr</div><div class="line">arr.T</div></pre></td></tr></table></figure></p>
<h6 id="transpose-amp-dot"><a href="#transpose-amp-dot" class="headerlink" title=".transpose() &amp; .dot()"></a>.transpose() &amp; .dot()</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">arr = np.random.randn(<span class="number">6</span>, <span class="number">3</span>)</div><div class="line">arr</div><div class="line">np.dot(arr.T, arr) <span class="comment"># inner matrix product</span></div><div class="line"></div><div class="line">arr = np.arange(<span class="number">16</span>).reshape((<span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>))</div><div class="line">arr</div><div class="line">arr.transpose((<span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>))</div></pre></td></tr></table></figure>
<h4 id="File-input-and-output"><a href="#File-input-and-output" class="headerlink" title="File input and output"></a>File input and output</h4><h5 id="np-save-np-load-np-savez"><a href="#np-save-np-load-np-savez" class="headerlink" title="np.save, np.load, np.savez"></a>np.save, np.load, np.savez</h5><p><code>np.save</code> and <code>np.load</code> are the two workhorse functions for efficiently saving and loading<br>array data on disk. Arrays are saved by default in an uncompressed raw binary format<br>with file extension <code>.npy</code>.</p>
<p>When loading an <code>.npz</code> file, you get back a <code>dict-like</code> object which loads the individual arrays lazily<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">arr = np.arange(<span class="number">10</span>)</div><div class="line"><span class="comment"># Method 1. generic method</span></div><div class="line">np.save(<span class="string">'some_array'</span>, arr)</div><div class="line">np.load(<span class="string">'some_array.npy'</span>)</div><div class="line"><span class="comment"># Method 2. save in a zip archive. When loading an .npz file, you get back a dict-like object:</span></div><div class="line">np.savez(<span class="string">'array_archive.npz'</span>, a=arr, b=arr)</div><div class="line">arch = np.load(<span class="string">'array_archive.npz'</span>)</div><div class="line">arch[<span class="string">'b'</span>]</div></pre></td></tr></table></figure></p>
<h5 id="np-loadtxt"><a href="#np-loadtxt" class="headerlink" title="np.loadtxt"></a>np.loadtxt</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">arr = np.loadtxt(<span class="string">'array_ex.txt'</span>, delimiter=<span class="string">','</span>)</div><div class="line">arr</div></pre></td></tr></table></figure>
<h4 id="Linear-algebra"><a href="#Linear-algebra" class="headerlink" title="Linear algebra"></a>Linear algebra</h4><p>There is a function <code>dot</code>, both an array method, and a function in the numpy namespace, for matrix multiplication:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">x = np.array([[<span class="number">1.</span>, <span class="number">2.</span>, <span class="number">3.</span>], [<span class="number">4.</span>, <span class="number">5.</span>, <span class="number">6.</span>]])</div><div class="line">y = np.array([[<span class="number">6.</span>, <span class="number">23.</span>], [<span class="number">-1</span>, <span class="number">7</span>], [<span class="number">8</span>, <span class="number">9</span>]])</div><div class="line">x</div><div class="line">y</div><div class="line"><span class="comment"># Method 1.</span></div><div class="line">x.dot(y)</div><div class="line"><span class="comment"># Method 2.</span></div><div class="line">np.dot(x,y)</div><div class="line"></div><div class="line">np.dot(x, np.ones(<span class="number">3</span>))</div><div class="line">np.random.seed(<span class="number">12345</span>)</div></pre></td></tr></table></figure></p>
<p><code>numpy.linalg</code> has a standard set of matrix decompositions and things like inverse anddeterminant.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> numpy.linalg <span class="keyword">import</span> inv, qr</div><div class="line">X = randn(<span class="number">5</span>, <span class="number">5</span>)</div><div class="line">mat = X.T.dot(X)</div><div class="line">inv(mat)</div><div class="line">mat.dot(inv(mat))</div><div class="line"><span class="comment"># decomposition</span></div><div class="line">q, r = qr(mat)</div><div class="line">r</div></pre></td></tr></table></figure></p>
<p>More: diag, dot, trace, det, eig, inv, pinv, qr, svd, <strong>solve</strong>, lstsq</p>
<h4 id="Case-Binning-data"><a href="#Case-Binning-data" class="headerlink" title="Case: Binning data"></a>Case: Binning data</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># method 1</span></div><div class="line"><span class="keyword">import</span> numpy</div><div class="line">data = numpy.random.random(<span class="number">100</span>)</div><div class="line">bins = numpy.linspace(<span class="number">0</span>, <span class="number">1</span>, <span class="number">10</span>)</div><div class="line">digitized = numpy.digitize(data, bins)</div><div class="line">digitized</div><div class="line">bin_means = [data[digitized == i].mean() <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(bins))]</div><div class="line">bin_means</div></pre></td></tr></table></figure>
<p>bins:<br><img src="p-basic-89.png" alt=""><br>digitized:<br><img src="p-basic-90.png" alt=""><br>bin_means:<br><img src="p-basic-91.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># method 2</span></div><div class="line"><span class="comment"># data</span></div><div class="line">raw_data = &#123;<span class="string">'Score'</span>: [<span class="number">25</span>, <span class="number">94</span>, <span class="number">57</span>, <span class="number">62</span>, <span class="number">70</span>, <span class="number">25</span>, <span class="number">94</span>, <span class="number">57</span>, <span class="number">62</span>, <span class="number">70</span>, <span class="number">62</span>, <span class="number">70</span>]&#125;</div><div class="line">df = DataFrame(raw_data)</div><div class="line"><span class="comment"># labels, either numeric or string</span></div><div class="line">group_names = list(np.arange(<span class="number">20</span>,<span class="number">91</span>,<span class="number">5</span>))</div><div class="line">group_bins  = np.arange(<span class="number">20</span>,<span class="number">96</span>,<span class="number">5</span>)</div><div class="line">df[<span class="string">'group'</span>] = pd.cut(df[<span class="string">'Score'</span>],group_bins,right=<span class="keyword">False</span>,labels=group_names)</div><div class="line">df</div><div class="line">dg = df[df.group==<span class="number">55</span>]</div><div class="line">dg</div><div class="line">pd.value_counts(df[<span class="string">'Score'</span>])</div></pre></td></tr></table></figure>
<p><img src="p-basic-95.png" alt=""><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">df[<span class="string">'score_binned'</span>] = pd.cut(df[<span class="string">'Score'</span>],group_bins,right=<span class="keyword">False</span>)</div><div class="line">df</div></pre></td></tr></table></figure></p>
<p><img src="p-basic-97.png" alt=""></p>
<h4 id="Case-counting-occurrence"><a href="#Case-counting-occurrence" class="headerlink" title="Case: counting occurrence"></a>Case: counting occurrence</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> collections</div><div class="line">a = [<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>]</div><div class="line">counter=collections.Counter(a)</div><div class="line">print(counter)</div><div class="line"><span class="comment"># Counter(&#123;1: 4, 2: 4, 3: 2, 5: 2, 4: 1&#125;)</span></div><div class="line">print(counter.values())</div><div class="line"><span class="comment"># [4, 4, 2, 1, 2]</span></div><div class="line">print(counter.keys())</div><div class="line"><span class="comment"># [1, 2, 3, 4, 5]</span></div><div class="line">print(counter.most_common(<span class="number">3</span>))</div><div class="line"><span class="comment"># [(1, 4), (2, 4), (3, 2)]</span></div></pre></td></tr></table></figure>
<h4 id="Case-weighted-quantile"><a href="#Case-weighted-quantile" class="headerlink" title="Case: weighted quantile"></a>Case: weighted quantile</h4><p>Reference <a href="https://stackoverflow.com/questions/21844024/weighted-percentile-using-numpy" target="_blank" rel="external">stackoverflow</a><br>Reference <a href="https://stackoverflow.com/questions/30057046/weighted-mean-in-numpy-python" target="_blank" rel="external">stackoverflow</a></p>
<h4 id="Case-Random-Walk"><a href="#Case-Random-Walk" class="headerlink" title="Case: Random Walk"></a>Case: Random Walk</h4><p>The <code>numpy.random</code> module supplements the built-in Python random with functions for<br>efficiently generating whole arrays of sample values from many kinds of probability distribution.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line">samples = np.random.normal(size=(<span class="number">4</span>, <span class="number">4</span>))</div><div class="line">samples</div></pre></td></tr></table></figure></p>
<h5 id="Method-1"><a href="#Method-1" class="headerlink" title="Method 1"></a>Method 1</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> random <span class="keyword">import</span> normalvariate</div><div class="line">N = <span class="number">1000000</span></div><div class="line">%timeit samples = [normalvariate(<span class="number">0</span>, <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> xrange(N)]</div><div class="line">%timeit np.random.normal(size=N)</div></pre></td></tr></table></figure>
<p>More: seed, permutation, shuffle, rand, randint, randn, binomial, normal, beta, chisquare, gamma, uniform</p>
<p><code>xrange</code> is a sequence object that evaluates lazily. <code>range</code> creates a list, so if you do range(1, 10000000) it creates a <code>list</code> in memory with 10000000 elements. xrange is a generator, so it is a <code>sequence object</code> is a that evaluates lazily.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Example: Random Walks</span></div><div class="line"><span class="comment"># Method 1. generic way</span></div><div class="line"><span class="keyword">import</span> random</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line">position = <span class="number">0</span> <span class="comment"># location on the y-axis overtime</span></div><div class="line">walk = [position]</div><div class="line">steps = <span class="number">1000</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(steps<span class="number">-1</span>):</div><div class="line">  step = <span class="number">1</span> <span class="keyword">if</span> random.randint(<span class="number">0</span>, <span class="number">1</span>) <span class="keyword">else</span> <span class="number">-1</span> <span class="comment"># pick a random number between 0 and 1</span></div><div class="line">  position += step</div><div class="line">  walk.append(position) <span class="comment"># append</span></div><div class="line">plt.plot(range(steps),walk)</div><div class="line">plt.show()</div></pre></td></tr></table></figure></p>
<h5 id="Method-2"><a href="#Method-2" class="headerlink" title="Method 2"></a>Method 2</h5><p>Alternatively, use the np.random module to draw 1,000 coin flips at once, set these to 1 and -1, and compute the cumulative sum.<br>Task: <strong>First crossing time</strong>, the step at which a random walk reaches a particular value.<br>How long did it take the random walk to get at least 10 steps away from the origin 0 in either direction<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Method 2. use np.random module</span></div><div class="line">np.random.seed(<span class="number">12345</span>)</div><div class="line">nsteps = <span class="number">1000</span></div><div class="line">draws = np.random.randint(<span class="number">0</span>, <span class="number">2</span>, size=nsteps) <span class="comment"># trick 1. draw an integer N from [a,b), b is not included</span></div><div class="line">steps = np.where(draws &gt; <span class="number">0</span>, <span class="number">1</span>, <span class="number">-1</span>) <span class="comment"># trick 2. conditioning</span></div><div class="line">walk = steps.cumsum() <span class="comment"># trick 3. cumulating</span></div><div class="line">plt.plot(range(nsteps),walk)</div><div class="line">plt.show()</div><div class="line">walk.min()</div><div class="line">walk.max()</div><div class="line">(np.abs(walk) &gt;= <span class="number">10</span>).argmax() <span class="comment"># 37 trick 4. the first True in the logical array.</span></div></pre></td></tr></table></figure></p>
<p>Turns out this can be computed using argmax, which returns the first index of the maximum value in the boolean array (<strong>True is the maximum value</strong>). Note that using argmax here is not always efficient because it always makes a full scan of the array. In this special case once a True is observed we know it to be the maximum value.</p>
<p><strong>Simulating many random walks at once</strong><br>Task: Compute the minimum crossing time to 30 or -30.<br>Hint: Compute the average of the first crossing time across histories<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">nwalks = <span class="number">5000</span></div><div class="line">nsteps = <span class="number">1000</span></div><div class="line">draws = np.random.randint(<span class="number">0</span>, <span class="number">2</span>, size=(nwalks, nsteps)) <span class="comment"># 0 or 1</span></div><div class="line">steps = np.where(draws &gt; <span class="number">0</span>, <span class="number">1</span>, <span class="number">-1</span>)</div><div class="line">walks = steps.cumsum(<span class="number">1</span>) <span class="comment"># trick.</span></div><div class="line">walks</div><div class="line">walks.max()</div><div class="line">walks.min()</div><div class="line"></div><div class="line"><span class="comment"># Count histories that hit the level of 30</span></div><div class="line">hits30 = (np.abs(walks) &gt;= <span class="number">30</span>)</div><div class="line">hits30</div><div class="line">hits30 = (np.abs(walks) &gt;= <span class="number">30</span>).any(<span class="number">1</span>) <span class="comment"># trick 5. For each row, to check whether there is any elements of True.</span></div><div class="line">hits30</div><div class="line">hits30.shape</div><div class="line">hits30.sum()</div><div class="line"></div><div class="line"><span class="comment"># To select out the rows of walks that actually cross the absolute 30 level</span></div><div class="line">crossing_times = (np.abs(walks[hits30]) &gt;= <span class="number">30</span>).argmax(<span class="number">1</span>) <span class="comment"># trick 6.</span></div><div class="line">(np.abs(walks[hits30]) &gt;= <span class="number">30</span>)</div><div class="line">crossing_times <span class="comment"># trick 7. The first index in each history that hits the level 30 or -30</span></div><div class="line">crossing_times.mean()</div></pre></td></tr></table></figure></p>
<p>Experiment with other probablity distribution for the steps other than equal sized coin flips:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">steps = np.random.normal(loc=<span class="number">0</span>, scale=<span class="number">0.25</span>, size=(nwalks, nsteps))</div></pre></td></tr></table></figure></p>
<h3 id="Pandas"><a href="#Pandas" class="headerlink" title="Pandas"></a>Pandas</h3><p>Data preparation refers to cleaning, munging, wranggling, reshaping raw data.<sup id="fnref:1"><a href="#fn:1" rel="footnote">1</a></sup></p>
<h4 id="Series"><a href="#Series" class="headerlink" title="Series"></a>Series</h4><p>A <code>Series</code> is an one-dimensional array-like object containing an array of data (of any NumPy data type) and an associated array of data labels, called its <code>index</code>. Compared with a regular NumPy array, you can use values in the index when selecting single values or a set of values.</p>
<h5 id="Combine-two-series-into-a-dataframe"><a href="#Combine-two-series-into-a-dataframe" class="headerlink" title="Combine two series into a dataframe"></a>Combine two series into a dataframe</h5><p>Reference <a href="https://stackoverflow.com/questions/18062135/combining-two-series-into-a-dataframe-in-pandas" target="_blank" rel="external">stackoverflow</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="number">4</span>, <span class="number">7</span>, <span class="number">-5</span>, <span class="number">3</span>])</div><div class="line">obj</div><div class="line">obj.values <span class="comment"># array([ 4,  7, -5,  3], dtype=int64)</span></div><div class="line">obj.index <span class="comment"># RangeIndex(start=0, stop=4, step=1)</span></div><div class="line"><span class="comment"># Create a series with an index indentifying each data point.</span></div><div class="line">obj2 = Series([<span class="number">4</span>, <span class="number">7</span>, <span class="number">-5</span>, <span class="number">3</span>], index=[<span class="string">'d'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>])</div><div class="line">obj2</div><div class="line">obj2.index</div><div class="line">obj2[<span class="string">'a'</span>]</div><div class="line">obj2[<span class="string">'d'</span>] = <span class="number">6</span></div><div class="line">obj2</div></pre></td></tr></table></figure>
<p><img src="p-basic-10.png" alt=""></p>
<p>NumPy array operations, such as filtering with a boolean array, scalar multiplication,<br>or applying math functions, will preserve the index-value link:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (continued)</span></div><div class="line">obj2</div><div class="line">obj2[[<span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]]</div><div class="line">obj2[obj2 &gt; <span class="number">0</span>]</div><div class="line">obj2 * <span class="number">2</span></div><div class="line">np.exp(obj2)</div><div class="line">obj2</div></pre></td></tr></table></figure></p>
<p><img src="p-basic-11.png" alt=""></p>
<p>Another way to think about a Series is as a fixed-length, <code>ordered dict</code>, as it is a mapping<br>of index values to data values.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="string">'b'</span> <span class="keyword">in</span> obj2</div><div class="line"><span class="string">'e'</span> <span class="keyword">in</span> obj2</div></pre></td></tr></table></figure></p>
<p><strong>When to use series.</strong> If you have data contained in a Python dict, you can create a Series from it by passing the dict:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sdata = &#123;<span class="string">'Ohio'</span>: <span class="number">35000</span>, <span class="string">'Texas'</span>: <span class="number">71000</span>, <span class="string">'Oregon'</span>: <span class="number">16000</span>, <span class="string">'Utah'</span>: <span class="number">5000</span>&#125;</div><div class="line">obj3 = Series(sdata)</div><div class="line">obj3</div><div class="line">states = [<span class="string">'California'</span>, <span class="string">'Ohio'</span>, <span class="string">'Oregon'</span>, <span class="string">'Texas'</span>]</div><div class="line">obj4 = Series(sdata, index=states)</div><div class="line">obj4</div></pre></td></tr></table></figure></p>
<p><img src="p-basic-12.png" alt=""></p>
<p>When only passing a dict, the index in the resulting Series will have the dict’s keys in sorted order. In this case, 3 values found in <em>sdata</em> were placed in the appropriate locations, but since no value for ‘California’ was found, it appears as <code>NaN</code> (not a number) which is considered in pandas to mark missing or NA values.</p>
<h5 id="isnull-amp-notnull"><a href="#isnull-amp-notnull" class="headerlink" title="isnull() &amp; notnull()"></a>isnull() &amp; notnull()</h5><p>The isnull and notnull functions in pandas should be used to detect missing data:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (continued)</span></div><div class="line">pd.isnull(obj4)</div><div class="line">pd.notnull(obj4) <span class="comment"># reverse of the answer in last line</span></div><div class="line">obj4.isnull() <span class="comment"># Series has its own isnull method</span></div><div class="line">obj3</div><div class="line">obj4 <span class="comment"># Utah is screened out from obj4 because `Utah` is considered when obj4 is created.</span></div><div class="line"><span class="comment"># any NaN ruins the operations.</span></div><div class="line">(obj3 + obj4).index <span class="comment"># Index([u'California', u'Ohio', u'Oregon', u'Texas', u'Utah'], dtype='object')</span></div><div class="line">(obj3 + obj4).values <span class="comment"># array([     nan,   70000.,   32000.,  142000.,      nan]) # Two NaN show.</span></div></pre></td></tr></table></figure></p>
<p><img src="p-basic-14.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Both the Series object itself and its index have a name attribute, which integrates with other key areas of pandas functionality.</span></div><div class="line">obj4.name = <span class="string">'population'</span></div><div class="line">obj4.index.name = <span class="string">'state'</span></div><div class="line">obj4</div></pre></td></tr></table></figure>
<p><img src="p-basic-15.png" alt=""></p>
<h5 id="indexing"><a href="#indexing" class="headerlink" title="indexing"></a>indexing</h5><p>Series indexing (obj[…]) works analogously to NumPy array indexing, except you can use the Series’s index values instead of only integers.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Indexing, selection, and filtering</span></div><div class="line">obj = Series(np.arange(<span class="number">4.</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</div><div class="line">obj</div><div class="line">obj[<span class="string">'b'</span>]</div><div class="line">obj[<span class="number">1</span>]</div><div class="line">obj[<span class="number">2</span>:<span class="number">4</span>]</div><div class="line">obj[[<span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>]] <span class="comment"># reordering</span></div><div class="line">obj[[<span class="number">1</span>, <span class="number">3</span>]]</div><div class="line">obj[obj &lt; <span class="number">2</span>]</div><div class="line">obj[<span class="string">'b'</span>:<span class="string">'c'</span>]</div><div class="line">obj[<span class="string">'b'</span>:<span class="string">'c'</span>] = <span class="number">5</span></div><div class="line">obj</div></pre></td></tr></table></figure></p>
<p>A Series’s index can be altered in place by assignment:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="number">4</span>, <span class="number">7</span>, <span class="number">-5</span>, <span class="number">3</span>])</div><div class="line">obj.index = [<span class="string">'Bob'</span>, <span class="string">'Steve'</span>, <span class="string">'Jeff'</span>, <span class="string">'Ryan'</span>]</div><div class="line">obj</div></pre></td></tr></table></figure></p>
<h5 id="element-wise-operations"><a href="#element-wise-operations" class="headerlink" title="element-wise operations"></a>element-wise operations</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">## reindex method, xs method, icol, irow methods, get_value and set_value method</span></div><div class="line"><span class="comment"># Arithmetic, data alignment, value filling</span></div><div class="line"></div><div class="line">s1 = Series([<span class="number">7.3</span>, <span class="number">-2.5</span>, <span class="number">3.4</span>, <span class="number">1.5</span>], index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</div><div class="line">s2 = Series([<span class="number">-2.1</span>, <span class="number">3.6</span>, <span class="number">-1.5</span>, <span class="number">4</span>, <span class="number">3.1</span>], index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>, <span class="string">'g'</span>])</div><div class="line">s1</div><div class="line">s2</div><div class="line"><span class="comment"># The internal data alignment introduces NA values in the indices that don’t overlap.</span></div><div class="line">s1 + s2</div></pre></td></tr></table></figure>
<h4 id="DataFrame"><a href="#DataFrame" class="headerlink" title="DataFrame"></a>DataFrame</h4><p>The DataFrame has both a row and column index; it can be thought of as a dict of Series, each of which can be a different value type (numeric, string, boolean, etc.). The resulting DataFrame will have its index assigned automatically as with Series, and the columns are placed in sorted order.</p>
<h5 id="Convert-DataFrame-to-Narray-preserving-index"><a href="#Convert-DataFrame-to-Narray-preserving-index" class="headerlink" title="Convert DataFrame to Narray preserving index"></a>Convert DataFrame to Narray preserving index</h5><p>Reference <a href="https://stackoverflow.com/questions/13187778/convert-pandas-dataframe-to-numpy-array-preserving-index" target="_blank" rel="external">stackoverflow</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># data</span></div><div class="line">data = &#123;<span class="string">'state'</span>: [<span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Nevada'</span>, <span class="string">'Nevada'</span>], <span class="string">'year'</span>: [<span class="number">2000</span>, <span class="number">2001</span>, <span class="number">2002</span>, <span class="number">2001</span>, <span class="number">2002</span>], <span class="string">'pop'</span>: [<span class="number">1.5</span>, <span class="number">1.7</span>, <span class="number">3.6</span>, <span class="number">2.4</span>, <span class="number">2.9</span>]&#125;</div><div class="line">frame = DataFrame(data)</div><div class="line">frame</div><div class="line"><span class="comment"># rearrange the order of columns</span></div><div class="line">DataFrame(data, columns=[<span class="string">'year'</span>, <span class="string">'state'</span>, <span class="string">'pop'</span>])</div></pre></td></tr></table></figure>
<p><img src="p-basic-48.png" alt=""></p>
<h5 id="Blank-data-frame"><a href="#Blank-data-frame" class="headerlink" title="Blank data frame"></a>Blank data frame</h5><p>As with Series, if you pass a column that isn’t contained in data, it will appear with NA values in the result:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (continued)</span></div><div class="line"><span class="comment"># column names and index</span></div><div class="line">frame2 = DataFrame(data, columns=[<span class="string">'year'</span>, <span class="string">'state'</span>, <span class="string">'pop'</span>, <span class="string">'debt'</span>], index=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>, <span class="string">'five'</span>])</div><div class="line">frame2</div><div class="line"><span class="comment"># only column names</span></div><div class="line">frame3 = DataFrame(data, columns=[<span class="string">'year'</span>, <span class="string">'state'</span>, <span class="string">'pop'</span>, <span class="string">'debt'</span>])</div><div class="line">frame3</div></pre></td></tr></table></figure></p>
<p><img src="p-basic-49.png" alt=""></p>
<h5 id="Access-sort-values"><a href="#Access-sort-values" class="headerlink" title="Access sort_values"></a>Access sort_values</h5><p>Reference <a href="https://stackoverflow.com/questions/30813088/pandas-how-to-get-scalar-value-on-a-cell-using-conditional-indexing" target="_blank" rel="external">stackoverflow</a></p>
<h5 id="Replacing-values"><a href="#Replacing-values" class="headerlink" title="Replacing values"></a>Replacing values</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># data</span></div><div class="line">df = DataFrame(np.arange(<span class="number">9</span>).reshape([<span class="number">3</span>,<span class="number">3</span>]),columns=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>])</div><div class="line">df</div><div class="line">dg = DataFrame(np.where(df&gt;<span class="number">4</span>,df*<span class="number">10</span>,df),columns=df.columns)</div><div class="line">dg</div></pre></td></tr></table></figure>
<p><img src="p-basic-99.png" alt=""></p>
<h5 id="Reverse-the-row-order"><a href="#Reverse-the-row-order" class="headerlink" title="Reverse the row order"></a>Reverse the row order</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">reversed_df = df.iloc[::<span class="number">-1</span>]</div></pre></td></tr></table></figure>
<h5 id="Get-dummy-variables"><a href="#Get-dummy-variables" class="headerlink" title="Get dummy variables"></a>Get dummy variables</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">df = pd.concat([df, pd.get_dummies(df[<span class="string">'YEAR'</span>])], axis=<span class="number">1</span>); df</div></pre></td></tr></table></figure>
<h5 id="Pandas-indexing"><a href="#Pandas-indexing" class="headerlink" title="Pandas indexing"></a>Pandas indexing</h5><h6 id="with-Series"><a href="#with-Series" class="headerlink" title="with Series"></a>with Series</h6><p>If you assign a Series to a column, it will be instead conformed exactly to the DataFrame’s index, inserting missing values in any holes:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (continued)</span></div><div class="line">val = Series([<span class="number">-1.2</span>, <span class="number">-1.5</span>, <span class="number">-1.7</span>], index=[<span class="string">'two'</span>, <span class="string">'four'</span>, <span class="string">'five'</span>]) <span class="comment"># a series</span></div><div class="line">frame2[<span class="string">'debt'</span>] = val</div><div class="line">frame2</div></pre></td></tr></table></figure></p>
<p><img src="p-basic-50.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (continued)</span></div><div class="line">frame2[<span class="string">'debt'</span>] = <span class="number">16.5</span></div><div class="line">frame2</div><div class="line">frame2[<span class="string">'debt'</span>] = np.arange(<span class="number">5.</span>)</div><div class="line">frame2</div></pre></td></tr></table></figure>
<p><img src="p-basic-54.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">frame2[:<span class="number">2</span>]</div><div class="line">frame2[frame2[<span class="string">'pop'</span>]&gt;<span class="number">2.</span>]</div></pre></td></tr></table></figure>
<p><img src="p-basic-58.png" alt=""></p>
<h5 id="Rearrange-columns"><a href="#Rearrange-columns" class="headerlink" title="Rearrange columns"></a>Rearrange columns</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># continued</span></div><div class="line">cols = frame2.columns.tolist()</div><div class="line">cols <span class="comment"># ['year', 'state', 'pop', 'debt']</span></div><div class="line"><span class="comment"># Suppose we want to moved the last element to the first position:</span></div><div class="line">cols = cols[<span class="number">-1</span>:] + cols[:<span class="number">-1</span>]</div><div class="line">cols <span class="comment"># ['debt', 'year', 'state', 'pop']</span></div><div class="line">frame2 = frame2[cols]</div><div class="line">frame2</div></pre></td></tr></table></figure>
<p>Incase the pops up the error message, “cannot concatenate ‘str’ and ‘list’ objects.” Make sure you bracket, i.e., [] the str value in cols: cols = [cols[7]] + cols[:7] + cols[8:].<br><img src="p-basic-60.png" alt=""></p>
<h5 id="Keep-slice-columns"><a href="#Keep-slice-columns" class="headerlink" title="Keep/slice columns"></a>Keep/slice columns</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">df = pd.DataFrame(np.random.randn(<span class="number">3</span>,<span class="number">6</span>))</div><div class="line">df</div><div class="line">df[list(df.columns[:<span class="number">2</span>]) + [<span class="number">4</span>]]</div></pre></td></tr></table></figure>
<p><img src="p-basic-88.png" alt=""></p>
<h5 id="Pandas-conditional-indexing"><a href="#Pandas-conditional-indexing" class="headerlink" title="Pandas conditional indexing"></a>Pandas conditional indexing</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># display row entries</span></div><div class="line">frame2.loc[<span class="string">'two'</span>] <span class="comment"># show rows. as opposed to the command to show columns, ex: frame2['year']</span></div><div class="line">frame2.loc[frame2.state==<span class="string">"Ohio"</span>, <span class="string">"pop"</span>] = <span class="number">-10.</span> <span class="comment"># show by bool</span></div><div class="line">frame2</div></pre></td></tr></table></figure>
<p><img src="p-basic-55.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># data</span></div><div class="line">data = DataFrame(np.arange(<span class="number">16</span>).reshape((<span class="number">4</span>, <span class="number">4</span>)), index=[<span class="string">'Ohio'</span>, <span class="string">'Colorado'</span>, <span class="string">'Utah'</span>, <span class="string">'New York'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>])</div><div class="line">data</div><div class="line"><span class="comment"># Method 1. use single label, and a list of labels</span></div><div class="line">data.loc[<span class="string">'Colorado'</span>, [<span class="string">'two'</span>, <span class="string">'three'</span>]]</div><div class="line"><span class="comment"># Method 2. use numeric index and colon</span></div><div class="line">data.iloc[<span class="number">2</span>,:]</div><div class="line"><span class="comment"># Method 3. colon works with "single" label</span></div><div class="line">data.loc[:<span class="string">'Utah'</span>, <span class="string">'two'</span>]</div><div class="line"><span class="comment"># Method 4. choose all the columns</span></div><div class="line">data.loc[:<span class="string">'Utah'</span>,data.columns]</div></pre></td></tr></table></figure>
<p><img src="p-basic-93.png" alt=""></p>
<p><strong>Application of index &amp; loc</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (continued)</span></div><div class="line"><span class="comment"># to replicate the result from data.ix(data.three&gt;5,:3)</span></div><div class="line">data.index[data.three &gt; <span class="number">5</span>] <span class="comment"># Index(['Colorado', 'Utah', 'New York'], dtype='object')</span></div><div class="line">data.index[data.three &gt; <span class="number">5</span>].tolist() <span class="comment"># ['Colorado', 'Utah', 'New York']</span></div><div class="line"><span class="comment"># to show conditional data</span></div><div class="line">data.loc[data.index[data.three &gt; <span class="number">5</span>].tolist(), data.columns[:<span class="number">3</span>]] <span class="comment"># tricky.!! Method 1</span></div></pre></td></tr></table></figure></p>
<p><img src="p-basic-19.png" alt=""></p>
<p><strong>Application using np.where &amp; iloc</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">dx1 = list(np.where(data.three&gt;<span class="number">5</span>)[<span class="number">0</span>]) <span class="comment"># The tricky thing is we need [0].!!!!!!! Otherwise, it doesn't work.</span></div><div class="line"></div><div class="line">data.iloc[dx1,[<span class="number">1</span>,<span class="number">2</span>]] <span class="comment"># tricky.!! Method 2.</span></div><div class="line">data.iloc[[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">1</span>,<span class="number">2</span>]]</div></pre></td></tr></table></figure></p>
<p><img src="p-basic-20.png" alt=""></p>
<p><strong>Application of complex conditions</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">data</div><div class="line"><span class="comment"># One &gt; 9 and Three &gt;15</span></div><div class="line">(data[<span class="string">"one"</span>]&lt;=<span class="number">9</span>)&amp;(data[<span class="string">"three"</span>]&lt;=<span class="number">15</span>)</div><div class="line">data.loc[(data[<span class="string">"one"</span>]&lt;=<span class="number">9</span>)&amp;(data[<span class="string">"three"</span>]&lt;=<span class="number">15</span>), <span class="string">"four"</span> ]</div><div class="line"></div><div class="line"><span class="comment"># Note: data.loc[data["one"]&lt;=9&amp;data["three"]&lt;=15, "four" ] doesn't work, because</span></div><div class="line"><span class="comment"># you need to put in parenthesis.</span></div></pre></td></tr></table></figure></p>
<p><img src="p-basic-61.png" alt=""><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data.loc[(data[<span class="string">"one"</span>]&lt;=<span class="number">9</span>)&amp;(data[<span class="string">"three"</span>]&lt;=<span class="number">15</span>), <span class="string">"four"</span> ] *= <span class="number">10</span></div><div class="line">data</div></pre></td></tr></table></figure></p>
<p><img src="p-basic-62.png" alt=""></p>
<p>If you have multiple values you want to include, put them in a list (or more generally, any iterable):<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">data.loc[data[<span class="string">'one'</span>].isin([<span class="number">4</span>,<span class="number">8</span>])]</div><div class="line">data.loc[~data[<span class="string">'one'</span>].isin([<span class="number">4</span>,<span class="number">8</span>])]</div></pre></td></tr></table></figure></p>
<p><img src="p-basic-64.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">temp = data.query(<span class="string">'one&lt;=9 &amp; three&lt;=15'</span>)</div><div class="line">temp</div></pre></td></tr></table></figure>
<p>Reference: <a href="https://stackoverflow.com/questions/17071871/select-rows-from-a-dataframe-based-on-values-in-a-column-in-pandas" target="_blank" rel="external">stackoverflow</a></p>
<h5 id="Rename-columns"><a href="#Rename-columns" class="headerlink" title="Rename columns"></a>Rename columns</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(np.arange(<span class="number">16</span>).reshape((<span class="number">4</span>, <span class="number">4</span>)), index=[<span class="string">'Ohio'</span>, <span class="string">'Colorado'</span>, <span class="string">'Utah'</span>, <span class="string">'New York'</span>], columns=[<span class="string">'price1'</span>, <span class="string">'price2'</span>, <span class="string">'price3'</span>, <span class="string">'volume'</span>])</div><div class="line">data</div><div class="line">data.rename(columns=&#123;<span class="string">'price1'</span>:<span class="string">'Price-A'</span>,<span class="string">'price2'</span>:<span class="string">'Price-B'</span>,<span class="string">'price3'</span>:<span class="string">'Price-C'</span>&#125;,inplace=<span class="keyword">True</span>)</div><div class="line">data</div></pre></td></tr></table></figure>
<p><img src="p-basic-92.png" alt=""></p>
<h5 id="Lowercase-columns"><a href="#Lowercase-columns" class="headerlink" title="Lowercase columns"></a>Lowercase columns</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># continued</span></div><div class="line"><span class="comment"># method 1</span></div><div class="line">data.columns = map(str.lower,data.columns)</div><div class="line"><span class="comment"># or equivalently, data.columns = data.columns.str.lower()</span></div><div class="line">data</div><div class="line"><span class="comment"># method 2</span></div><div class="line">data.columns = [x.lower() <span class="keyword">for</span> x <span class="keyword">in</span> data.columns]</div></pre></td></tr></table></figure>
<p><img src="p-basic-100.png" alt=""></p>
<h5 id="Drop-names-with-prefix"><a href="#Drop-names-with-prefix" class="headerlink" title="Drop names with prefix"></a>Drop names with prefix</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(np.arange(<span class="number">16</span>).reshape((<span class="number">4</span>, <span class="number">4</span>)), index=[<span class="string">'Ohio'</span>, <span class="string">'Colorado'</span>, <span class="string">'Utah'</span>, <span class="string">'New York'</span>], columns=[<span class="string">'price1'</span>, <span class="string">'price2'</span>, <span class="string">'price3'</span>, <span class="string">'volume'</span>])</div><div class="line">data</div><div class="line"><span class="comment"># Show column names</span></div><div class="line">data.columns <span class="comment"># Index(['price1', 'price2', 'price3', 'volume'], dtype='object')</span></div><div class="line"><span class="comment"># method 1. use a list of columns to keep.</span></div><div class="line">cols = [c <span class="keyword">for</span> c <span class="keyword">in</span> data.columns <span class="keyword">if</span> c.lower()[:<span class="number">5</span>]!=<span class="string">'price'</span>] <span class="comment"># ['volume']</span></div><div class="line">data1 = data[cols]</div><div class="line">data1</div><div class="line"><span class="comment"># method 2. use 'difference' to remove columns prefixed with 'price'</span></div><div class="line">data2 = data[data.columns.difference([c <span class="keyword">for</span> c <span class="keyword">in</span> data.columns <span class="keyword">if</span> c.lower()[:<span class="number">5</span>]==<span class="string">'price'</span>])]</div><div class="line">data2</div></pre></td></tr></table></figure>
<p><img src="p-basic-71.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (continued)</span></div><div class="line"><span class="comment"># method 3.</span></div><div class="line">my_cols = set(data.columns)</div><div class="line">new_cols = &#123;x <span class="keyword">for</span> x <span class="keyword">in</span> my_cols <span class="keyword">if</span> <span class="string">"price"</span> <span class="keyword">not</span> <span class="keyword">in</span> x&#125;</div><div class="line">data3 = data[list(new_cols)]</div><div class="line">data3</div></pre></td></tr></table></figure>
<p><img src="p-basic-72.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># method 2 (continued)</span></div><div class="line">data2 = data[data.columns.drop(list(data.filter(regex=<span class="string">'price'</span>)))]</div><div class="line"><span class="comment"># method 3</span></div><div class="line"><span class="keyword">import</span> re</div><div class="line">data3 = data.select(<span class="keyword">lambda</span> x: <span class="keyword">not</span> re.search(<span class="string">'price\d+'</span>,x),axis=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<h5 id="DataFrame-math"><a href="#DataFrame-math" class="headerlink" title="DataFrame math"></a>DataFrame math</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">df1 = DataFrame(np.arange(<span class="number">9.</span>).reshape((<span class="number">3</span>, <span class="number">3</span>)), columns=list(<span class="string">'bcd'</span>), index=[<span class="string">'Ohio'</span>, <span class="string">'Texas'</span>, <span class="string">'Colorado'</span>])</div><div class="line">df2 = DataFrame(np.arange(<span class="number">12.</span>).reshape((<span class="number">4</span>, <span class="number">3</span>)), columns=list(<span class="string">'bde'</span>), index=[<span class="string">'Utah'</span>, <span class="string">'Ohio'</span>, <span class="string">'Texas'</span>, <span class="string">'Oregon'</span>])</div><div class="line">df1</div><div class="line">df2</div><div class="line">df1 + df2</div></pre></td></tr></table></figure>
<p><img src="p-basic-21.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Arithmetic methods with fill values</span></div><div class="line">df1 = DataFrame(np.arange(<span class="number">12.</span>).reshape((<span class="number">3</span>, <span class="number">4</span>)), columns=list(<span class="string">'abcd'</span>))</div><div class="line">df2 = DataFrame(np.arange(<span class="number">20.</span>).reshape((<span class="number">4</span>, <span class="number">5</span>)), columns=list(<span class="string">'abcde'</span>))</div><div class="line">df1</div><div class="line">df2</div><div class="line"><span class="comment"># Adding these together results in NA values in the locations that don’t overlap:</span></div><div class="line">df1 + df2</div></pre></td></tr></table></figure>
<p><img src="p-basic-80.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (continued)</span></div><div class="line"><span class="comment"># Using the add method on df1, I pass df2 and an argument to fill_value:</span></div><div class="line">df1.add(df2, fill_value=<span class="number">0</span>)</div><div class="line">df2 = df1.reindex(columns=df2.columns, fill_value=<span class="number">0</span>)</div><div class="line">df2</div><div class="line"><span class="comment"># Use sub and specify axis=0 (to consider the row indices when matching up labels instead of the column indices as is the default)</span></div><div class="line"><span class="comment"># Here we want to subtract the values in c from its counterparts in a and b</span></div><div class="line">df2[[<span class="string">'a'</span>,<span class="string">'b'</span>]].sub(df2[<span class="string">'c'</span>],axis=<span class="number">0</span>)</div></pre></td></tr></table></figure>
<p><img src="p-basic-81.png" alt=""><br>More: add, sub, div, mul</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Operations between DataFrame and Series</span></div><div class="line">arr = np.arange(<span class="number">12.</span>).reshape((<span class="number">3</span>, <span class="number">4</span>))</div><div class="line">arr</div><div class="line">arr[<span class="number">0</span>]</div><div class="line">arr - arr[<span class="number">0</span>]</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.arange(<span class="number">12.</span>).reshape((<span class="number">4</span>, <span class="number">3</span>)), columns=list(<span class="string">'bde'</span>), index=[<span class="string">'Utah'</span>, <span class="string">'Ohio'</span>, <span class="string">'Texas'</span>, <span class="string">'Oregon'</span>])</div><div class="line">series = frame.iloc[<span class="number">0</span>]</div><div class="line">frame</div><div class="line">series</div><div class="line"><span class="comment"># By default, arithmetic between DataFrame and Series matches the index of the Series on the DataFrame's columns, broadcasting down the rows:</span></div><div class="line">frame - series</div></pre></td></tr></table></figure>
<p><img src="p-basic-24.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">series2 = Series(range(<span class="number">3</span>), index=[<span class="string">'b'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>])</div><div class="line">series2</div><div class="line"><span class="comment"># If an index value is not found in either the DataFrame’s columns or the Series’s index, the objects will be reindexed to form the union:</span></div><div class="line">frame + series2</div><div class="line"><span class="comment"># If you want to instead broadcast over the columns, "matching on the rows", you have to use one of the arithmetic methods.</span></div><div class="line">series3 = frame[<span class="string">'d'</span>]</div><div class="line">series3</div><div class="line">frame</div></pre></td></tr></table></figure>
<p><img src="p-basic-36.png" alt=""><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">series3</div><div class="line">frame.sub(series3, axis=<span class="number">0</span>)</div></pre></td></tr></table></figure></p>
<p><img src="p-basic-37.png" alt=""></p>
<h5 id="Delete-np-nan"><a href="#Delete-np-nan" class="headerlink" title="Delete np.nan"></a>Delete np.nan</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># data set</span></div><div class="line">df01 = frame + series2</div><div class="line">df01</div><div class="line">df01.loc[<span class="string">'Ohio'</span>,<span class="string">'d'</span>] = <span class="number">1</span></div><div class="line">df01</div><div class="line">df01 = df01[np.isfinite(df01[<span class="string">'d'</span>])]</div><div class="line">df01</div></pre></td></tr></table></figure>
<p><img src="p-basic-38.png" alt=""></p>
<h5 id="Delete-a-column"><a href="#Delete-a-column" class="headerlink" title="Delete a column"></a>Delete a column</h5><p>Add or delete a column from a DataFrame.</p>
<h6 id="del"><a href="#del" class="headerlink" title="del"></a>del</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">frame2[<span class="string">'eastern'</span>] = frame2.state == <span class="string">'Ohio'</span></div><div class="line">frame2</div><div class="line"><span class="keyword">del</span> frame2[<span class="string">'eastern'</span>]</div><div class="line">frame2.columns</div></pre></td></tr></table></figure>
<p>Note the column returned when indexing a DataFrame is a view on the underlying data, not a copy. Thus, any in-place modifications to the Series will be reflected in the DataFrame. The column can be explicitly copied using the Series’s copy method.</p>
<h6 id="drop"><a href="#drop" class="headerlink" title="drop()"></a>drop()</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Dropping entries from an axis</span></div><div class="line">obj = Series(np.arange(<span class="number">5.</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</div><div class="line">new_obj = obj.drop(<span class="string">'c'</span>)</div><div class="line">new_obj</div><div class="line">obj.drop([<span class="string">'d'</span>, <span class="string">'c'</span>])</div></pre></td></tr></table></figure>
<p><img src="p-basic34.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(np.arange(<span class="number">16</span>).reshape((<span class="number">4</span>, <span class="number">4</span>)), index=[<span class="string">'Ohio'</span>, <span class="string">'Colorado'</span>, <span class="string">'Utah'</span>, <span class="string">'New York'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>, <span class="string">'four'</span>])</div><div class="line">data.drop([<span class="string">'Colorado'</span>, <span class="string">'Ohio'</span>])</div><div class="line">data.drop(<span class="string">'two'</span>, axis=<span class="number">1</span>) <span class="comment"># delete it from columns</span></div><div class="line">data.drop([<span class="string">'two'</span>, <span class="string">'four'</span>], axis=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<p><img src="p-basic35.png" alt=""></p>
<h5 id="Nested-dict-inputs"><a href="#Nested-dict-inputs" class="headerlink" title="Nested dict inputs"></a>Nested dict inputs</h5><p>When a <code>nested dict</code> is passed to DataFrame, it will interpret the <code>outer</code> dict keys of the passed data as the <code>columns</code> and the inner keys as the row indices. The keys in the inner dicts are unioned and sorted to form the index in the result. This rule isn’t true if an explicit index is specified:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">pop = &#123;<span class="string">'Nevada'</span>: &#123;<span class="number">2001</span>: <span class="number">2.4</span>, <span class="number">2002</span>: <span class="number">2.9</span>&#125;, <span class="string">'Ohio'</span>: &#123;<span class="number">2000</span>: <span class="number">1.5</span>, <span class="number">2001</span>: <span class="number">1.7</span>, <span class="number">2002</span>: <span class="number">3.6</span>&#125;&#125;</div><div class="line">frame3 = DataFrame(pop)</div><div class="line">frame3</div><div class="line">frame3.T</div><div class="line"><span class="comment"># The keys in the inner dicts are unioned and sorted</span></div><div class="line">DataFrame(pop, index=[<span class="number">2001</span>, <span class="number">2002</span>, <span class="number">2003</span>])</div></pre></td></tr></table></figure></p>
<h5 id="Subset-by-rows"><a href="#Subset-by-rows" class="headerlink" title="Subset by rows"></a>Subset by rows</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">pop = &#123;<span class="string">'Nevada'</span>: &#123;<span class="number">2001</span>: <span class="number">2.4</span>, <span class="number">2002</span>: <span class="number">2.9</span>&#125;, <span class="string">'Ohio'</span>: &#123;<span class="number">2000</span>: <span class="number">1.5</span>, <span class="number">2001</span>: <span class="number">1.7</span>, <span class="number">2002</span>: <span class="number">3.6</span>&#125;&#125;</div><div class="line">frame3 = DataFrame(pop)</div><div class="line">frame3</div><div class="line">pdata = &#123;<span class="string">'Ohio'</span>: frame3[<span class="string">'Ohio'</span>][:<span class="number">-1</span>], <span class="string">'Nevada'</span>: frame3[<span class="string">'Nevada'</span>][:<span class="number">2</span>]&#125;</div><div class="line">DataFrame(pdata)</div></pre></td></tr></table></figure>
<p><img src="p-basic-59.png" alt=""></p>
<h5 id="name-amp-value-attributes"><a href="#name-amp-value-attributes" class="headerlink" title="name &amp; value attributes"></a>name &amp; value attributes</h5><p>If a DataFrame’s index and columns have their name attributes set, these will also be displayed:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (continued)</span></div><div class="line">frame3.index.name = <span class="string">'year'</span></div><div class="line">frame3.columns.name = <span class="string">'state'</span></div><div class="line">frame3</div><div class="line">frame3.values</div><div class="line">frame2</div><div class="line">frame2.values</div></pre></td></tr></table></figure></p>
<h5 id="Index-immutable"><a href="#Index-immutable" class="headerlink" title="Index immutable"></a>Index immutable</h5><p>Any array or other sequence of labels used when constructing a Series or DataFrame is internally converted to an Index. In addition to being array-like, an Index also functions as a fixed-size set:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line">obj = Series(range(<span class="number">3</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">index = obj.index</div><div class="line">index</div><div class="line">obj = Series(np.arange(<span class="number">3</span>), index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">index = obj.index</div><div class="line">index</div><div class="line">index[<span class="number">1</span>:]</div><div class="line">index[<span class="number">1</span>] = <span class="string">'d'</span> <span class="comment"># Error!! Index objects are immutable</span></div><div class="line">index = pd.Index(np.arange(<span class="number">3</span>))</div><div class="line">obj2 = Series([<span class="number">1.5</span>, <span class="number">-2.5</span>, <span class="number">0</span>], index=index)</div><div class="line">obj2.index <span class="keyword">is</span> index</div></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">pop = &#123;<span class="string">'Nevada'</span>: &#123;<span class="number">2001</span>: <span class="number">2.4</span>, <span class="number">2002</span>: <span class="number">2.9</span>&#125;, <span class="string">'Ohio'</span>: &#123;<span class="number">2000</span>: <span class="number">1.5</span>, <span class="number">2001</span>: <span class="number">1.7</span>, <span class="number">2002</span>: <span class="number">3.6</span>&#125;&#125;</div><div class="line">frame3 = DataFrame(pop)</div><div class="line">frame3</div><div class="line"><span class="string">'Ohio'</span> <span class="keyword">in</span> frame3.columns</div><div class="line"><span class="number">2003</span> <span class="keyword">in</span> frame3.index</div></pre></td></tr></table></figure>
<h5 id="Index-as-a-set"><a href="#Index-as-a-set" class="headerlink" title="Index as a set"></a>Index as a set</h5><h6 id="reindex"><a href="#reindex" class="headerlink" title="reindex"></a>reindex</h6><p>To create a new object with the data conformed to a new index:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">obj = Series([<span class="number">4.5</span>, <span class="number">7.2</span>, <span class="number">-5.3</span>, <span class="number">3.6</span>], index=[<span class="string">'d'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'c'</span>])</div><div class="line">obj</div><div class="line">obj2 = obj.reindex([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>])</div><div class="line">obj2</div><div class="line">obj.reindex([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>], fill_value=<span class="number">0</span>)</div></pre></td></tr></table></figure></p>
<p>More: append, diff, intersection, union, isin, delete, drop, insert, is_monotonic, is_unique, unique</p>
<h6 id="set-index-amp-reset-index"><a href="#set-index-amp-reset-index" class="headerlink" title="set_index &amp; reset_index"></a>set_index &amp; reset_index</h6><p>It’s not unusual to want to use one or more columns from a DataFrame as the row index; alternatively, you may wish to move the row index into the DataFrame’s columns.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Using a DataFrame's columns</span></div><div class="line">frame = DataFrame(&#123;<span class="string">'a'</span>: range(<span class="number">7</span>), <span class="string">'b'</span>: range(<span class="number">7</span>, <span class="number">0</span>, <span class="number">-1</span>), <span class="string">'c'</span>: [<span class="string">'one'</span>, <span class="string">'one'</span>, <span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'two'</span>, <span class="string">'two'</span>, <span class="string">'two'</span>], <span class="string">'d'</span>: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;)</div><div class="line">frame</div><div class="line">frame2 = frame.set_index([<span class="string">'c'</span>, <span class="string">'d'</span>])</div><div class="line">frame2</div></pre></td></tr></table></figure></p>
<p><img src="p-basic-26.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># By default the columns used for creating indices are removed from the DataFrame, though you can leave them in:</span></div><div class="line">frame.set_index([<span class="string">'c'</span>, <span class="string">'d'</span>], drop=<span class="keyword">False</span>)</div><div class="line">frame2.reset_index(inplace=<span class="keyword">True</span>)</div><div class="line">frame2</div></pre></td></tr></table></figure>
<p><img src="p-basic-27.png" alt=""></p>
<h5 id="Interpolation"><a href="#Interpolation" class="headerlink" title="Interpolation"></a>Interpolation</h5><p>For ordered data like time series, it may be desirable to do some interpolation or filling of values when reindexing. The method option allows us to do this, using a method such as ffill which <code>forward fills</code> the values:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">obj3 = Series([<span class="string">'blue'</span>, <span class="string">'purple'</span>, <span class="string">'yellow'</span>], index=[<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>])</div><div class="line">obj3.reindex(range(<span class="number">6</span>), method=<span class="string">'ffill'</span>)</div></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.arange(<span class="number">9</span>).reshape((<span class="number">3</span>, <span class="number">3</span>)), index=[<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], columns=[<span class="string">'Ohio'</span>, <span class="string">'Texas'</span>, <span class="string">'California'</span>])</div><div class="line">frame</div><div class="line">frame2 = frame.reindex([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>])</div><div class="line">frame2</div><div class="line">states = [<span class="string">'Texas'</span>, <span class="string">'Utah'</span>, <span class="string">'California'</span>]</div><div class="line">frame.reindex(columns=states)</div><div class="line">frame.loc[[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], states]</div><div class="line"><span class="comment"># It doesn't work.</span></div><div class="line">frame.reindex(index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], method=<span class="string">'ffill'</span>, columns=states)</div></pre></td></tr></table></figure>
<p>More: index, method, fill_value, limit, level, copy</p>
<h5 id="Apply-a-function"><a href="#Apply-a-function" class="headerlink" title="Apply a function"></a>Apply a function</h5><p>NumPy’s element-wise array methods work fine with pandas objects such as DataFrame and Series.</p>
<h6 id="apply-attribute-of-Series"><a href="#apply-attribute-of-Series" class="headerlink" title="apply : attribute of Series"></a>apply : attribute of Series</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># data set</span></div><div class="line">frame = DataFrame(np.random.randn(<span class="number">4</span>, <span class="number">3</span>), index=[<span class="string">'Utah'</span>, <span class="string">'Ohio'</span>, <span class="string">'Texas'</span>, <span class="string">'Oregon'</span>], columns=list(<span class="string">'bde'</span>))</div><div class="line">frame</div><div class="line">np.abs(frame)</div></pre></td></tr></table></figure>
<p><img src="p-basic-30.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># method 1</span></div><div class="line">f = <span class="keyword">lambda</span> x: x.max() - x.min()</div><div class="line"><span class="comment"># apply a function on 1D arrays to each row</span></div><div class="line">frame.apply(f) <span class="comment"># Over rows, degenerate to a column vector</span></div><div class="line">frame.apply(f, axis=<span class="number">1</span>) <span class="comment"># Over columns, degenerate to a row vector</span></div></pre></td></tr></table></figure>
<p><img src="p-basic-31.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># method 2</span></div><div class="line"><span class="comment"># The function passed to apply need not return a scalar value, it can also return a Series with multiple values:</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(x)</span>:</span> <span class="keyword">return</span> Series([x.min(), x.max()], index=[<span class="string">'min'</span>, <span class="string">'max'</span>])</div><div class="line">frame.apply(f)</div></pre></td></tr></table></figure>
<p><img src="p-basic-32.png" alt=""></p>
<h6 id="apply-on-multiple-columns"><a href="#apply-on-multiple-columns" class="headerlink" title="apply on multiple columns"></a>apply on multiple columns</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">sublst</span><span class="params">(row)</span>:</span></div><div class="line">    <span class="keyword">return</span> lst[row[<span class="string">'J1'</span>]:row[<span class="string">'J2'</span>]]</div><div class="line"></div><div class="line">df = pd.DataFrame(&#123;<span class="string">'ID'</span>:[<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>], <span class="string">'J1'</span>: [<span class="number">0</span>,<span class="number">2</span>,<span class="number">3</span>], <span class="string">'J2'</span>:[<span class="number">1</span>,<span class="number">4</span>,<span class="number">5</span>]&#125;)</div><div class="line">df</div><div class="line">lst = [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>,<span class="string">'f'</span>]</div><div class="line"></div><div class="line">df[<span class="string">'J3'</span>] = df.apply(sublst,axis=<span class="number">1</span>)</div><div class="line">df</div></pre></td></tr></table></figure>
<p><img src="p-basic-75.png" alt=""></p>
<h6 id="apply-multiple-functions"><a href="#apply-multiple-functions" class="headerlink" title="apply : multiple functions"></a>apply : multiple functions</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (continued)</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">gunc</span><span class="params">(a,b)</span>:</span></div><div class="line">  <span class="keyword">return</span> a*b</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(x)</span>:</span></div><div class="line">  <span class="keyword">return</span> gunc(x[<span class="string">'J1'</span>],x[<span class="string">'J2'</span>])</div><div class="line">df[<span class="string">'J4'</span>] = df.apply(func,axis=<span class="number">1</span>) <span class="comment"># axis=1 row-wise</span></div><div class="line">df</div></pre></td></tr></table></figure>
<p><img src="p-basic-76.png" alt=""></p>
<h6 id="apply-with-two-arguments"><a href="#apply-with-two-arguments" class="headerlink" title="apply with two arguments"></a>apply with two arguments</h6><p>Reference <a href="https://stackoverflow.com/questions/34279378/python-pandas-apply-function-with-two-arguments-to-columns" target="_blank" rel="external">stackoverflow</a><br>Reference <a href="https://stackoverflow.com/questions/39814416/pandas-apply-with-args-which-are-dataframe-row-entries" target="_blank" rel="external">stackoverflow</a><br>Reference <a href="https://stackoverflow.com/questions/12182744/python-pandas-apply-a-function-with-arguments-to-a-series" target="_blank" rel="external">stackflow</a></p>
<h6 id="Case-optimization-with-apply"><a href="#Case-optimization-with-apply" class="headerlink" title="Case: optimization with apply()"></a>Case: optimization with apply()</h6><p>To find out the value of multiplier for DataFrame df2 such that the difference between the column d of DataFrame df1 and df2 approaches to zero,<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># data</span></div><div class="line">df1 = DataFrame(np.repeat([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],<span class="number">3</span>).reshape((<span class="number">3</span>,<span class="number">3</span>)),columns=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>])</div><div class="line">df2 = DataFrame(np.repeat([<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>],<span class="number">3</span>).reshape((<span class="number">3</span>,<span class="number">3</span>)),columns=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>])</div><div class="line">df1</div><div class="line">df2</div></pre></td></tr></table></figure></p>
<p><img src="p-basic-87.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># continued</span></div><div class="line"><span class="comment"># the augmentation function applied on every column</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">mulfunc</span><span class="params">(x,factor)</span>:</span></div><div class="line">    a = x[<span class="string">'a'</span>]*factor</div><div class="line">    b = x[<span class="string">'b'</span>]*factor</div><div class="line">    c = x[<span class="string">'c'</span>]*factor</div><div class="line">    <span class="keyword">return</span> a+b+c</div><div class="line"><span class="comment"># the objective function used for finding the optimal multiplier that leads to the least different between df1['d'] and df2['d']</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">objfunc</span><span class="params">(x)</span>:</span></div><div class="line">    df1[<span class="string">'d'</span>] = df1.apply(mulfunc,factor=<span class="number">2.</span>,axis=<span class="number">1</span>)</div><div class="line">    df2[<span class="string">'d'</span>] = df2.apply(mulfunc,factor=x,axis=<span class="number">1</span>)</div><div class="line">    <span class="keyword">return</span> df1[<span class="string">'d'</span>].subtract(df2[<span class="string">'d'</span>]).sum()</div><div class="line"></div><div class="line"><span class="keyword">import</span> scipy.optimize</div><div class="line"><span class="keyword">import</span> scipy</div><div class="line"><span class="keyword">print</span> scipy.optimize.brentq(objfunc, <span class="number">0.</span>,<span class="number">100.</span>) <span class="comment"># Answer: 0.2</span></div></pre></td></tr></table></figure>
<h6 id="applymap-attribute-of-DataFrame"><a href="#applymap-attribute-of-DataFrame" class="headerlink" title="applymap : attribute of DataFrame"></a>applymap : attribute of DataFrame</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (continued)</span></div><div class="line"><span class="comment"># "Element-wise" Python functions can be used, too. Suppose you wanted to compute a formatted string from each floating point value in frame. You can do this with `applymap`:</span></div><div class="line">format = <span class="keyword">lambda</span> x: <span class="string">'%.2f'</span> % x</div><div class="line">frame.applymap(format)</div><div class="line"><span class="comment"># The reason for the name applymap is that Series has a map method for applying an element-wise function:</span></div><div class="line">frame[<span class="string">'e'</span>].map(format)</div></pre></td></tr></table></figure>
<p><img src="p-basic-33.png" alt=""></p>
<h5 id="Getting-the-common-rows-of-two-columns"><a href="#Getting-the-common-rows-of-two-columns" class="headerlink" title="Getting the common rows of two columns"></a>Getting the common rows of two columns</h5><p>Reference <a href="https://stackoverflow.com/questions/30291032/comparing-2-columns-of-two-python-pandas-dataframes-and-getting-the-common-rows" target="_blank" rel="external">stackoverflow</a></p>
<h5 id="Sorting-1"><a href="#Sorting-1" class="headerlink" title="Sorting"></a>Sorting</h5><p>Sorting a data set by some criterion is another important built-in operation. To sort lexicographically by row or column index, use the sort_index method, which returns a new, sorted object.</p>
<h6 id="sort-index"><a href="#sort-index" class="headerlink" title="sort_index"></a>sort_index</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># On Series</span></div><div class="line">obj = Series(range(<span class="number">4</span>), index=[<span class="string">'d'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">obj.sort_index()</div><div class="line"><span class="comment"># on DataFrame</span></div><div class="line">frame = DataFrame(np.arange(<span class="number">8</span>).reshape((<span class="number">2</span>, <span class="number">4</span>)), index=[<span class="string">'three'</span>, <span class="string">'one'</span>], columns=[<span class="string">'d'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">frame.sort_index()</div><div class="line">frame.sort_index(axis=<span class="number">1</span>)</div><div class="line">frame.sort_index(axis=<span class="number">1</span>, ascending=<span class="keyword">False</span>)</div></pre></td></tr></table></figure>
<h6 id="sort-values"><a href="#sort-values" class="headerlink" title="sort_values"></a>sort_values</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># == On Series == #</span></div><div class="line"><span class="comment"># to sort a series its values, use its order method,</span></div><div class="line">obj = Series([<span class="number">4</span>, <span class="number">7</span>, <span class="number">-3</span>, <span class="number">2</span>])</div><div class="line">obj.sort_values()</div><div class="line">obj = Series([<span class="number">4</span>, np.nan, <span class="number">7</span>, np.nan, <span class="number">-3</span>, <span class="number">2</span>])</div><div class="line"><span class="comment"># any missing values are sorted to the end of the Series by default</span></div><div class="line">obj.sort_values()</div><div class="line"></div><div class="line"><span class="comment"># == On DataFrame == #</span></div><div class="line"><span class="comment"># to sort by the values in one or more columns on DataFrame, pass one or more colums to the `by` option:</span></div><div class="line">frame = DataFrame(&#123;<span class="string">'b'</span>: [<span class="number">4</span>, <span class="number">7</span>, <span class="number">-3</span>, <span class="number">2</span>], <span class="string">'a'</span>: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]&#125;)</div><div class="line">frame</div><div class="line">frame.sort_values(by=<span class="string">'b'</span>)</div><div class="line">frame.sort_values(by=[<span class="string">'a'</span>, <span class="string">'b'</span>])</div></pre></td></tr></table></figure>
<p>Ranking is assigning ranks from one through the number of valid data points in an array. By default, <code>rank</code> breaks ties by assigning each group the mean rank.</p>
<h6 id="ranking"><a href="#ranking" class="headerlink" title="ranking"></a>ranking</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># == On Series == #</span></div><div class="line">obj = Series([<span class="number">7</span>, <span class="number">-5</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">4</span>])</div><div class="line">obj.rank()</div><div class="line">obj.rank(method=<span class="string">'first'</span>)</div><div class="line"><span class="comment"># you can rank in descending order</span></div><div class="line">obj.rank(ascending=<span class="keyword">False</span>, method=<span class="string">'max'</span>)</div><div class="line"></div><div class="line"><span class="comment"># == On DataFrame == #</span></div><div class="line"><span class="comment"># DataFrame can compute ranks over the rows or the columns:</span></div><div class="line">frame = DataFrame(&#123;<span class="string">'b'</span>: [<span class="number">4.3</span>, <span class="number">7</span>, <span class="number">-3</span>, <span class="number">2</span>], <span class="string">'a'</span>: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>], <span class="string">'c'</span>: [<span class="number">-2</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">-2.5</span>]&#125;)</div><div class="line">frame</div><div class="line">frame.rank(axis=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<h6 id="reindexing-after-sorting"><a href="#reindexing-after-sorting" class="headerlink" title="reindexing after sorting"></a>reindexing after sorting</h6><p>Use <code>reset_index</code> to get the index back to a default index of 0, 1, …, n (and use <code>drop=True</code> to indicate you want to drop the existing index instead of adding it as a column to your dataframe).<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># data</span></div><div class="line">x = np.tile(np.arange(<span class="number">3</span>),<span class="number">3</span>)</div><div class="line">y = np.repeat(np.arange(<span class="number">3</span>),<span class="number">3</span>)</div><div class="line">df = pd.DataFrame(&#123;<span class="string">"x"</span>: x, <span class="string">"y"</span>: y&#125;)</div><div class="line"><span class="comment"># sort</span></div><div class="line">df2 = df.sort_values([<span class="string">"x"</span>, <span class="string">"y"</span>])</div><div class="line">df2</div><div class="line"><span class="comment"># reset index</span></div><div class="line"><span class="comment"># method 1</span></div><div class="line">df2.set_index(np.arange(len(df2.index)))</div><div class="line"><span class="comment"># method 2 (better)</span></div><div class="line">df2.reset_index(drop=<span class="keyword">True</span>)</div></pre></td></tr></table></figure></p>
<h5 id="Duplicate-indexes"><a href="#Duplicate-indexes" class="headerlink" title="Duplicate indexes"></a>Duplicate indexes</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Axis indexes with duplicate values</span></div><div class="line">obj = Series(range(<span class="number">5</span>), index=[<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">obj</div><div class="line"><span class="comment"># the index's is_unique property can tell you whether its values are unique:</span></div><div class="line">obj.index.is_unique</div><div class="line">obj[<span class="string">'a'</span>]</div><div class="line">obj[<span class="string">'c'</span>]</div><div class="line">df = DataFrame(np.random.randn(<span class="number">4</span>, <span class="number">3</span>), index=[<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>])</div><div class="line">df</div><div class="line">df.loc[<span class="string">'b'</span>]</div></pre></td></tr></table></figure>
<h5 id="Functions-1"><a href="#Functions-1" class="headerlink" title="Functions"></a>Functions</h5><h6 id="describe-amp-dtypes"><a href="#describe-amp-dtypes" class="headerlink" title="describe() &amp; dtypes"></a>describe() &amp; dtypes</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Summarizing and computing descriptive statistics</span></div><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> DataFrame</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line">df = DataFrame([[<span class="number">1.4</span>, np.nan, <span class="string">"c"</span>], [<span class="number">7.1</span>, <span class="number">-4.5</span>, <span class="number">2</span>], [np.nan, np.nan,<span class="number">3</span> ], [<span class="number">0.75</span>, <span class="number">-1.3</span>, <span class="string">"d"</span>]], index=[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], columns=[<span class="string">'one'</span>, <span class="string">'two'</span>, <span class="string">'three'</span>])</div><div class="line">df</div><div class="line">df.dtypes</div><div class="line"></div><div class="line"><span class="comment"># NA values are excluded unless the entire slice (row or column in this case) is NA. This can be disabled using the skipna option.</span></div><div class="line">df.sum()</div><div class="line">df.sum(axis=<span class="number">1</span>) <span class="comment"># axis represents the axis to reduce over.</span></div><div class="line">df.mean(axis=<span class="number">1</span>, skipna=<span class="keyword">False</span>)</div><div class="line">df.describe()</div><div class="line">df.describe(percentiles=np.arange(<span class="number">0</span>,<span class="number">1</span>,<span class="number">0.1</span>))</div></pre></td></tr></table></figure>
<h6 id="locate-maximum"><a href="#locate-maximum" class="headerlink" title="locate maximum"></a>locate maximum</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># return indirect statistics like the index value where the max or min values are attained:</span></div><div class="line">df.idxmax()</div><div class="line">df.cumsum()</div><div class="line">df.describe()</div><div class="line">obj = Series([<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>] * <span class="number">4</span>)</div><div class="line">obj.describe()</div></pre></td></tr></table></figure>
<h5 id="Case-study-stock-markets"><a href="#Case-study-stock-markets" class="headerlink" title="Case study: stock markets"></a>Case study: stock markets</h5><h6 id="Yahoo-finance"><a href="#Yahoo-finance" class="headerlink" title="Yahoo finance"></a>Yahoo finance</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> DataFrame</div><div class="line"><span class="comment"># Correlation and covariance</span></div><div class="line"><span class="keyword">import</span> pandas_datareader.data <span class="keyword">as</span> web</div><div class="line">all_data = &#123;&#125;</div><div class="line"><span class="keyword">for</span> ticker <span class="keyword">in</span> [<span class="string">'AAPL'</span>, <span class="string">'IBM'</span>, <span class="string">'MSFT'</span>, <span class="string">'GOOG'</span>]:</div><div class="line">  all_data[ticker] = web.get_data_yahoo(ticker)</div><div class="line">print(all_data)</div><div class="line">price = DataFrame(&#123;tic: data[<span class="string">'Adj Close'</span>] <span class="keyword">for</span> tic, data <span class="keyword">in</span> all_data.items()&#125;)</div><div class="line">volume = DataFrame(&#123;tic: data[<span class="string">'Volume'</span>] <span class="keyword">for</span> tic, data <span class="keyword">in</span> all_data.items()&#125;)</div><div class="line">returns = price.pct_change()</div><div class="line">returns.tail()</div><div class="line"><span class="comment"># correlation of the overlapping, non-NA, aligned-by-index calues in two Series</span></div><div class="line">returns.MSFT.corr(returns.IBM)</div><div class="line">returns.MSFT.cov(returns.IBM)</div><div class="line">returns.corr()</div><div class="line">returns.cov()</div><div class="line"><span class="comment"># compute pairwise correlation between a DataFrame's columns or rows with anther Series or DataFrame</span></div><div class="line">returns.corrwith(returns.IBM)</div><div class="line">returns.corrwith(volume)</div></pre></td></tr></table></figure>
<h6 id="Google-finance"><a href="#Google-finance" class="headerlink" title="Google finance"></a>Google finance</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> googlefinance.client <span class="keyword">import</span> get_price_data, get_closing_data, get_open_close_data, get_prices_data</div><div class="line"><span class="comment"># Method 1</span></div><div class="line"><span class="comment"># Dow Jones</span></div><div class="line">param = &#123;</div><div class="line">    <span class="string">'q'</span>: <span class="string">".DJI"</span>, <span class="comment"># Stock symbol (ex: "AAPL")</span></div><div class="line">    <span class="string">'i'</span>: <span class="string">"86400"</span>, <span class="comment"># Interval size in seconds ("86400" = 1 day intervals)</span></div><div class="line">    <span class="string">'x'</span>: <span class="string">"INDEXDJX"</span>, <span class="comment"># Stock exchange symbol on which stock is traded (ex: "NASD")</span></div><div class="line">    <span class="string">'p'</span>: <span class="string">"1Y"</span> <span class="comment"># Period (Ex: "1Y" = 1 year)</span></div><div class="line">    &#125;</div><div class="line"><span class="comment"># get price data (return pandas dataframe)</span></div><div class="line">df = get_price_data(param)</div><div class="line">print(df)</div><div class="line"></div><div class="line"><span class="comment"># Method 2</span></div><div class="line">params = [</div><div class="line">    <span class="comment"># Dow Jones</span></div><div class="line">    &#123;</div><div class="line">        <span class="string">'q'</span>: <span class="string">".DJI"</span>,</div><div class="line">        <span class="string">'x'</span>: <span class="string">"INDEXDJX"</span>,</div><div class="line">    &#125;,</div><div class="line">    <span class="comment"># NYSE COMPOSITE (DJ)</span></div><div class="line">    &#123;</div><div class="line">        <span class="string">'q'</span>: <span class="string">"NYA"</span>,</div><div class="line">        <span class="string">'x'</span>: <span class="string">"INDEXNYSEGIS"</span>,</div><div class="line">    &#125;,</div><div class="line">    <span class="comment"># S&amp;P 500</span></div><div class="line">    &#123;</div><div class="line">        <span class="string">'q'</span>: <span class="string">".INX"</span>,</div><div class="line">        <span class="string">'x'</span>: <span class="string">"INDEXSP"</span>,</div><div class="line">    &#125;</div><div class="line">]</div><div class="line">period = <span class="string">"1Y"</span></div><div class="line"><span class="comment"># get closing price data (return pandas dataframe)</span></div><div class="line">df = get_closing_data(params, period)</div><div class="line">print(df)</div><div class="line"></div><div class="line"><span class="comment"># Method 3</span></div><div class="line">params = [</div><div class="line">    <span class="comment"># Dow Jones</span></div><div class="line">    &#123;</div><div class="line">        <span class="string">'q'</span>: <span class="string">".DJI"</span>,</div><div class="line">        <span class="string">'x'</span>: <span class="string">"INDEXDJX"</span>,</div><div class="line">    &#125;,</div><div class="line">    <span class="comment"># NYSE COMPOSITE (DJ)</span></div><div class="line">    &#123;</div><div class="line">        <span class="string">'q'</span>: <span class="string">"NYA"</span>,</div><div class="line">        <span class="string">'x'</span>: <span class="string">"INDEXNYSEGIS"</span>,</div><div class="line">    &#125;,</div><div class="line">    <span class="comment"># S&amp;P 500</span></div><div class="line">    &#123;</div><div class="line">        <span class="string">'q'</span>: <span class="string">".INX"</span>,</div><div class="line">        <span class="string">'x'</span>: <span class="string">"INDEXSP"</span>,</div><div class="line">    &#125;</div><div class="line">]</div><div class="line">period = <span class="string">"1Y"</span></div><div class="line"><span class="comment"># get open and close price data (return pandas dataframe)</span></div><div class="line">df = get_open_close_data(params, period)</div><div class="line">print(df)</div><div class="line"></div><div class="line"><span class="comment"># Method 4</span></div><div class="line">params = [</div><div class="line">    <span class="comment"># Dow Jones</span></div><div class="line">    &#123;</div><div class="line">        <span class="string">'q'</span>: <span class="string">".DJI"</span>,</div><div class="line">        <span class="string">'x'</span>: <span class="string">"INDEXDJX"</span>,</div><div class="line">    &#125;,</div><div class="line">    <span class="comment"># NYSE COMPOSITE (DJ)</span></div><div class="line">    &#123;</div><div class="line">        <span class="string">'q'</span>: <span class="string">"NYA"</span>,</div><div class="line">        <span class="string">'x'</span>: <span class="string">"INDEXNYSEGIS"</span>,</div><div class="line">    &#125;,</div><div class="line">    <span class="comment"># S&amp;P 500</span></div><div class="line">    &#123;</div><div class="line">        <span class="string">'q'</span>: <span class="string">".INX"</span>,</div><div class="line">        <span class="string">'x'</span>: <span class="string">"INDEXSP"</span>,</div><div class="line">    &#125;</div><div class="line">]</div><div class="line">period = <span class="string">"1Y"</span></div><div class="line"><span class="comment"># get open, high, low, close price data (return pandas dataframe)</span></div><div class="line">df = get_prices_data(params, period)</div><div class="line">print(df)</div></pre></td></tr></table></figure>
<h5 id="Subsetting"><a href="#Subsetting" class="headerlink" title="Subsetting"></a>Subsetting</h5><h6 id="Case-study-histogram"><a href="#Case-study-histogram" class="headerlink" title="Case study: histogram"></a>Case study: histogram</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># method 1</span></div><div class="line"><span class="comment"># Unique values, value counts, and membership</span></div><div class="line">obj = Series([<span class="string">'c'</span>, <span class="string">'a'</span>, <span class="string">'d'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'c'</span>])</div><div class="line">uniques = obj.unique() <span class="comment"># gives an array of the unique values in a Series</span></div><div class="line">uniques</div><div class="line">uniques.sort()</div><div class="line">uniques</div><div class="line">obj.value_counts()</div></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (continued)</span></div><div class="line"><span class="comment"># The Series is sorted by value in descending order as a convenience. value_counts is also available as a top-level pandas method that can be used with any array or sequence.</span></div><div class="line"><span class="comment"># method 2</span></div><div class="line">pd.value_counts(obj.values, sort=<span class="keyword">False</span>)</div><div class="line">mask = obj.isin([<span class="string">'b'</span>, <span class="string">'c'</span>])</div><div class="line">mask</div><div class="line">obj</div><div class="line">obj[mask] <span class="comment"># select out those data with rows of interest</span></div></pre></td></tr></table></figure>
<h6 id="Case-study-histogram-1"><a href="#Case-study-histogram-1" class="headerlink" title="Case study: histogram"></a>Case study: histogram</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">data = DataFrame(&#123;<span class="string">'Qu1'</span>: [<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>], <span class="string">'Qu2'</span>: [<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="string">'Qu3'</span>: [<span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">4</span>]&#125;)</div><div class="line">data</div><div class="line">data.apply(pd.value_counts) <span class="comment"># trick. apply value_counts for each column. For Qu1, we have a single 1, no 2's, two 3's and so on.</span></div><div class="line">result = data.apply(pd.value_counts).fillna(<span class="number">0</span>) <span class="comment"># supplant np.nan with zero</span></div><div class="line">result</div></pre></td></tr></table></figure>
<h5 id="Extracting-digits-from-string"><a href="#Extracting-digits-from-string" class="headerlink" title="Extracting digits from string"></a>Extracting digits from string</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># unfinished</span></div><div class="line">df[<span class="string">'Month'</span>]=df[<span class="string">'Period'</span>].str.extract(<span class="string">'(\d+)'</span>).astype(int)</div></pre></td></tr></table></figure>
<h5 id="Missing-data"><a href="#Missing-data" class="headerlink" title="Missing data"></a>Missing data</h5><p>Pandas uses the floating point value NaN (Not a Number) to represent missing data in both floating as well as in non-floating point arrays. It is just used as a sentinel that can be easily detected.</p>
<h6 id="Detecting-NaN"><a href="#Detecting-NaN" class="headerlink" title="Detecting NaN"></a>Detecting NaN</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> nan <span class="keyword">as</span> NA</div><div class="line"><span class="comment"># Handling missing data</span></div><div class="line">string_data = Series([<span class="string">'aardvark'</span>, <span class="string">'artichoke'</span>, np.nan, <span class="string">'avocado'</span>])</div><div class="line">string_data</div><div class="line">string_data.isnull()</div><div class="line"><span class="comment"># The built-in Python None value is also treated as NA in object arrays:</span></div><div class="line">string_data[<span class="number">0</span>] = <span class="keyword">None</span></div><div class="line">string_data.isnull()</div><div class="line">string_data <span class="keyword">is</span> <span class="keyword">None</span> <span class="comment"># False</span></div></pre></td></tr></table></figure>
<p><img src="p-basic-45.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># data</span></div><div class="line">frame = DataFrame(np.random.randn(<span class="number">4</span>, <span class="number">3</span>), index=[<span class="string">'Utah'</span>, <span class="string">'Ohio'</span>, <span class="string">'Texas'</span>, <span class="string">'Oregon'</span>], columns=list(<span class="string">'bde'</span>))</div><div class="line">frame.loc[:<span class="number">2</span>,<span class="string">'e'</span>]=np.nan</div><div class="line">frame</div><div class="line"><span class="comment"># this doesn't work</span></div><div class="line">frame.loc[frame[<span class="string">'e'</span>]==np.nan,<span class="string">'d'</span>] = <span class="number">2</span></div><div class="line">frame</div><div class="line"><span class="comment"># this works</span></div><div class="line">frame.loc[frame[<span class="string">'e'</span>].isnull(),<span class="string">'d'</span>] = <span class="number">2</span></div><div class="line">frame</div></pre></td></tr></table></figure>
<p><img src="p-basic-69.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># continued</span></div><div class="line"><span class="comment"># another application</span></div><div class="line">frame.loc[frame[<span class="string">'e'</span>].notnull(),<span class="string">'e'</span>] = <span class="number">-1.</span></div><div class="line">frame</div></pre></td></tr></table></figure>
<p><img src="p-basic-98.png" alt=""></p>
<h6 id="Fill-missing-values"><a href="#Fill-missing-values" class="headerlink" title="Fill missing values"></a>Fill missing values</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Filtering out missing data</span></div><div class="line">data = Series([<span class="number">1</span>, NA, <span class="number">3.5</span>, NA, <span class="number">7</span>])</div><div class="line"><span class="comment"># method 1</span></div><div class="line">data.dropna()</div><div class="line"><span class="comment"># method 2</span></div><div class="line">data[data.notnull()]</div></pre></td></tr></table></figure>
<h6 id="Drop-NaN-by-counting"><a href="#Drop-NaN-by-counting" class="headerlink" title="Drop NaN by counting"></a>Drop NaN by counting</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#  You may want to drop rows or columns which are all NA or just those containing any NAs. dropna by default drops any row containing a missing value:</span></div><div class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> nan <span class="keyword">as</span> NA</div><div class="line">data = DataFrame([[<span class="number">1.</span>, <span class="number">6.5</span>, <span class="number">3.</span>], [<span class="number">1.</span>, NA, NA], [NA, NA, NA], [NA, <span class="number">6.5</span>, <span class="number">3.</span>]])</div><div class="line">data</div><div class="line"><span class="comment"># clean type 1</span></div><div class="line">cleaned = data.dropna()</div><div class="line">cleaned</div></pre></td></tr></table></figure>
<p><img src="p-basic-43.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># (continued)</span></div><div class="line"><span class="comment"># clean type 2</span></div><div class="line"><span class="comment"># Passing how='all' will only drop rows that are all NA:</span></div><div class="line">data.dropna(how=<span class="string">'all'</span>)</div><div class="line">data[<span class="number">4</span>] = NA <span class="comment"># to add a new column with NA</span></div><div class="line">data</div><div class="line"><span class="comment"># Dropping columns in the same way is only a matter of passing axis=1:</span></div><div class="line">data.dropna(axis=<span class="number">1</span>, how=<span class="string">'all'</span>)</div></pre></td></tr></table></figure>
<p><img src="p-basic-44.png" alt=""></p>
<h6 id="Drop-NaN-by-layers"><a href="#Drop-NaN-by-layers" class="headerlink" title="Drop NaN by layers"></a>Drop NaN by layers</h6><p>Suppose you want to keep only rows containing a certain number of observations. You can indicate this with the thresh argument:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> nan <span class="keyword">as</span> NA</div><div class="line">df = DataFrame(np.random.randn(<span class="number">7</span>, <span class="number">3</span>))</div><div class="line">df</div><div class="line">df.iloc[:<span class="number">4</span>, <span class="number">1</span>] = NA</div><div class="line">df.iloc[:<span class="number">2</span>, <span class="number">2</span>] = NA</div><div class="line">df</div><div class="line">df.dropna(thresh=<span class="number">3</span>) <span class="comment"># contains at least 3 valid values in a row</span></div><div class="line"><span class="comment"># Filling in missing data</span></div><div class="line">df.fillna(<span class="number">0</span>)</div></pre></td></tr></table></figure></p>
<p><img src="p-basic-41.png" alt=""><br><img src="p-basic-42.png" alt=""></p>
<h6 id="Replace-NaN"><a href="#Replace-NaN" class="headerlink" title="Replace NaN"></a>Replace NaN</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Calling fillna with a dict you can use a different fill value for each column:</span></div><div class="line">df.fillna(&#123;<span class="number">1</span>: <span class="number">0.5</span>, <span class="number">3</span>: <span class="number">-1</span>&#125;)</div><div class="line"><span class="comment"># fillna returns a new object, but you can modify the existing object in place:</span></div><div class="line"><span class="comment"># fillna always returns a reference to the filled object</span></div><div class="line">_ = df.fillna(<span class="number">0</span>, inplace=<span class="keyword">True</span>)</div><div class="line">df</div></pre></td></tr></table></figure>
<h6 id="Replacing-NaN-with-counterparts"><a href="#Replacing-NaN-with-counterparts" class="headerlink" title="Replacing NaN with counterparts"></a>Replacing NaN with counterparts</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># data</span></div><div class="line">a = np.arange(<span class="number">12</span>).reshape(<span class="number">3</span>,<span class="number">4</span>)</div><div class="line">data = DataFrame(a,columns=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>])</div><div class="line">data.loc[data[<span class="string">'a'</span>]&gt;=<span class="number">4</span>,<span class="string">'b'</span>] = np.nan</div><div class="line">data</div><div class="line"><span class="comment"># update column b with column a</span></div><div class="line">data[<span class="string">'new_b'</span>] = data.b.fillna(data.a)</div><div class="line">data</div></pre></td></tr></table></figure>
<p><img src="p-basic-79.png" alt=""></p>
<h6 id="Fill-in-limited-scope"><a href="#Fill-in-limited-scope" class="headerlink" title="Fill in limited scope"></a>Fill in limited scope</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">df = DataFrame(np.random.randn(<span class="number">6</span>, <span class="number">3</span>))</div><div class="line">df.iloc[<span class="number">2</span>:, <span class="number">1</span>] = NA</div><div class="line">df.iloc[<span class="number">4</span>:, <span class="number">2</span>] = NA</div><div class="line">df</div><div class="line">df.fillna(method=<span class="string">'ffill'</span>)</div><div class="line">df.fillna(method=<span class="string">'ffill'</span>, limit=<span class="number">2</span>)</div></pre></td></tr></table></figure>
<h6 id="Fill-with-mean"><a href="#Fill-with-mean" class="headerlink" title="Fill with mean()"></a>Fill with mean()</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># With fillna you can do lots of other things with a little creativity. For example, you might pass the mean or median value of a Series:</span></div><div class="line">data = Series([<span class="number">1.</span>, NA, <span class="number">3.5</span>, NA, <span class="number">7</span>])</div><div class="line">data.fillna(data.mean())</div></pre></td></tr></table></figure>
<h6 id="Replace-with-other-values"><a href="#Replace-with-other-values" class="headerlink" title="Replace with other values"></a>Replace with other values</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># data</span></div><div class="line">df = DataFrame(np.random.randn(<span class="number">6</span>, <span class="number">3</span>), columns=[<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>])</div><div class="line">df.loc[df[<span class="string">'a'</span>]&gt;<span class="number">0</span>,<span class="string">'b'</span>] = <span class="string">"string"</span> <span class="comment"># if an entry whose a is bigger than zero, we replace its b attribute with "string"</span></div><div class="line">df</div><div class="line"><span class="comment"># replacing</span></div><div class="line">mapping = &#123;<span class="string">'string'</span>: np.nan&#125; <span class="comment"># set up the replacing rule</span></div><div class="line">df.replace(&#123;<span class="string">'b'</span>:mapping&#125;) <span class="comment"># replace all the strings in b</span></div></pre></td></tr></table></figure>
<h6 id="Convert-to-numeric"><a href="#Convert-to-numeric" class="headerlink" title="Convert to numeric"></a>Convert to numeric</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">df = pd.DataFrame(&#123;<span class="string">"A"</span>:[<span class="string">"1.1"</span>,<span class="string">"1.2"</span>,<span class="string">"infinity"</span>,<span class="string">"1.4"</span>], <span class="string">"B"</span>:[<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>]&#125;)</div><div class="line">df</div><div class="line">df.dtypes</div><div class="line"><span class="comment"># key 1-1</span></div></pre></td></tr></table></figure>
<p><img src="p-basic-46.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">df[<span class="string">'A'</span>] = df[<span class="string">'A'</span>].apply(pd.to_numeric, errors=<span class="string">"coerce"</span>)</div><div class="line">df</div><div class="line">df.sort_values([<span class="string">'A'</span>],ascending=[<span class="keyword">True</span>])</div><div class="line"><span class="comment"># key 1-2</span></div><div class="line">df = df[pd.notnull(df[<span class="string">'A'</span>])]</div><div class="line">df</div></pre></td></tr></table></figure>
<p><img src="p-basic-47.png" alt=""></p>
<h5 id="Hierarchical-indexing"><a href="#Hierarchical-indexing" class="headerlink" title="Hierarchical indexing"></a>Hierarchical indexing</h5><h6 id="stack-amp-unstack"><a href="#stack-amp-unstack" class="headerlink" title="stack() &amp; unstack()"></a>stack() &amp; unstack()</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Hierarchical indexing</span></div><div class="line">data = Series(np.random.randn(<span class="number">10</span>), index=[[<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'d'</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>]])</div><div class="line">data</div><div class="line">data.index</div><div class="line"><span class="comment"># With a hierarchically-indexed object, so-called partial indexing is possible, enabling you to concisely select subsets of the data:</span></div><div class="line">data[<span class="string">'b'</span>]</div><div class="line"><span class="comment"># method 1:</span></div><div class="line">data[<span class="string">'b'</span>:<span class="string">'c'</span>]</div><div class="line"><span class="comment"># method 2:</span></div><div class="line">data.ix[[<span class="string">'b'</span>, <span class="string">'d'</span>]]</div><div class="line"><span class="comment"># Selection is even possible in some cases from an “inner” level:</span></div><div class="line">data[:, <span class="number">2</span>]</div><div class="line">data.unstack()</div><div class="line">data.unstack().stack()</div></pre></td></tr></table></figure>
<h6 id="MultiIndex"><a href="#MultiIndex" class="headerlink" title="MultiIndex"></a>MultiIndex</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">frame = DataFrame(np.arange(<span class="number">12</span>).reshape((<span class="number">4</span>, <span class="number">3</span>)), index=[[<span class="string">'a'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>]], columns=[[<span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Colorado'</span>], [<span class="string">'Green'</span>, <span class="string">'Red'</span>, <span class="string">'Green'</span>]])</div><div class="line">frame</div><div class="line">frame.index.names = [<span class="string">'key1'</span>, <span class="string">'key2'</span>]</div><div class="line">frame.columns.names = [<span class="string">'state'</span>, <span class="string">'color'</span>]</div><div class="line">frame</div><div class="line">frame[<span class="string">'Ohio'</span>]</div><div class="line">MultiIndex.from_arrays([[<span class="string">'Ohio'</span>, <span class="string">'Ohio'</span>, <span class="string">'Colorado'</span>], [<span class="string">'Green'</span>, <span class="string">'Red'</span>, <span class="string">'Green'</span>]], names=[<span class="string">'state'</span>, <span class="string">'color'</span>])</div></pre></td></tr></table></figure>
<h6 id="levels-reordering"><a href="#levels-reordering" class="headerlink" title="levels reordering"></a>levels reordering</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Reordering and sorting levels</span></div><div class="line"><span class="comment">#  The swaplevel takes two level numbers or names and returns a new object with the levels interchanged (but the data is otherwise unaltered):</span></div><div class="line">frame.swaplevel(<span class="string">'key1'</span>, <span class="string">'key2'</span>)</div><div class="line">frame.sortlevel(<span class="number">1</span>)</div><div class="line">frame.swaplevel(<span class="number">0</span>, <span class="number">1</span>).sortlevel(<span class="number">0</span>) <span class="comment"># the same result as the command above</span></div><div class="line"></div><div class="line"><span class="comment"># Summary statistics by level</span></div><div class="line">frame.sum(level=<span class="string">'key2'</span>)</div><div class="line">frame.sum(level=<span class="string">'color'</span>, axis=<span class="number">1</span>)</div></pre></td></tr></table></figure>
<h5 id="Case-study-panel-data"><a href="#Case-study-panel-data" class="headerlink" title="Case study: panel data"></a>Case study: panel data</h5><p>To create a Panel, you can use a dict of DataFrame objects or a three-dimensional ndarray:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Panel data</span></div><div class="line"><span class="keyword">import</span> pandas_datareader <span class="keyword">as</span> web</div><div class="line">pdata = pd.Panel(dict((stk, web.get_data_yahoo(stk)) <span class="keyword">for</span> stk <span class="keyword">in</span> [<span class="string">'AAPL'</span>, <span class="string">'GOOG'</span>, <span class="string">'MSFT'</span>, <span class="string">'DELL'</span>]))</div><div class="line">pdata</div><div class="line">pdata = pdata.swapaxes(<span class="string">'items'</span>, <span class="string">'minor'</span>)</div><div class="line">pdata[<span class="string">'Adj Close'</span>]</div><div class="line"><span class="comment"># ix-based label indexing generalizes to three dimensions, so we can select all data at a particular date or a range of dates like so</span></div><div class="line">pdata.ix[:, <span class="string">'6/1/2012'</span>, :]</div><div class="line">pdata.ix[<span class="string">'Adj Close'</span>, <span class="string">'5/22/2012'</span>:, :]</div><div class="line"><span class="comment"># An alternate way to represent panel data, especially for fitting statistical models, is in “stacked” DataFrame form:</span></div><div class="line">stacked = pdata.ix[:, <span class="string">'5/30/2012'</span>:, :].to_frame()</div><div class="line">stacked</div><div class="line"><span class="comment"># DataFrame has a related to_panel method, the inverse of to_frame:</span></div><div class="line">stacked.to_panel()</div></pre></td></tr></table></figure></p>
<h5 id="Counting-sort-values"><a href="#Counting-sort-values" class="headerlink" title="Counting sort_values"></a>Counting sort_values</h5><ul>
<li>sampling with replacement: random.choices([1,2,3],k=6)</li>
<li>sampling without replacement: random.sample(range(1,4),3)<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">df = DataFrame(np.array(choices([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],k=<span class="number">20</span>)).reshape([<span class="number">10</span>,<span class="number">2</span>]),columns=[<span class="string">'a'</span>,<span class="string">'b'</span>])</div><div class="line">df</div><div class="line">df[<span class="string">'b'</span>].value_counts()</div><div class="line">df[<span class="string">'b'</span>].value_counts().index.tolist() <span class="comment"># [5, 2, 3, 4]</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="p-basic-101.png" alt=""></p>
<h3 id="Plot"><a href="#Plot" class="headerlink" title="Plot"></a>Plot</h3><p><strong>Multiple subplots</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"></div><div class="line"><span class="comment"># First way #</span></div><div class="line"></div><div class="line">x = np.random.rand(<span class="number">10</span>)</div><div class="line">y = np.random.rand(<span class="number">10</span>)</div><div class="line"></div><div class="line">figure1 = plt.plot(x,y)</div><div class="line">plt.show()</div></pre></td></tr></table></figure></p>
<p><img src="p-basic-65.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Second way #</span></div><div class="line"></div><div class="line">x1 = np.random.rand(<span class="number">10</span>)</div><div class="line">x2 = np.random.rand(<span class="number">10</span>)</div><div class="line">x3 = np.random.rand(<span class="number">10</span>)</div><div class="line">x4 = np.random.rand(<span class="number">10</span>)</div><div class="line">y1 = np.random.rand(<span class="number">10</span>)</div><div class="line">y2 = np.random.rand(<span class="number">10</span>)</div><div class="line">y3 = np.random.rand(<span class="number">10</span>)</div><div class="line">y4 = np.random.rand(<span class="number">10</span>)</div><div class="line"></div><div class="line">figure2, ((ax1, ax2), (ax3, ax4)) = plt.subplots(<span class="number">2</span>, <span class="number">2</span>)</div><div class="line">ax1.plot(x1,y1)</div><div class="line">ax2.plot(x2,y2)</div><div class="line">ax3.plot(x3,y3)</div><div class="line">ax4.plot(x4,y4)</div><div class="line"></div><div class="line">plt.show()</div></pre></td></tr></table></figure>
<p><img src="p-basic-73.png" alt=""></p>
<p><strong>Change tick frequency and starting point of axis range</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"><span class="keyword">import</span> matplotlib</div><div class="line"><span class="keyword">from</span> matplotlib <span class="keyword">import</span> pyplot <span class="keyword">as</span> plt</div><div class="line"></div><div class="line"><span class="keyword">import</span> matplotlib.ticker <span class="keyword">as</span> ticker</div><div class="line">x = [<span class="number">0</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">15</span>]</div><div class="line">y = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</div><div class="line">n= [<span class="string">'A'</span>,<span class="string">'B'</span>,<span class="string">'C'</span>,<span class="string">'D'</span>,<span class="string">'E'</span>]</div><div class="line">z = np.linspace(<span class="number">0</span>, <span class="number">20</span>, <span class="number">1000</span>)</div><div class="line">y1 = np.sin(z)<span class="number">-1.5</span></div><div class="line">y2 = np.cos(z)<span class="number">-1.5</span></div><div class="line">fig, ax = plt.subplots()</div><div class="line">ax.scatter(x,y)</div><div class="line"></div><div class="line">ax.plot(z, y1, <span class="string">'-b'</span>, label=<span class="string">'sine'</span>)</div><div class="line">ax.plot(z, y2, <span class="string">'-r'</span>, label=<span class="string">'cosine'</span>)</div><div class="line"></div><div class="line"><span class="comment"># set up axis range before tick frequency</span></div><div class="line">cur_xlim = ax.get_xlim()</div><div class="line">ax.set_xlim([<span class="number">-2</span>,cur_xlim[<span class="number">1</span>]])</div><div class="line"><span class="comment"># set up tick frequency</span></div><div class="line">start, end = ax.get_xlim()</div><div class="line">ax.xaxis.set_ticks(np.arange(start, end, <span class="number">4</span>))</div><div class="line">ax.xaxis.set_major_formatter(ticker.FormatStrFormatter(<span class="string">'%0.1f'</span>))</div><div class="line"></div><div class="line"><span class="comment"># annotation</span></div><div class="line"><span class="keyword">for</span> i, txt <span class="keyword">in</span> enumerate(n):</div><div class="line">    ax.annotate(txt,(x[i]+<span class="number">0.1</span>,y[i]))</div><div class="line"><span class="comment"># legend</span></div><div class="line">handles, labels = ax.get_legend_handles_labels()</div><div class="line">ax.legend(handles[::<span class="number">-1</span>], labels[::<span class="number">-1</span>]) <span class="comment"># reverse the order</span></div><div class="line">ax.legend(loc=<span class="string">'upper left'</span>)</div><div class="line"></div><div class="line">plt.show()</div></pre></td></tr></table></figure></p>
<p><img src="p-basic-67.png" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">x = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</div><div class="line">y = [ [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>], [<span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>] ]</div><div class="line">labels=[<span class="string">'foo'</span>, <span class="string">'bar'</span>, <span class="string">'baz'</span>]</div><div class="line">colors=[<span class="string">'r'</span>,<span class="string">'g'</span>,<span class="string">'b'</span>]</div><div class="line"></div><div class="line"><span class="comment"># loop over data, labels and colors</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(y)):</div><div class="line">    plt.plot(x,y[i],<span class="string">'o-'</span>,color=colors[i],label=labels[i])</div><div class="line"></div><div class="line">plt.legend()</div><div class="line">plt.show()</div></pre></td></tr></table></figure>
<p><img src="p-basic-68.png" alt=""></p>
<p><img src="https://stackoverflow.com/questions/38981257/color-3d-surface-based-on-categories-that-passes-through-scatter-points" alt="Color 3D Surface Based on Categories that passes through scatter points"></p>
<h3 id="Optimization"><a href="#Optimization" class="headerlink" title="Optimization"></a>Optimization</h3><p>‘’’python<br>df1 = DataFrame(np.repeat([1,2,3],3).reshape((3,3)),columns=[‘a’,’b’,’c’])<br>df2 = DataFrame(np.repeat([10,20,30],3).reshape((3,3)),columns=[‘a’,’b’,’c’])<br>def mulfunc(x,factor):<br>    a = x[‘a’]<em>factor<br>    b = x[‘b’]</em>factor<br>    c = x[‘c’]*factor<br>    return a+b+c<br>def objfunc(x):<br>    df1[‘d’] = df1.apply(mulfunc,factor=2.,axis=1)<br>    df2[‘d’] = df2.apply(mulfunc,factor=x,axis=1)<br>    return df1[‘d’].subtract(df2[‘d’]).sum()</p>
<p>print scipy.optimize.brentq(objfunc, 0.,100.)<br>```</p>
<h2 id="Python-OOP"><a href="#Python-OOP" class="headerlink" title="Python OOP"></a>Python OOP</h2><p>OOP refers to Object-Oriented Programming.</p>
<h2 id="Applications-of-Python"><a href="#Applications-of-Python" class="headerlink" title="Applications of Python"></a>Applications of Python</h2><h3 id="Machine-learning"><a href="#Machine-learning" class="headerlink" title="Machine learning"></a>Machine learning</h3><ul>
<li>Scikit-learn module</li>
<li>TensorFlow module<h3 id="Data-mining"><a href="#Data-mining" class="headerlink" title="Data mining"></a>Data mining</h3></li>
<li>Scrapy module</li>
<li>Pattern module<h3 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h3>Reference: <a href="http://www.mysqltutorial.org/getting-started-mysql-python-connector/" target="_blank" rel="external">MySQLTutorial</a><h3 id="Tableau"><a href="#Tableau" class="headerlink" title="Tableau"></a>Tableau</h3>Reference: <a href="https://community.tableau.com/thread/236479" target="_blank" rel="external">Tableau Integration with Python</a></li>
</ul>
<div id="footnotes"><hr><div id="footnotelist"><ol style="list-style:none; padding-left: 0;"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">1.</span><span style="display: inline-block; vertical-align: top;">Data munging or data wrangling is loosely the process of manually converting or mapping data from one “raw” form into another format that allows for more convenient consumption of the data with the help of semi-automated tools.</span><a href="#fnref:1" rev="footnote"> ↩</a></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px;">2.</span><span style="display: inline-block; vertical-align: top;">Set symmetric differences: elements that are in either of the arrays, but not both.</span><a href="#fnref:2" rev="footnote"> ↩</a></li></ol></div></div>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://joyride2017.github.io/note/note/2017/09/08/english-sentence/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="n0body">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/note/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Local Playground">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/note/2017/09/08/english-sentence/" itemprop="url">English sentence</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-08T07:50:35-05:00">
                2017-09-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><h1 id="只字片语"><a href="#只字片语" class="headerlink" title="只字片语"></a>只字片语</h1><p><strong>mind-boggling</strong>: difficult to imagine and very big, strange, or complicated. &lt;&gt; a problem of min-boggling complexity</p>
<p><strong>thrust sth upon/on sb</strong>: if something is thrust upon you, you are forced to accept it even if you do not wnat it.</p>
<ul>
<li>She never enjoyed the fame that <code>was thrust upon</code> her.</li>
<li>He <code>had marriage thrust upon</code> him. 强加于… {逼婚逼迫枷锁光环强人所难}</li>
</ul>
<p>Coffee is highly acidic. <code>High doses</code> of acidic caffeine mess with your hormones, namely your stress hormones, which control your skin’s oil production.</p>
<blockquote>
<p>[‘kæfin]</p>
</blockquote>
<p>The <code>nonchalance</code> isn’t <code>posturing</code>. 这种满不在乎不只是做做样子。</p>
<p>… , <code>flaunting ostentatious wealth</code> at least partially supported by taxpayer money goes beyond <code>tackiness</code> and approaches <code>sadism</code>. {摆阔炫富} 已非低俗可以形容，而是近乎变态</p>
<p>The rich flaunted their wealth while the poor starved on the streets. 朱门酒肉臭，路有冻死骨</p>
<p>Every callout is an opportunity to either improve yourself or model grace under fire. We are all just students in this university called life. 出临事不惊的大度</p>
<blockquote>
<p>an instance of being summoned, especially in order to deal with an emergency or to do repairs.  eg. “a call-out charge”</p>
</blockquote>
<p>Before you tell a stranger that her complaint about the nation falling into the hands of cartoon rich people who can’t even forcefully denounce the Confederacy is really just <code>the jealous squalling of a loser</code> with a bad life, stop and think: Is this public? 输家的嫉妒心理</p>
<p>He gave us a <code>knowing</code> look. 他朝我们会意地看了一眼。</p>
<p>She exchanged a <code>knowing smile</code> with her mother. 她与母亲相互会心地一笑</p>
<p>Fancy you knowing him!<br>真没想到你认识他!</p>
<p><strong>hold</strong></p>
<p>I <code>held back</code> not knowing his real intention.<br>我有点犹豫不定，不知道他的真正意图是什么。</p>
<p>Knowing that danger threatened, they were <code>on the alert</code>.<br>因为知道可能会发生危险，他们处于戒备状态。</p>
<p> I’m not sure if <code>the argument holds up</code>, but it’s stimulating.<br> 我不能确定这一论点能否<code>经得住推敲</code>，但是它却很令人耳目一新。</p>
<p>Children’s wear is one area that is <code>holding up well in the recession.</code><br> 在经济衰退期间，童装是持续销售良好的一个领域。{耐压逆势成长}</p>
<p><strong>resolve (itself) into sth</strong> to gradually change into something else 演变成某事物<br>The argument resolved itself into an uneasy truce. 争论进入暂时的休战状</p>
<p>But it’s also taking in new people who’ve spent the past week in motels or hotels — but now they’re out of money and they can’t go to their uninhabitable homes.</p>
<p><strong>as of/from</strong> - starting from a particular time or date:<br>As of next month, all the airline’s fares will be going up.</p>
<blockquote>
<p><a href="http://www.learnersdictionary.com/qa/as-of-today" target="_blank" rel="external">As of today</a></p>
</blockquote>
<p><strong>incorporate features</strong> into = include features into</p>
<p>We’ve incorporated many environmentally friendly features into the design of the building. 我们在这座建筑的设计中加进了许多环保元素。</p>
<p>Our original proposals were not incorporated in the new legislation. 我们最初的提案没有写进新的法规。</p>
<p><strong>to begin with</strong> 打從一開始就</p>
<p>One big obstacle: Men and women are at odds over whether there even is a problem to begin with.</p>
<p><strong>misnomer</strong> : a wrong or unsuitable name 用詞不當</p>
<p>Silent movie’ is a misnomer since the movies usually had a musical accompaniment.</p>
<p>『无声电影』这一名称不恰当，因为这类电影一般都有配乐。</p>
<p><strong>gimmick and gadgetry</strong></p>
<p>It’s one I’m told that conforms to the kind of proposal that they like to receive, a businesslike proposal without the gimmicks and gadgetry and sensational PR stuff that we’re told is not going to be persuasive.</p>
<p>行銷噱頭 （gimmick）與無關緊要的小玩意 （gadgetry）是沒有說服力的</p>
<p><strong>be toughened up</strong></p>
<p>The ethic was not to complain. You were <code>being toughened up</code>—“iron man” was the term we all used—to deal with the demands of doing research, which did not respect the clock {as people who work 40 hours a week}. But that wasn’t the only way in which sleep <code>was disregarded</code>. 接受磨練變得更強大 （be toughened up）; 被忽視（be disregarded）</p>
<p><strong>to strap to/into</strong> 綁東西在</p>
<p>There was also a respiration sensor that <code>straps to one’s chest</code> and features an app, which synchronizes breathing with tonal music to help lower anxiety.</p>
<p>She strapped the baby seat <code>into the car</code>. 裝上安全座椅</p>
<blockquote>
<p>/stræp/</p>
<ol>
<li><p>strap on 背上 He was only ten when he strapped on a guitar for making a living. 背上吉他討生活</p>
</li>
<li><p>be strapped in 繫上安全帶 Are the kids strapped in?</p>
</li>
<li><p>N-COUNT 帶子 Nancy gripped the strap of her beach bag.</p>
<p>She pulled the strap of her bra/nightgown onto her shoulder.</p>
</li>
</ol>
</blockquote>
<p><strong>impassive</strong></p>
<p> He sat impassive but watchful, accustomed, like many children of immigrants, to making sure that his mother wasn’t taken advantage of.</p>
<blockquote>
<ol>
<li>impassive 事不关己的，冷漠的</li>
<li>accustomed to 习以为常地做。。</li>
</ol>
</blockquote>
<p><strong>exception vs exemption</strong><br>They have similar meanings. They both refer to leaving out an item from a set. The difference is how they are left out. An exemption is left out of the set by an authority or man-made rule. For example, a <strong>tax exemption</strong>, is money you received but does not have to be counted as part of our income because the tax law explicitly say it’s OK to ignore.</p>
<p>An <strong>exception</strong> has no such man-made connotations. The number 2 is an exception to the idea that all prime numbers are odd.</p>
<p><strong>tempt fate</strong><br>If someone tempts fate, they take unnecessary risks or do something that may bring them bad luck. 自寻死路，玩命</p>
<p>eg. They charged the organisers with tempting fate by sending so many ill-prepared crews into such dangerous waters.</p>
<p>Note: You can also say that someone tempts providence.<br>eg. <strong>I used to</strong> take the most appalling risks because <strong>it was in my nature to</strong> push everything to the extreme. I was tempting providence all the time.</p>
<p>If you tempt fate, you talk too confidently about something which may go wrong. 乌鸦嘴</p>
<p>eg. While I wouldn’t want <strong>to tempt fate</strong>, almost every time this team has been put under pressure, they’ve triumphed.</p>
<p>Note: You can also say that someone tempts providence.<br>eg. I’m 36 and I’d hate to tempt providence and say I’m going to get pregnant.</p>
<p><strong>to roll over</strong><br>The servie credits and storage allocations <code>do not roll over</code>. 累计（到下一期）</p>
<p><strong>do one’s dirty work</strong><br>To do the unpleasant or challenging tasks that someone else does not want to do.<br>eg. The boss will just get one of his thugs to do his dirty work, as always. 收拾烂摊子 </p>
<h1 id="Job-market"><a href="#Job-market" class="headerlink" title="Job market"></a>Job market</h1><ol>
<li><a href="https://www.aqr.com/" target="_blank" rel="external">https://www.aqr.com/</a> AQR capital investment LLC, the employer of the author of “Pandas for Data Analysis”</li>
<li><a href="https://www.fastcompany.com/3003949/5-tips-surviving-dreaded-business-dinner" target="_blank" rel="external">5 Tips For Surviving The Dreaded Business Dinner</a></li>
<li><a href="https://www.fastcompany.com/40452371/i-hire-new-grads-at-amazon-here-are-4-qualities-that-can-help-you-stand-out" target="_blank" rel="external">4 Qualities that can help you stand out</a></li>
</ol>
<h1 id="Conversation"><a href="#Conversation" class="headerlink" title="Conversation"></a>Conversation</h1><p>Its’ a good way to start morning.  [闲]</p>
<p>I am actually rather busy. [藉口] 我現在有点忙，不想跟你囉嗦。</p>
<p>Are you making these names up? [玩] 名字是你亂取的嗎？</p>
<p>Sorry, it’s <strong>going downhill</strong>. [玩藉口]抱歉，我越描越黑。</p>
<p>So this is <strong>how</strong> you get around. [串] 喔，這是你的交通工具。</p>
<p>What’s the size you are <strong>looking for</strong>? [闲问]</p>
<p>Wow, that’s <strong>the exciting part to</strong> me. [串] 我最期待（喜欢）的就是。。</p>
<p>It’s very <strong>satisfying</strong> when you get the string out all the way. 撥豆莢粗絲會<strong>上癮</strong></p>
<p>A: I assume they find everything is fine. B: We’ll pray for that. [接] 类似：希望老天帮忙</p>
<p>A: You look pretty/great this morning.  B: Oh, my god, Look at my hair. A: Look at MY hair. Lord.</p>
<p>She is <strong>in control on</strong> me. 在我家，太太<strong>作主</strong>。</p>
<p>Yeah, it’s great that you have something you love so much. [接] 类似：人有自己的兴趣真好</p>
<p>It sounds kind of romantic to me. [接] 真浪漫</p>
<p>In my college days I never had the chance to learn playing piano. Had I known this was next to my door living a pianist all those years ago I would have been knocking on her door all the time. [假設語氣] 要是早知道。。。</p>
<p>A: Thanks for coming. B: No problem. I was <strong>in the area</strong>. 我人就在附近</p>
<p>I am gonna make a little <code>pesto</code> and that’s gonna serve as, like the base for my dressing.</p>
<blockquote>
<p><strong>pesto</strong> : a sauce made from basil , garlic , pine nut s , olive oil , and cheese. The word pesto literally means to pound. 槌打</p>
</blockquote>
<p>A: Well, thank you for <strong>trying</strong>. B: Oh, you’re welcome. 謝謝<strong>試</strong>著幫我做。。</p>
<p>I write about technical topics (mostly related to Python programming), with occasional diversions into other things that interest me.</p>
<p><strong>SO been there</strong> : That little sentence contains two modern elements. “We’ve been there” means “We’ve been in that situation” or “That’s a familiar scenario.” The “so” is an intensifier, now much used by young Americans and Brits, as in “I’m SO going to get drunk”, or “I’m SO over him.” The “so” is always emphasized in this structure, by the way: “We’ve SO been there.”</p>
<p><strong>to echo things a person said</strong> : I just want to echo one thing that Fei-Fei said: If we don’t get women and people of color at the table — real technologists doing the real work — we will bias systems. Trying to reverse that a decade or two from now will be so much more difficult, if not close to impossible.</p>
<h1 id="Sentence"><a href="#Sentence" class="headerlink" title="Sentence"></a>Sentence</h1><p>People felt disappointed they can not lead <strong>as much of the way as</strong> their parents did.</p>
<p>After the given timeframe, I <strong>emailed to follow up</strong> and see how the decision <strong>process is progressing</strong>.</p>
<blockquote>
<p>email to follow up : 追问结果</p>
<p>see how the process is progressing : 查看进行得如何</p>
</blockquote>
<p>Even in a small country like Iceland, a few million trees a year is just <code>a drop in the bucket</code>.</p>
<blockquote>
<p>杯水車薪</p>
</blockquote>
<p>But in the meantime…it would be ok to send a very polite note to the doctor and the hiring manager saying you <strong>understand</strong> they want to find the very best fit for the job and hope you are <strong>still in consideration</strong>. Then you can add something like “<em>if there is anything else I can do to help assure you I’m the right match for the job, please let me know.</em>” And then wish them well.</p>
<blockquote>
<p>in consideration 被考虑中</p>
<p>in the fast lane : e.g. they prefer to avoid life in the fast lane 快节奏的生活</p>
</blockquote>
<p>Before the mile run each year in middle school, on the dreaded walk down from the classroom to the course, my classmates would argue over the best way to prevent a <code>side stitch</code>. <strong>More so than turning an ankle or coming in last, that repetitive <code>stabbing pain</code> is what the majority of us dreaded most</strong>. Our cures ranged across the map from taught techniques, like breathing in through the nose and out through the mouth and not eating for three hours <strong>prior</strong>, <strong>to my favorite</strong>: Punching yourself in the stomach at the slightest hint of pain (don’t try it, it doesn’t work).</p>
<blockquote>
<p>repetitive [rɪ’pɛtətɪv] e.g. The song was dreary and repetitive 枯燥又重复; repetitive work/tasks/jobs like washing and ironing 重複乏味的工作<br>stabbing [‘stæbɪŋ]pain : 刺痛 阵痛</p>
</blockquote>
<p>There’s no standard advice for how to prevent a side stitch, says sports chiropractor Brad Muir, because we don’t know the mechanism that produces the pain in the first place. “It’s still up in the air.”</p>
<blockquote>
<p>懸而未決 （still up in the air）</p>
</blockquote>
<p>One common theory posits that, during exercise, not enough blood (and therefore oxygen) gets to the <code>diaphragm</code> and causes the pain—but side stitches still occur in activities like horseback riding, which don’t <code>tax</code> the respiratory system. “The explanation of it being just the diaphragm <strong>never really held up to more scrutiny</strong>,” Muir says.</p>
<blockquote>
<p>完全經不起檢驗 （never really held up to more scrutiny）</p>
</blockquote>
<p>machines that <strong>irrevocably</strong> changed the pattern of rural life 使乡村生活模式发生不可逆转的变化的机械</p>
<blockquote>
<p>[ɪ’rɛvəkəbl]</p>
</blockquote>
<h1 id="重要链结"><a href="#重要链结" class="headerlink" title="重要链结"></a>重要链结</h1><h4 id="Anaconda"><a href="#Anaconda" class="headerlink" title="Anaconda"></a>Anaconda</h4><ol>
<li><p><a href="https://docs.continuum.io/anaconda/install/windows" target="_blank" rel="external">Anaconda installation guide—Don’t check some options</a></p>
</li>
<li><p>[错误信息] Atom Hydrogen: No Kernel specs found. Resolution:  add to PATH, C:\Users\libin\Anaconda2 and C:\Users\libin\Anaconda2\Scripts.</p>
</li>
<li><p><a href="https://stackoverflow.com/questions/35254852/how-to-change-jupyter-start-folder" target="_blank" rel="external">How to change your Jupyter startispyderng folder</a></p>
</li>
<li><p><a href="https://stackoverflow.com/questions/30492623/using-both-python-2-x-and-python-3-x-in-ipython-notebook" target="_blank" rel="external">Running Jupyter Notebook for multiple version of Python (better guide)</a></p>
</li>
<li><p><a href="https://conda.io/docs/user-guide/tasks/manage-environments.html#activate-env" target="_blank" rel="external">Managing multiple Python environments in Anaconda</a></p>
</li>
<li><p><a href="https://github.com/bluenote10/PandasDataFrameGUI" target="_blank" rel="external">Install Pandas DataFrame GUI</a></p>
<blockquote>
<p>import dfgui</p>
<p>dfgui.show(df)</p>
<p>Note: the procedure should be:</p>
<ul>
<li>In Conda, install a new environment such as Py27, if it is not in place already, for Python 2.7</li>
<li>In Conda, activate Py27</li>
<li>In Conda (Python 2.7), install Spyder, and then packages: Pandas and Matplotlib</li>
<li>In Conda (Python 2.7), install wxpython (pip install -U wxPython)</li>
<li>In Conda (Python 2.7), run Spyder. DFGUI is available now.</li>
</ul>
</blockquote>
</li>
</ol>
<h4 id="Atom-Hydrogen"><a href="#Atom-Hydrogen" class="headerlink" title="Atom Hydrogen"></a>Atom Hydrogen</h4><ol>
<li><p><a href="http://atom-packages.directory/package/language-markdown/" target="_blank" rel="external">After installing Hydrogen, install Markdown language supprot</a></p>
</li>
<li><p><a href="https://discuss.atom.io/t/spell-check-not-working/29126/24" target="_blank" rel="external">After installing language-markdown package to re-enable spell-check</a></p>
</li>
<li><p><a href="https://github.com/nteract/hydrogen/issues/283#issuecomment-224037495" target="_blank" rel="external">If your Hydrogen says kernel lanague not found, see the resolution in this link</a></p>
</li>
</ol>
<h4 id="Hexo-markdown-jupyter"><a href="#Hexo-markdown-jupyter" class="headerlink" title="Hexo + markdown + jupyter"></a>Hexo + markdown + jupyter</h4><ol>
<li><p><a href="http://ijiaer.com/mathjax-atom-hexo/" target="_blank" rel="external">安装markdown-preview-plus（停用内建的）以显示多行数学</a></p>
</li>
<li><p><a href="http://ijiaer.com/mathjax-atom-hexo/" target="_blank" rel="external">Hexo, Atom 的 mathjax 功能失效解决</a></p>
</li>
<li><p><a href="https://github.com/spyder-ide/spyder-notebook" target="_blank" rel="external">Jupyter spyder plugin</a></p>
</li>
</ol>
<h4 id="Jav-Jupyter"><a href="#Jav-Jupyter" class="headerlink" title="Jav + Jupyter"></a>Jav + Jupyter</h4><ol>
<li><a href="https://github.com/scijava/scijava-jupyter-kernel" target="_blank" rel="external">scijava-jupyter-kernel</a></li>
</ol>
<h4 id="More-Python-learning-stuff"><a href="#More-Python-learning-stuff" class="headerlink" title="More Python learning stuff"></a>More Python learning stuff</h4><ol>
<li>Toggle = add or remove</li>
<li><a href="https://github.com/wesm/pydata-book/tree/2nd-edition" target="_blank" rel="external">Python for data analysis—2nd edition’s Ipython</a></li>
</ol>
<ul>
<li><a href="http://statsmodels.org/" target="_blank" rel="external">statsmodels</a></li>
<li><a href="http://scikit-learn.org/" target="_blank" rel="external">scikit-learn</a></li>
<li><a href="http://scipy.org/" target="_blank" rel="external">scipy</a></li>
</ul>
<h4 id="Jupyter-tips"><a href="#Jupyter-tips" class="headerlink" title="Jupyter tips"></a>Jupyter tips</h4><ol>
<li><p>In <strong>Jupyter</strong>, running the command below sets up the integration so you can create multiple plot windows without interfering with the console session: %matplotlib inline</p>
</li>
<li><p>Use <strong>Python3</strong> sprint function in Python2:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</div><div class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</div></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="機器學習"><a href="#機器學習" class="headerlink" title="機器學習"></a>機器學習</h1><h2 id="Lecture-0-introduction"><a href="#Lecture-0-introduction" class="headerlink" title="Lecture 0 - introduction"></a>Lecture 0 - introduction</h2><p>What is machine learning? (not hand-crafted AI) <a href="https://www.youtube.com/watch?v=CXgbekl66jc#t=00h07m39s" target="_blank" rel="external">link</a></p>
<p>What is supervised learning? Ans: a machine is fed with input. and corresponding outputs. Its disadvantage is that it asks for lots of training data (pairs of input and output (or called label)).<br><a href="https://www.youtube.com/watch?v=CXgbekl66jc#t=00h11m39s" target="_blank" rel="external">link</a><br>what is function set? Ans: That is, a model.</p>
<p>What is training and testing in machine learning?<br><a href="https://www.youtube.com/watch?v=CXgbekl66jc#t=00h15m01s" target="_blank" rel="external">link</a> What are three basic steps in machine learning?</p>
<p>What is regression?<br><a href="https://www.youtube.com/watch?v=CXgbekl66jc#t=00h16m37s" target="_blank" rel="external">link</a><br>Case: PM2.5<br><a href="https://www.youtube.com/watch?v=CXgbekl66jc#t=00h17m47s" target="_blank" rel="external">link</a></p>
<p>What is difference between classification and regression? The types of classification?<br><a href="https://www.youtube.com/watch?v=CXgbekl66jc#t=00h18m30s" target="_blank" rel="external">link</a> Binary classification case: spam filtering (junk email). Multi-class classification case: document classification (news classification into sports, finance, politics, etc.)</p>
<p>What’s nonlinear model? Ans: a typical one is deep learning.<br><a href="https://www.youtube.com/watch?v=CXgbekl66jc#t=00h21m01s" target="_blank" rel="external">link</a><br>Deep learning case I: image recognition.<br><a href="https://www.youtube.com/watch?v=CXgbekl66jc#t=00h21m44s" target="_blank" rel="external">link</a><br>Deep learning case II: playing go<br><a href="https://www.youtube.com/watch?v=CXgbekl66jc#t=00h00m01s" target="_blank" rel="external">link</a></p>
<p>What is semi-supervised learning?<br><a href="https://www.youtube.com/watch?v=CXgbekl66jc#t=00h25m18s" target="_blank" rel="external">link</a></p>
<p>What is transfer learning?<br><a href="https://www.youtube.com/watch?v=CXgbekl66jc#t=00h26m20s" target="_blank" rel="external">link</a></p>
<p>Unsupervised learning?<br><a href="https://www.youtube.com/watch?v=CXgbekl66jc#t=00h27m10s" target="_blank" rel="external">link</a> Case: machine reading, machine drawing.</p>
<p>Structured learning - beyond classification? Cases: speech recognition. Machine translation. Face recognition.<br><a href="https://www.youtube.com/watch?v=CXgbekl66jc#t=00h29m30s" target="_blank" rel="external">link</a></p>
<p>Regression and classification are two well-known problems/methods in machine learning. However, structured learning has problems far beyond what people can think of.<br><a href="https://www.youtube.com/watch?v=CXgbekl66jc#t=00h30m50s" target="_blank" rel="external">link</a></p>
<p>What’s the difference b/t reinforcement learning and supervised learning?<br><a href="https://www.youtube.com/watch?v=CXgbekl66jc#t=00h33m00s" target="_blank" rel="external">link</a><br>Case: alpha go (supervised learning + reinforcement learning)<br><a href="https://www.youtube.com/watch?v=CXgbekl66jc#t=00h35m45s" target="_blank" rel="external">link</a></p>
<p>Relations among terminology<br><a href="https://www.youtube.com/watch?v=CXgbekl66jc#t=00h36m10s" target="_blank" rel="external">link</a><br>Scenario (of a problem) is what you can not choose. If you can tackle your problem with supervised learning, you should not use other types of learning. For each type of learning (supervised, reinforment, etc), both regression and/or classification are applicable to solve the problem (tasks).</p>
<h2 id="Lecture-1-Regression"><a href="#Lecture-1-Regression" class="headerlink" title="Lecture 1 Regression"></a>Lecture 1 Regression</h2><p>Step 1. Modeling.<br><a href="https://www.youtube.com/watch?v=fegAeph9UaA&amp;t=349s#t=00h05m49s" target="_blank" rel="external">link</a><br>Step 2. Goodness of Function<br><a href="https://www.youtube.com/watch?v=fegAeph9UaA&amp;t=349s#t=00h13m59s" target="_blank" rel="external">link</a><br>Step 3. Gradient descent <a href="https://www.youtube.com/watch?v=fegAeph9UaA&amp;t=349s#t=00h21m14s" target="_blank" rel="external">link</a></p>
<p>Step 3. 2-dimensional gradient descent <a href="https://www.youtube.com/watch?v=fegAeph9UaA&amp;t=349s#t=00h29m20s" target="_blank" rel="external">link</a></p>
<p>Disadvantage of gradient descent in general <a href="https://www.youtube.com/watch?v=fegAeph9UaA&amp;t=349s#t=00h33m32s" target="_blank" rel="external">link</a> However, application of gradient descent on regression always leads to global optima (because its loss function is convex) <a href="https://www.youtube.com/watch?v=fegAeph9UaA&amp;t=349s#t=00h33m59s" target="_blank" rel="external">link</a><br>Why adds quadratic terms? <a href="https://www.youtube.com/watch?v=fegAeph9UaA&amp;t=349s#t=00h14m40s" target="_blank" rel="external">link</a></p>
<p>more complex models lead to better performance on testing data, but act worse on testing data. This problem is called overfitting.<br><a href="https://www.youtube.com/watch?v=fegAeph9UaA&amp;t=349s#t=00h51m40s" target="_blank" rel="external">link</a></p>
<p>Hidden factor<br><a href="https://www.youtube.com/watch?v=fegAeph9UaA&amp;t=349s#t=00h54m00s" target="_blank" rel="external">link</a> Redesign your model <a href="https://www.youtube.com/watch?v=fegAeph9UaA&amp;t=349s#t=00h56m13s" target="_blank" rel="external">link</a> Case: redesign the model with dummy variables <a href="https://www.youtube.com/watch?v=fegAeph9UaA&amp;t=349s#t=01h00m31s" target="_blank" rel="external">link</a></p>
<p>Regularization: redesign the loss function. Why smooth functions are preferred? Ans: a moderately smoother function is the less influence caused by noise of inputs is. <a href="https://www.youtube.com/watch?v=fegAeph9UaA&amp;t=349s#t=01h07m00s" target="_blank" rel="external">link</a></p>
<p>Regularization needs not to consider constant term (here, the term is bias term). <a href="https://www.youtube.com/watch?v=fegAeph9UaA&amp;t=349s#t=01h13m43s" target="_blank" rel="external">Reason</a></p>
<h2 id="Lesson-2-Where-does-the-error-come-from"><a href="#Lesson-2-Where-does-the-error-come-from" class="headerlink" title="Lesson 2 Where does the error come from?"></a>Lesson 2 Where does the error come from?</h2><p>Use expectation of sample mean to explain the difference between bias and variance. <a href="https://www.youtube.com/watch?v=D_S6y0Jm6dQ&amp;index=5&amp;list=PLJV_el3uVTsPy9oCRY30oBPNLCo89yu49#t=3m28s" target="_blank" rel="external">link</a> 众智成城</p>
<p>Why larger sample is better for estimation? <a href="https://www.youtube.com/watch?v=D_S6y0Jm6dQ&amp;index=5&amp;list=PLJV_el3uVTsPy9oCRY30oBPNLCo89yu49#t=3m28s#t=5m50s" target="_blank" rel="external">link</a></p>
<p>Use an illustration to explain bias, variance and error. <a href="https://www.youtube.com/watch?v=D_S6y0Jm6dQ&amp;index=5&amp;list=PLJV_el3uVTsPy9oCRY30oBPNLCo89yu49#t=8m14s" target="_blank" rel="external">link</a></p>
<p>Obtain different estimate from parallel universes, an analogy <a href="https://www.youtube.com/watch?v=D_S6y0Jm6dQ&amp;index=5&amp;list=PLJV_el3uVTsPy9oCRY30oBPNLCo89yu49#t=13m13s" target="_blank" rel="external">link</a></p>
<h1 id="Statistics"><a href="#Statistics" class="headerlink" title="Statistics"></a>Statistics</h1><p>Some <code>forty-seven million adults</code>, according to the National Sleep Foundation, do not <code>get a restorative night’s sleep</code>. In the workplace, sleep deprivation <strong>results in</strong> injuries and decreased productivity, which <strong>is thought to</strong> cost the U.S. <code>eighteen billion dollars each year</code>.</p>
<p>As many as <code>1.2 million</code> car crashes—<code>twenty per cent</code> of the annual total—can be <strong>attributed</strong> to tired drivers, <strong>so it could be said that</strong> lack of sleep causes thousands of deaths and injuries every year.</p>
<p>source: <a href="https://www.newyorker.com/magazine/2017/10/23/the-secrets-of-sleep?mbid=synd_digg" target="_blank" rel="external">newyorker</a></p>
<blockquote>
<p><strong>restorative</strong> [rɪ’stɔrətɪv] 紓壓恢復元氣的 something that is restorative makes you feel healthier, stronger, or more cheerful after you have been feeling tired, weak, or miserable, e.g. <code>Seven days off</code> could be a wonderful restorative.  休假7天可以使人好好复元。How restorative a hot bath would be. 洗熱水澡真是<strong>消除疲勞</strong>。</p>
<p><strong>so it could be said that</strong> （所以我們）<strong>可以說是。。</strong></p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <p class="site-author-name" itemprop="name">n0body</p>
            <p class="site-description motion-element" itemprop="description"></p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/note/archives/">
            
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/note/tags/index.html">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">n0body</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" href="https://hexo.io">Hexo</a></div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">Theme &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.2</div>


        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/note/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/note/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/note/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/note/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/note/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/note/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/note/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/note/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/note/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/note/js/src/schemes/pisces.js?v=5.1.2"></script>



  <script type="text/javascript" src="/note/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/note/js/src/post-details.js?v=5.1.2"></script>


  

  


  <script type="text/javascript" src="/note/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  








  





  

  

  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="custom_mathjax_source">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
  


  

  

</body>
</html>
